<!DOCTYPE html>
<!--[if IE 8]>         <html class="js ie8"> <![endif]-->
<!--[if IE 9]>         <html class="js ie9"> <![endif]-->
<!--[if gt IE 9]><!--> <html class="js"> <!--<![endif]-->
	<head>
		<title>Игры Демиургов</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=0.5, user-scalable=no"/>

		<link rel="stylesheet" type="text/css" href="style.css" media="screen, projection, print">
		<!--<script type="text/javascript" src="js/main.js"></script> -->

		<script type="text/javascript" src="engine/spine-runtime/pixi/bin/pixi.dev.js"></script>
		<script type="text/javascript" src="engine/scene.js"></script>
		<script type="text/javascript" src="engine/object.js"></script>

		<script type="text/javascript" src="tools/debugTraect.js"></script>

		<script type="text/javascript">
			document.addEventListener("DOMContentLoaded", function(event) {

				var assetsToLoader = [
					"assets/models/spineboy/spineboy.json",
					"assets/models/spineboy/spineboy.anim",

					"assets/models/dragon/dragon.json",
					"assets/models/dragon/dragon.anim",

					"assets/models/goblins/images/goblin/goblin.json",
					"assets/models/goblins/images/goblin/goblin.anim",

					"assets/background/lvl1_1.png"
				];

				// create a new loader
				var loader = new PIXI.AssetLoader(assetsToLoader);

				// use callback
				loader.onComplete = function() {

					var obj1 = obj().create({
							src: 'assets/background/lvl1_1.png',
							x: 0,
							y: 0,
							z: 5
						});

					var obj5 = obj().create({
							src: 'assets/models/spineboy/spineboy.anim',
							x: 600,
							y: 400,
							z: 10
						});

					var obj2 = obj().create({
							src: 'assets/models/spineboy/spineboy.anim',
							x: 600,
							y: 400,
							z: 15,
							scale: 0.5,
							animated: true
						});

					var obj3 = obj().create({
							src: 'assets/models/dragon/dragon.anim',
							x: 450,
							y: 500,
							z: 19,
							pz: 10,
							scale: 0.5,
							reverse: true
						});

					var obj31 = obj().create({
							src: 'assets/models/dragon/dragon.anim',
							x: 200,
							y: 400,
							z: 10,
							pz: 10,
							scale: 0.3
						});

					var obj32 = obj().create({
							src: 'assets/models/dragon/dragon.anim',
							x: 400,
							y: 300,
							z: 11,
							pz: 10,
							scale: 0.4
						});

					var obj4 = obj().create({
							src: 'assets/models/goblins/images/goblin/goblin.anim',
							x: 100,
							y: 300,
							z: 10,
							scale: 0.7
						});

					var obj6 = obj().create({
							src: 'assets/models/goblins/images/goblin/goblin.anim',
							x: 150,
							y: 400,
							z: 10
						});

					scene
						.addObj(obj1)
						/*.addObj(obj2)
						.addObj(obj3)
						.addObj(obj5);
						.addObj(obj31)
						.addObj(obj32)
						.addObj(obj4)
						.addObj(obj6); */

					/*setInterval(function() {
						var objects = [obj2, obj3, obj4, obj5, obj6],
							planes = [20, 30, 40, 50, 60],
							index = planes[ Math.round( Math.random() * 4 ) ],
							index2 = objects[ Math.round( Math.random() * 4 ) ];


						index2.move({
							z: index
						})
						//console.log(index2, index);
						//console.log(Z.getZindex());
					}, 1000) */

					 /*setTimeout(function() {
						obj6.move({
							z: 20
						})
						console.log(Z.getZindex());

						 setTimeout(function() {
							obj6.move({
								z: 60
							})
							console.log(Z.getZindex());
						}, 1000)
					}, 1000)*/

				}

				//begin load

				function resizeViewPort() {
					document.body.style.width = ( 2922 / document.getElementById('view').getAttribute('width') ) * document.getElementById('view').clientWidth + 'px';
				}

				scene
					.init({
						canvasId: 'view'
					})

				loader.load();
				resizeViewPort();
				setTimeout(function() {
					window.scroll(0, 0);
				}, 1000)

				window.onscroll = function(e) {
					scene.playGround.position.x = -2922 * window.pageXOffset / document.body.clientWidth;
				}

				window.addEventListener('resize', function() {
					resizeViewPort();
				})

				/********************** DEBUGGER ************************/
				document.querySelector('.debug__view').setAttribute('width', document.body.clientWidth / document.getElementById('view').clientHeight * 510 );
				document.querySelector('.debug__view').setAttribute('height', document.getElementById('view').getAttribute('height'));
				debugTraect.paint();

			})
		</script>

	</head>
	<body>
		<canvas id="view"></canvas>
		<div class="debug" style="display: block">
			<div class="debug__control">
				<div class="debug__control-traects">
					<select id="" size="10"></select>
				</div>

				<div class="debug__control-objects"></div>

				<div class="debug__control-buttons">
					<button class="debug__button debug__button_add">Добавить траекторию</button>
					<button class="debug__button debug__button_remove">Удалить траекторию</button>

					<hr />
					<button class="debug__button debug__button_add-model">Добавить модель</button>
					<button class="debug__button debug__button-model-forward">Вперед</button>
					<button class="debug__button debug__button-model-backward">Назад</button>
					<hr />
					<button class="debug__button debug__button_toggle-overlay">Переключить оверлей</button>
					<!--<button disabled=disabled>Удалить</button>-->
				</div>
			</div>

			<canvas class="debug__view"></canvas>

			<!--<div class="debug__point" style="top: 500px; left: 100px"></div>
			<div class="debug__point" style="top: 600px; left: 300px"></div>
			<div class="debug__point" style="top: 400px; left: 500px"></div>
			<div class="debug__point" style="top: 500px; left: 700px"></div>-->
		</div>
	</body>
</html>