function ai(){function t(){p=0,setTimeout(function(){a()},utils.getRandomValue(d))}function e(){p=1,s.image.scale.x*=-1,a()}function i(){if(p=2,l&&c){var t=utils.getRandomValue(globals.paths[c].controlPath.length-1);s.moveTo({path:c,chain:t,animationName:l,callback:function(){a()}})}else a()}function r(){p=3,h?s.animate({animation:h,callback:function(){a()}}):a()}function n(){p=4,g=utils.getDistance({x1:s.image.position.x,x2:globals.objects.hero.image.position.x,y1:s.image.position.y,y2:globals.objects.hero.image.position.y})<u?!0:!1,a()}function a(){if(!b){var a,o=utils.getRandomValue(10),s=0,l=g?"yes":"no";for(a=0;4>a&&(s+=f[p][a][l],!(s>=o));a++);switch(a){case 0:t();break;case 1:e();break;case 2:i();break;case 3:r();break;default:n()}}}function o(t){f=t.probMatrix||f,l=t.moveAnimation||!1,h=t.stayAnimation||!1,c=t.availablesPaths||!1,u=t.lookDistance||300,d=t.stayTime||3e3,s=t.obj}var s,l,h,c,u,d,p,f=[[{yes:1,no:1},{yes:3,no:2},{yes:2,no:2},{yes:3,no:3},{yes:1,no:2}],[{yes:2,no:4},{yes:0,no:0},{yes:4,no:1},{yes:3,no:3},{yes:1,no:2}],[{yes:1,no:3},{yes:2,no:1},{yes:1,no:1},{yes:5,no:3},{yes:1,no:2}],[{yes:1,no:2},{yes:3,no:1},{yes:2,no:2},{yes:3,no:3},{yes:1,no:2}],[{yes:3,no:5},{yes:2,no:1},{yes:3,no:2},{yes:2,no:2},{yes:0,no:0}]],g=!1,b=!1;return{init:function(t){return o(t),this},start:function(){return b=!1,p=4,a(),this},stop:function(){return b=!0,this}}}function obj(){var t=-9999,e=-9999,i=1,r=1,n=null,a=null;return{create:function(o){function s(){g.image.position.x=void 0!==o.x?o.x:t,g.image.position.y=void 0!==o.y?o.y:e,g.z=void 0!==o.z?o.z:i,g.pz=void 0!==o.pz?o.pz:r,g.step=void 0!==o.step?o.step:n,g.path=void 0!==o.path?o.path:a,null!==g.step&&null!==g.path&&(void 0===o.x||void 0===o.y)&&(g.image.position.x=globals.paths[g.path].steps[g.step].x,g.image.position.y=globals.paths[g.path].steps[g.step].y)}function l(){g.image.scale.x=g.image.scale.y=void 0!==o.scale?o.scale:1}function h(){o.reverse&&(g.image.scale.x*=-1)}function c(){var t=Math.random().toString();return void 0!==globals.objects[t]&&(t=c()),t}function u(){var t;if(o.animation){g.animation={};for(t in o.animation)g.animation[t]={},o.animation[t].soundSrc&&(g.animation[t].track=track().load({obj:g,url:o.animation[t].soundSrc}))}}function d(){o.interactive&&(g.image.setInteractive(!0),g.image.click=g.image.tap=function(){return globals.viewport.resize?!1:(globals.objectClicked=!0,void relay.drop({obj:g.id,type:"objectClick"}))},g.image.mouseover=function(){document.body.className+=" _cursor"},g.image.mouseout=function(){document.body.className=document.body.className.replace(/\s_cursor/gi,"")})}function p(){o.ai&&(g.ai=ai().init({probMatrix:o.ai.probMatrix,moveAnimation:o.ai.moveAnimation,stayAnimation:o.ai.stayAnimation,availablesPaths:o.ai.availablesPaths,lookDistance:o.ai.lookDistance,obj:g}))}var f,g=this;return void 0===o.src?!1:(-1!==o.src.indexOf(".anim")?(f=o.name||c(),g.type="spine",g.src=o.src,g.image=new PIXI.Spine(o.src),g.id=f,globals.objects[f]=g,relay.drop({obj:f,type:"objectAdded"})):(g.type="image",g.src=o.src,g.image=new PIXI.Sprite.fromImage(o.src)),s(),l(),h(),u(),d(),p(),g)},move:function(t){var e,i,r,n,a,o=this;return void 0!==t.y&&(o.image.position.y=t.y),void 0!==t.x&&(e=t.x-o.image.position.x,0>e&&"stairCaseWalk"!==o.image.state.current.name&&"tree"!==o.id&&o.image.scale.x>0&&(o.image.scale.x*=-1),e>0&&"stairCaseWalk"!==o.image.state.current.name&&o.image.scale.x<0&&(o.image.scale.x*=-1),o.image.position.x=t.x,"hero"===o.id&&(i=scene.width/2/globals.viewport.scale,r=scene.height/2/globals.viewport.scale,n=(o.image.position.x-i)*globals.viewport.scale,a=(o.image.position.y-50/globals.scale-r)*globals.viewport.scale,scene.move({dx:-n,dy:-a}))),void 0!==t.z&&Z.changeZindex({obj:o,z:t.z}),o},moveTo:function(t){var e=this;return pathfinder.moveObjectByChain({id:e.id,path:t.path,chain:t.chain,animationName:t.animationName,speedValue:t.speedValue,callback:t.callback}),e},animate:function(t){var e,i,r=this,n=t.callback||function(){};return r.image.state.setAnimationByName(t.animation,!1),r.animation&&r.animation[t.animation]&&r.animation[t.animation].track.play(),e=1e3*r.image.state.current.duration,i=Math.random(),setTimeout(function(){n(),relay.drop({obj:r,type:"endAnimation",animation:t.animation,id:i})},e),relay.drop({obj:r,type:"startAnimation",animation:t.animation,id:i}),r},getPosition:function(){var t,e,i,r=this,n=r.path,a=Math.abs(r.image.scale.x)/r.image.scale.x;for(i=0;i<globals.paths[r.path].controlPath.length;i++)if(Math.abs(globals.paths[r.path].controlPath[i].step-r.step)<10){t=i;break}return r.step<10&&(e=globals.paths[n].dots[0].graphId),Math.abs(globals.paths[n].steps.length-r.step)<10&&(e=globals.paths[n].dots[globals.paths[n].dots.length-1].graphId),{path:n,chain:t,graphId:e,orientation:a}}}}function moveTree(){globals.paths.jump2.breakpath=!0,globals.paths.tree1.breakpath=!0,graph.buildGraph({callback:function(){globals.objects.tree.moveTo({path:"groundTreeToLeft",chain:4,animationName:"animation",speedValue:2})}})}function checkGarbageBucket(){if(!globals.triggers.garbageBucketIsOpen){var t=globals.objects.hero.getPosition().chain;t>1&&9>t&&globals.objects.garbageBucket.animate({animation:"live"}),setTimeout(function(){"treeToSemaphore"===globals.objects.hero.getPosition().path&&checkGarbageBucket()},1200)}}function catchButterfly(){globals.objects.hero.animate({animation:"catch",callback:function(){globals.triggers.butterflyWasCatched=!0,globals.preventClick=!1}}),globals.objects.butterfly.move({z:0}),globals.objects.butterfly.moveTo({path:"butterflyStopPath",chain:1,animationName:"butterfly",speedValue:10})}function getTheStone(t){var e=t||function(){};globals.triggers.ihavestone?e():(globals.objects.hero.animate({animation:"slope",callback:function(){globals.triggers.ihavestone=!0,e()}}),setTimeout(function(){globals.objects.stone.move({z:0}),globals.objects.stone.moveTo({path:"stoneToHand",chain:1,speedValue:20})},700))}function dropToVillain(){getTheStone(function(){globals.preventClick=!1,-1===globals.objects.hero.getPosition().orientation&&(globals.objects.hero.image.scale.x*=-1),globals.objects.stone.move({z:10}),globals.objects.stone.moveTo({path:"stoneToHand",chain:3,speedValue:18,callback:function(){globals.objects.stone.move({z:0}),globals.objects.villain2.ai.stop(),globals.objects.villain2.moveTo({path:"semaphoreVillainPath",chain:1,animationName:"down",speedValue:15}),globals.paths.semaphoreTurnOnPath.breakpath=!1,graph.buildGraph({callback:function(){globals.triggers.semaphoreIsClickable=!0}}),globals.objects.villain2.image.setInteractive(!1)}})})}function tvPictures(){globals.objects.tv.animate({animation:"TV stop",callback:function(){tvPictures()}})}function stairHint(){var t=utils.getRandomValue(1e4,2e4);globals.triggers.stairHint=setTimeout(function(){hint.message("stairHintText"),stairHint()},t)}function bucketHint(){var t=utils.getRandomValue(1e4,2e4);globals.triggers.bucketHint=setTimeout(function(){-1!==["tree1","jump2","treeInside","treeToBucket"].indexOf(globals.objects.hero.getPosition().path)&&hint.message("bucketHintText"),bucketHint()},t)}function centralAction(){var t=utils.getRandomValue(1e4,2e4);globals.triggers.centralActionHint=setTimeout(function(){globals.triggers.semaphoreIsClickable&&(globals.triggers.butterflyWasCatched||globals.triggers.butterflyIsFree)?hint.message("semaphoreHintText"):"treeToSemaphore"!==globals.objects.hero.getPosition().path||globals.triggers.butterflyWasCatched||globals.triggers.butterflyIsFree?"semaphoreBreakPath"!==globals.objects.hero.getPosition().path||globals.triggers.semaphoreIsClickable||hint.message("villainHintText"):hint.message("garbageHintText"),centralAction()},t)}function levelEnd(){var t=utils.getRandomValue(1e4,2e4);globals.triggers.levelEndHint=setTimeout(function(){-1!==["endPath","endPath1","elephantPath"].indexOf(globals.objects.hero.getPosition().path)&&hint.message("finalGarbageHintText"),levelEnd()},t)}function track(){var t,e=!1;return{source:!1,load:function(i){function r(r,n){var a=n||function(){};audio.getContext().decodeAudioData(r,function(r){e=r,t.panner=audio.getContext().createPanner(),t.panner.rolloffFactor=.01,t.panner.connect(audio.getGainNode()),1!==Object.keys(i.obj).length&&audio.updateWorldSound({id:i.obj.id}),a()},function(){a()})}function n(t){var e=t||function(){},n=new XMLHttpRequest;n.open("GET",i.url,!0),n.responseType="arraybuffer",n.onload=function(){"localStorageWrapper"!==localforage._driver?localforage.setItem(i.url,n.response,function(){r(n.response,e)}):r(n.response,e)},n.send()}var a=this,o=i.callback||function(){};return audio.getContext()?(t=i.obj,localforage.getItem(i.url,function(t){t?(console.log(i.url+" was loaded from cache."),r(t,o)):(console.log(i.url+" was loaded from network."),n(o))})):o(),a},play:function(i){var r=this,n=i&&i.loop||!1,a=i&&i.callback||function(){};return e&&(r.source=audio.getContext().createBufferSource(),r.source.buffer=e,r.source.connect(t.panner),r.source.loop=n,r.source.start(0),setTimeout(function(){a()},1e3*r.source.buffer.duration)),r},stop:function(){return this.source&&this.source.stop(),this}}}function init(){localforage.config({name:"gameOfDemiurges",version:1,size:20971520,storeName:"keyvaluepairs",description:"Offline Storage"}),loader.init({resources:["assets/models/ready/hero/hero.json","assets/models/ready/hero/hero.anim","assets/models/ready/bird/bird.json","assets/models/ready/bird/bird.anim","assets/models/ready/villain/villain.json","assets/models/ready/villain/villain.anim","assets/models/ready/villain2/villain2.json","assets/models/ready/villain2/villain2.anim","assets/models/ready/bucket/bucket.json","assets/models/ready/bucket/bucket.anim","assets/models/ready/garbageBucket/garbageBucket.json","assets/models/ready/garbageBucket/garbageBucket.anim","assets/models/ready/stone/stone.json","assets/models/ready/stone/stone.anim","assets/models/ready/semaphore/semaphore.json","assets/models/ready/semaphore/semaphore.anim","assets/models/ready/butterfly/butterfly.json","assets/models/ready/butterfly/butterfly.anim","assets/models/ready/tv/tv.json","assets/models/ready/tv/tv.anim","assets/models/ready/additionalHero1/addHero1.json","assets/models/ready/additionalHero1/addHero1.anim","assets/models/ready/additionalHero2/additionalHero2.json","assets/models/ready/additionalHero2/additionalHero2.anim","assets/models/ready/elephant/elephant.json","assets/models/ready/elephant/elephant.anim","assets/models/ready/doorToTheNextLavel/doorToTheNextLavel.json","assets/models/ready/doorToTheNextLavel/doorToTheNextLavel.anim","assets/models/ready/barrier/barrier.json","assets/models/ready/barrier/barrier.anim","assets/models/ready/roadSing/roadSing.json","assets/models/ready/roadSing/roadSing.anim","assets/background/background.jpg","assets/background/backgroundVillainPatch.png","assets/models/ready/snow/snow.json","assets/models/ready/snow/snow.anim","assets/models/ready/tree/tree.json","assets/models/ready/tree/tree.anim"],callback:function(){var t="stair2",e="birdTreePath",i="groundTreeToLeft",r="semaphoreVillainPath",n="butterflyPath",a="stoneToHand",o="addHero2Path",s="elephantPathEnd",l="endPath1",h=obj().create({src:"assets/background/background.jpg",name:"background",x:0,y:0,z:5}),c=obj().create({src:"assets/background/backgroundVillainPatch.png",name:"backgroundVillainPatch",x:1582,y:600,z:10}),u=obj().create({name:"tree",src:"assets/models/ready/tree/tree.anim",z:10,pz:10,scale:1.15,step:275,path:i}),d=obj().create({name:"snow",src:"assets/models/ready/snow/snow.anim",x:300,y:400,z:20,pz:10}),p=obj().create({name:"hero",src:"assets/models/ready/hero/hero.anim",z:15,pz:10,scale:.4,step:0,path:t}),f=obj().create({name:"villain",src:"assets/models/ready/villain/villain.anim",z:15,pz:5,scale:.4,step:440,path:i,interactive:!0,ai:{stayAnimation:"animation"},animation:{animation:{soundSrc:"assets/models/ready/villain/villain_sound.ogg"}}}),g=obj().create({name:"villain2",src:"assets/models/ready/villain2/villain2.anim",z:7,pz:5,scale:1,step:0,path:r,interactive:!0,ai:{stayAnimation:"animation"},animation:{animation:{soundSrc:"assets/models/ready/villain2/villain2_sound.ogg"}}}),b=obj().create({name:"bird",src:"assets/models/ready/bird/bird.anim",z:15,pz:5,step:0,path:e,interactive:!0,ai:{stayAnimation:"bird"},animation:{bird:{soundSrc:"assets/models/ready/bird/bird_sound.ogg"}}}),m=obj().create({name:"bucket",src:"assets/models/ready/bucket/bucket.anim",x:530,y:293,z:13,pz:5}),v=obj().create({name:"garbageBucket",src:"assets/models/ready/garbageBucket/garbageBucket.anim",x:1193,y:647,z:10,interactive:!0}),y=obj().create({name:"semaphore",src:"assets/models/ready/semaphore/semaphore.anim",x:1500,y:730,z:10,interactive:!0,animation:{trafficLight:{soundSrc:"assets/models/ready/semaphore/semaphore_sound.ogg"}}}),x=obj().create({name:"stone",src:"assets/models/ready/stone/stone.anim",path:a,step:20,z:10,pz:15,interactive:!0}),T=obj().create({name:"barrier",src:"assets/models/ready/barrier/barrier.anim",x:1750,y:610,z:10}),w=obj().create({name:"butterfly",src:"assets/models/ready/butterfly/butterfly.anim",scale:.35,z:0,pz:5,step:0,path:n,interactive:!0}),_=obj().create({name:"tv",src:"assets/models/ready/tv/tv.anim",z:20,pz:5,x:2370,y:840,interactive:!0,animation:{"TV run":{soundSrc:"assets/models/ready/tv/tv_sound.ogg"},"TV stop":{soundSrc:"assets/models/ready/tv/tv_sound.ogg"}}}),A=obj().create({name:"addHero1",src:"assets/models/ready/additionalHero1/addHero1.anim",z:15,pz:10,step:110,path:l,ai:{moveAnimation:"addHero1",availablesPaths:l}}),S=obj().create({name:"addHero2",src:"assets/models/ready/additionalHero2/additionalHero2.anim",z:10,pz:10,step:240,path:s,ai:{stayAnimation:"animation",stayTime:5e3},animation:{animation:{soundSrc:"assets/models/ready/additionalHero2/additionalHero2_sound.ogg"}}}),C=obj().create({name:"elephant",src:"assets/models/ready/elephant/elephant.anim",z:10,pz:10,scale:.8,step:0,path:o,interactive:!1,ai:{moveAnimation:"Elefant",availablesPaths:o,stayTime:6e3}}),E=obj().create({name:"doorToTheNextLavel",src:"assets/models/ready/doorToTheNextLavel/doorToTheNextLavel.anim",x:3700,y:550,z:10,animation:{door:{soundSrc:"assets/models/ready/doorToTheNextLavel/door_sound.ogg"}}}),R=obj().create({name:"roadSing",src:"assets/models/ready/roadSing/roadSing.anim",x:3485,y:285,z:10,interactive:!0});globals.objects.hero.image.stateData.setMixByName("new","stairCaseWalk",0),globals.objects.hero.image.stateData.setMixByName("new","stop",.3),globals.objects.semaphore.image.stateData.setMixByName("trafficLight","trafficLight_stop",.5),debug||audio.initBackgroundSound(),scene.init({canvasId:"view"}).addObj(h).addObj(c).addObj(u).addObj(d).addObj(p).addObj(f).addObj(g).addObj(b).addObj(m).addObj(v).addObj(y).addObj(w).addObj(_).addObj(A).addObj(S).addObj(C).addObj(x).addObj(E).addObj(T).addObj(R),viewport.init(),queue.startQueue(),debug&&(document.querySelector(".debug__wrap").style.display="block",debugTraect.init())}})}(function(){function t(){return n.Matrix="undefined"!=typeof Float32Array?Float32Array:Array,n.Matrix}function e(t){return[(t>>16&255)/255,(t>>8&255)/255,(255&t)/255]}function e(t){return[(t>>16&255)/255,(t>>8&255)/255,(255&t)/255]}var i=this,n=n||{};n.Point=function(t,e){this.x=t||0,this.y=e||0},n.Point.prototype.clone=function(){return new n.Point(this.x,this.y)},n.Point.prototype.constructor=n.Point,n.Rectangle=function(t,e,i,r){this.x=t||0,this.y=e||0,this.width=i||0,this.height=r||0},n.Rectangle.prototype.clone=function(){return new n.Rectangle(this.x,this.y,this.width,this.height)},n.Rectangle.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var i=this.x;if(t>=i&&t<=i+this.width){var r=this.y;if(e>=r&&e<=r+this.height)return!0}return!1},n.Rectangle.prototype.constructor=n.Rectangle,n.Polygon=function(t){if(t instanceof Array||(t=Array.prototype.slice.call(arguments)),"number"==typeof t[0]){for(var e=[],i=0,r=t.length;r>i;i+=2)e.push(new n.Point(t[i],t[i+1]));t=e}this.points=t},n.Polygon.prototype.clone=function(){for(var t=[],e=0;e<this.points.length;e++)t.push(this.points[e].clone());return new n.Polygon(t)},n.Polygon.prototype.contains=function(t,e){for(var i=!1,r=0,n=this.points.length-1;r<this.points.length;n=r++){var a=this.points[r].x,o=this.points[r].y,s=this.points[n].x,l=this.points[n].y,h=o>e!=l>e&&(s-a)*(e-o)/(l-o)+a>t;h&&(i=!i)}return i},n.Polygon.prototype.constructor=n.Polygon,n.Circle=function(t,e,i){this.x=t||0,this.y=e||0,this.radius=i||0},n.Circle.prototype.clone=function(){return new n.Circle(this.x,this.y,this.radius)},n.Circle.prototype.contains=function(t,e){if(this.radius<=0)return!1;var i=this.x-t,r=this.y-e,n=this.radius*this.radius;return i*=i,r*=r,n>=i+r},n.Circle.prototype.constructor=n.Circle,n.Ellipse=function(t,e,i,r){this.x=t||0,this.y=e||0,this.width=i||0,this.height=r||0},n.Ellipse.prototype.clone=function(){return new n.Ellipse(this.x,this.y,this.width,this.height)},n.Ellipse.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var i=(t-this.x)/this.width-.5,r=(e-this.y)/this.height-.5;return i*=i,r*=r,.25>i+r},n.Ellipse.getBounds=function(){return new n.Rectangle(this.x,this.y,this.width,this.height)},n.Ellipse.prototype.constructor=n.Ellipse,t(),n.mat3={},n.mat3.create=function(){var t=new n.Matrix(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},n.mat3.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},n.mat4={},n.mat4.create=function(){var t=new n.Matrix(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},n.mat3.multiply=function(t,e,i){i||(i=t);var r=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],h=t[6],c=t[7],u=t[8],d=e[0],p=e[1],f=e[2],g=e[3],b=e[4],m=e[5],v=e[6],y=e[7],x=e[8];return i[0]=d*r+p*o+f*h,i[1]=d*n+p*s+f*c,i[2]=d*a+p*l+f*u,i[3]=g*r+b*o+m*h,i[4]=g*n+b*s+m*c,i[5]=g*a+b*l+m*u,i[6]=v*r+y*o+x*h,i[7]=v*n+y*s+x*c,i[8]=v*a+y*l+x*u,i},n.mat3.clone=function(t){var e=new n.Matrix(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},n.mat3.transpose=function(t,e){if(!e||t===e){var i=t[1],r=t[2],n=t[5];return t[1]=t[3],t[2]=t[6],t[3]=i,t[5]=t[7],t[6]=r,t[7]=n,t}return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],e},n.mat3.toMat4=function(t,e){return e||(e=n.mat4.create()),e[15]=1,e[14]=0,e[13]=0,e[12]=0,e[11]=0,e[10]=t[8],e[9]=t[7],e[8]=t[6],e[7]=0,e[6]=t[5],e[5]=t[4],e[4]=t[3],e[3]=0,e[2]=t[2],e[1]=t[1],e[0]=t[0],e},n.mat4.create=function(){var t=new n.Matrix(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},n.mat4.transpose=function(t,e){if(!e||t===e){var i=t[1],r=t[2],n=t[3],a=t[6],o=t[7],s=t[11];return t[1]=t[4],t[2]=t[8],t[3]=t[12],t[4]=i,t[6]=t[9],t[7]=t[13],t[8]=r,t[9]=a,t[11]=t[14],t[12]=n,t[13]=o,t[14]=s,t}return e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15],e},n.mat4.multiply=function(t,e,i){i||(i=t);var r=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],h=t[6],c=t[7],u=t[8],d=t[9],p=t[10],f=t[11],g=t[12],b=t[13],m=t[14],v=t[15],y=e[0],x=e[1],T=e[2],w=e[3];return i[0]=y*r+x*s+T*u+w*g,i[1]=y*n+x*l+T*d+w*b,i[2]=y*a+x*h+T*p+w*m,i[3]=y*o+x*c+T*f+w*v,y=e[4],x=e[5],T=e[6],w=e[7],i[4]=y*r+x*s+T*u+w*g,i[5]=y*n+x*l+T*d+w*b,i[6]=y*a+x*h+T*p+w*m,i[7]=y*o+x*c+T*f+w*v,y=e[8],x=e[9],T=e[10],w=e[11],i[8]=y*r+x*s+T*u+w*g,i[9]=y*n+x*l+T*d+w*b,i[10]=y*a+x*h+T*p+w*m,i[11]=y*o+x*c+T*f+w*v,y=e[12],x=e[13],T=e[14],w=e[15],i[12]=y*r+x*s+T*u+w*g,i[13]=y*n+x*l+T*d+w*b,i[14]=y*a+x*h+T*p+w*m,i[15]=y*o+x*c+T*f+w*v,i},n.DisplayObject=function(){this.last=this,this.first=this,this.position=new n.Point,this.scale=new n.Point(1,1),this.pivot=new n.Point(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.hitArea=null,this.buttonMode=!1,this.renderable=!1,this.parent=null,this.stage=null,this.worldAlpha=1,this._interactive=!1,this.worldTransform=n.mat3.create(),this.localTransform=n.mat3.create(),this.color=[],this.dynamic=!0,this._sr=0,this._cr=1},n.DisplayObject.prototype.constructor=n.DisplayObject,n.DisplayObject.prototype.setInteractive=function(t){this.interactive=t},Object.defineProperty(n.DisplayObject.prototype,"interactive",{get:function(){return this._interactive},set:function(t){this._interactive=t,this.stage&&(this.stage.dirty=!0)}}),Object.defineProperty(n.DisplayObject.prototype,"mask",{get:function(){return this._mask},set:function(t){this._mask=t,t?this.addFilter(t):this.removeFilter()}}),n.DisplayObject.prototype.addFilter=function(t){if(!this.filter){this.filter=!0;var e=new n.FilterBlock,i=new n.FilterBlock;e.mask=t,i.mask=t,e.first=e.last=this,i.first=i.last=this,e.open=!0;var r,a,o=e,s=e;a=this.first._iPrev,a?(r=a._iNext,o._iPrev=a,a._iNext=o):r=this,r&&(r._iPrev=s,s._iNext=r);var o=i,s=i,r=null,a=null;a=this.last,r=a._iNext,r&&(r._iPrev=s,s._iNext=r),o._iPrev=a,a._iNext=o;for(var l=this,h=this.last;l;)l.last==h&&(l.last=i),l=l.parent;this.first=e,this.__renderGroup&&this.__renderGroup.addFilterBlocks(e,i),t.renderable=!1}},n.DisplayObject.prototype.removeFilter=function(){if(this.filter){this.filter=!1;var t=this.first,e=t._iNext,i=t._iPrev;e&&(e._iPrev=i),i&&(i._iNext=e),this.first=t._iNext;var r=this.last,e=r._iNext,i=r._iPrev;e&&(e._iPrev=i),i._iNext=e;for(var n=r._iPrev,a=this;a.last==r&&(a.last=n,a=a.parent););var o=t.mask;o.renderable=!0,this.__renderGroup&&this.__renderGroup.removeFilterBlocks(t,r)}},n.DisplayObject.prototype.updateTransform=function(){this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation));var t=this.localTransform,e=this.parent.worldTransform,i=this.worldTransform;t[0]=this._cr*this.scale.x,t[1]=-this._sr*this.scale.y,t[3]=this._sr*this.scale.x,t[4]=this._cr*this.scale.y;var r=this.pivot.x,a=this.pivot.y,o=t[0],s=t[1],l=this.position.x-t[0]*r-a*t[1],h=t[3],c=t[4],u=this.position.y-t[4]*a-r*t[3],d=e[0],p=e[1],f=e[2],g=e[3],b=e[4],m=e[5];t[2]=l,t[5]=u,i[0]=d*o+p*h,i[1]=d*s+p*c,i[2]=d*l+p*u+f,i[3]=g*o+b*h,i[4]=g*s+b*c,i[5]=g*l+b*u+m,this.worldAlpha=this.alpha*this.parent.worldAlpha,this.vcount=n.visibleCount},n.visibleCount=0,n.DisplayObjectContainer=function(){n.DisplayObject.call(this),this.children=[]},n.DisplayObjectContainer.prototype=Object.create(n.DisplayObject.prototype),n.DisplayObjectContainer.prototype.constructor=n.DisplayObjectContainer,n.DisplayObjectContainer.prototype.addChild=function(t){if(void 0!=t.parent&&t.parent.removeChild(t),t.parent=this,this.children.push(t),this.stage){var e=t;do e.interactive&&(this.stage.dirty=!0),e.stage=this.stage,e=e._iNext;while(e)}var i,r,n=t.first,a=t.last;r=this.filter?this.last._iPrev:this.last,i=r._iNext;for(var o=this,s=r;o;)o.last==s&&(o.last=t.last),o=o.parent;i&&(i._iPrev=a,a._iNext=i),n._iPrev=r,r._iNext=n,this.__renderGroup&&(t.__renderGroup&&t.__renderGroup.removeDisplayObjectAndChildren(t),this.__renderGroup.addDisplayObjectAndChildren(t))},n.DisplayObjectContainer.prototype.addChildAt=function(t,e){if(!(e>=0&&e<=this.children.length))throw new Error(t+" The index "+e+" supplied is out of bounds "+this.children.length);if(void 0!=t.parent&&t.parent.removeChild(t),t.parent=this,this.stage){var i=t;do i.interactive&&(this.stage.dirty=!0),i.stage=this.stage,i=i._iNext;while(i)}var r,n,a=t.first,o=t.last;if(e==this.children.length){n=this.last;for(var s=this,l=this.last;s;)s.last==l&&(s.last=t.last),s=s.parent}else n=0==e?this:this.children[e-1].last;r=n._iNext,r&&(r._iPrev=o,o._iNext=r),a._iPrev=n,n._iNext=a,this.children.splice(e,0,t),this.__renderGroup&&(t.__renderGroup&&t.__renderGroup.removeDisplayObjectAndChildren(t),this.__renderGroup.addDisplayObjectAndChildren(t))},n.DisplayObjectContainer.prototype.swapChildren=function(){},n.DisplayObjectContainer.prototype.getChildAt=function(t){if(t>=0&&t<this.children.length)return this.children[t];throw new Error(child+" Both the supplied DisplayObjects must be a child of the caller "+this)},n.DisplayObjectContainer.prototype.removeChild=function(t){var e=this.children.indexOf(t);if(-1===e)throw new Error(t+" The supplied DisplayObject must be a child of the caller "+this);var i=t.first,r=t.last,n=r._iNext,a=i._iPrev;if(n&&(n._iPrev=a),a._iNext=n,this.last==r)for(var o=i._iPrev,s=this;s.last==r.last&&(s.last=o,s=s.parent););if(r._iNext=null,i._iPrev=null,this.stage){var l=t;do l.interactive&&(this.stage.dirty=!0),l.stage=null,l=l._iNext;while(l)}t.__renderGroup&&t.__renderGroup.removeDisplayObjectAndChildren(t),t.parent=void 0,this.children.splice(e,1)},n.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible){n.DisplayObject.prototype.updateTransform.call(this);for(var t=0,e=this.children.length;e>t;t++)this.children[t].updateTransform()}},n.blendModes={},n.blendModes.NORMAL=0,n.blendModes.SCREEN=1,n.Sprite=function(t){n.DisplayObjectContainer.call(this),this.anchor=new n.Point,this.texture=t,this.blendMode=n.blendModes.NORMAL,this._width=0,this._height=0,t.baseTexture.hasLoaded?this.updateFrame=!0:(this.onTextureUpdateBind=this.onTextureUpdate.bind(this),this.texture.addEventListener("update",this.onTextureUpdateBind)),this.renderable=!0},n.Sprite.prototype=Object.create(n.DisplayObjectContainer.prototype),n.Sprite.prototype.constructor=n.Sprite,Object.defineProperty(n.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(t){this.scale.x=t/this.texture.frame.width,this._width=t}}),Object.defineProperty(n.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(t){this.scale.y=t/this.texture.frame.height,this._height=t}}),n.Sprite.prototype.setTexture=function(t){this.texture.baseTexture!=t.baseTexture?(this.textureChange=!0,this.texture=t,this.__renderGroup&&this.__renderGroup.updateTexture(this)):this.texture=t,this.updateFrame=!0},n.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width),this._height&&(this.scale.y=this._height/this.texture.frame.height),this.updateFrame=!0},n.Sprite.fromFrame=function(t){var e=n.TextureCache[t];if(!e)throw new Error("The frameId '"+t+"' does not exist in the texture cache"+this);return new n.Sprite(e)},n.Sprite.fromImage=function(t){var e=n.Texture.fromImage(t);return new n.Sprite(e)},n.MovieClip=function(t){n.Sprite.call(this,t[0]),this.textures=t,this.animationSpeed=1,this.loop=!0,this.onComplete=null,this.currentFrame=0,this.playing=!1},n.MovieClip.prototype=Object.create(n.Sprite.prototype),n.MovieClip.prototype.constructor=n.MovieClip,n.MovieClip.prototype.stop=function(){this.playing=!1},n.MovieClip.prototype.play=function(){this.playing=!0},n.MovieClip.prototype.gotoAndStop=function(t){this.playing=!1,this.currentFrame=t;var e=this.currentFrame+.5|0;this.setTexture(this.textures[e%this.textures.length])},n.MovieClip.prototype.gotoAndPlay=function(t){this.currentFrame=t,this.playing=!0},n.MovieClip.prototype.updateTransform=function(){if(n.Sprite.prototype.updateTransform.call(this),this.playing){this.currentFrame+=this.animationSpeed;var t=this.currentFrame+.5|0;this.loop||t<this.textures.length?this.setTexture(this.textures[t%this.textures.length]):t>=this.textures.length&&(this.gotoAndStop(this.textures.length-1),this.onComplete&&this.onComplete())}},n.FilterBlock=function(t){this.graphics=t,this.visible=!0,this.renderable=!0},n.Text=function(t,e){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),n.Sprite.call(this,n.Texture.fromCanvas(this.canvas)),this.setText(t),this.setStyle(e),this.updateText(),this.dirty=!1},n.Text.prototype=Object.create(n.Sprite.prototype),n.Text.prototype.constructor=n.Text,n.Text.prototype.setStyle=function(t){t=t||{},t.font=t.font||"bold 20pt Arial",t.fill=t.fill||"black",t.align=t.align||"left",t.stroke=t.stroke||"black",t.strokeThickness=t.strokeThickness||0,t.wordWrap=t.wordWrap||!1,t.wordWrapWidth=t.wordWrapWidth||100,this.style=t,this.dirty=!0},n.Sprite.prototype.setText=function(t){this.text=t.toString()||" ",this.dirty=!0},n.Text.prototype.updateText=function(){this.context.font=this.style.font;var t=this.text;this.style.wordWrap&&(t=this.wordWrap(this.text));for(var e=t.split(/(?:\r\n|\r|\n)/),i=[],r=0,a=0;a<e.length;a++){var o=this.context.measureText(e[a]).width;i[a]=o,r=Math.max(r,o)}this.canvas.width=r+this.style.strokeThickness;var s=this.determineFontHeight("font: "+this.style.font+";")+this.style.strokeThickness;for(this.canvas.height=s*e.length,this.context.fillStyle=this.style.fill,this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.lineWidth=this.style.strokeThickness,this.context.textBaseline="top",a=0;a<e.length;a++){var l=new n.Point(this.style.strokeThickness/2,this.style.strokeThickness/2+a*s);"right"==this.style.align?l.x+=r-i[a]:"center"==this.style.align&&(l.x+=(r-i[a])/2),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(e[a],l.x,l.y),this.style.fill&&this.context.fillText(e[a],l.x,l.y)}this.updateTexture()},n.Text.prototype.updateTexture=function(){this.texture.baseTexture.width=this.canvas.width,this.texture.baseTexture.height=this.canvas.height,this.texture.frame.width=this.canvas.width,this.texture.frame.height=this.canvas.height,this._width=this.canvas.width,this._height=this.canvas.height,n.texturesToUpdate.push(this.texture.baseTexture)},n.Text.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1),n.Sprite.prototype.updateTransform.call(this)},n.Text.prototype.determineFontHeight=function(t){var e=n.Text.heightCache[t];if(!e){var i=document.getElementsByTagName("body")[0],r=document.createElement("div"),a=document.createTextNode("M");r.appendChild(a),r.setAttribute("style",t+";position:absolute;top:0;left:0"),i.appendChild(r),e=r.offsetHeight,n.Text.heightCache[t]=e,i.removeChild(r)}return e},n.Text.prototype.wordWrap=function(t){for(var e=function(t,e,i,r,n){var a=Math.floor((r-i)/2)+i;return a==i?1:t.measureText(e.substring(0,a)).width<=n?t.measureText(e.substring(0,a+1)).width>n?a:arguments.callee(t,e,a,r,n):arguments.callee(t,e,i,a,n)},i=function(t,i,r){if(t.measureText(i).width<=r||i.length<1)return i;var n=e(t,i,0,i.length,r);return i.substring(0,n)+"\n"+arguments.callee(t,i.substring(n),r)},r="",n=t.split("\n"),a=0;a<n.length;a++)r+=i(this.context,n[a],this.style.wordWrapWidth)+"\n";return r},n.Text.prototype.destroy=function(t){t&&this.texture.destroy()},n.Text.heightCache={},n.BitmapText=function(t,e){n.DisplayObjectContainer.call(this),this.setText(t),this.setStyle(e),this.updateText(),this.dirty=!1},n.BitmapText.prototype=Object.create(n.DisplayObjectContainer.prototype),n.BitmapText.prototype.constructor=n.BitmapText,n.BitmapText.prototype.setText=function(t){this.text=t||" ",this.dirty=!0},n.BitmapText.prototype.setStyle=function(t){t=t||{},t.align=t.align||"left",this.style=t;var e=t.font.split(" ");this.fontName=e[e.length-1],this.fontSize=e.length>=2?parseInt(e[e.length-2],10):n.BitmapText.fonts[this.fontName].size,this.dirty=!0},n.BitmapText.prototype.updateText=function(){for(var t=n.BitmapText.fonts[this.fontName],e=new n.Point,i=null,r=[],a=0,o=[],s=0,l=this.fontSize/t.size,h=0;h<this.text.length;h++){var c=this.text.charCodeAt(h);if(/(?:\r\n|\r|\n)/.test(this.text.charAt(h)))o.push(e.x),a=Math.max(a,e.x),s++,e.x=0,e.y+=t.lineHeight,i=null;else{var u=t.chars[c];u&&(i&&u[i]&&(e.x+=u.kerning[i]),r.push({texture:u.texture,line:s,charCode:c,position:new n.Point(e.x+u.xOffset,e.y+u.yOffset)}),e.x+=u.xAdvance,i=c)}}o.push(e.x),a=Math.max(a,e.x);var d=[];for(h=0;s>=h;h++){var p=0;"right"==this.style.align?p=a-o[h]:"center"==this.style.align&&(p=(a-o[h])/2),d.push(p)}for(h=0;h<r.length;h++){var f=new n.Sprite(r[h].texture);f.position.x=(r[h].position.x+d[r[h].line])*l,f.position.y=r[h].position.y*l,f.scale.x=f.scale.y=l,this.addChild(f)
}this.width=e.x*l,this.height=(e.y+t.lineHeight)*l},n.BitmapText.prototype.updateTransform=function(){if(this.dirty){for(;this.children.length>0;)this.removeChild(this.getChildAt(0));this.updateText(),this.dirty=!1}n.DisplayObjectContainer.prototype.updateTransform.call(this)},n.BitmapText.fonts={},n.InteractionManager=function(t){this.stage=t,this.mouse=new n.InteractionData,this.touchs={},this.tempPoint=new n.Point,this.mouseoverEnabled=!0,this.pool=[],this.interactiveItems=[],this.last=0},n.InteractionManager.prototype.constructor=n.InteractionManager,n.InteractionManager.prototype.collectInteractiveSprite=function(t,e){for(var i=t.children,r=i.length,n=r-1;n>=0;n--){var a=i[n];a.interactive?(e.interactiveChildren=!0,this.interactiveItems.push(a),a.children.length>0&&this.collectInteractiveSprite(a,a)):(a.__iParent=null,a.children.length>0&&this.collectInteractiveSprite(a,e))}},n.InteractionManager.prototype.setTarget=function(t){window.navigator.msPointerEnabled&&(t.view.style["-ms-content-zooming"]="none",t.view.style["-ms-touch-action"]="none"),this.target=t,t.view.addEventListener("mousemove",this.onMouseMove.bind(this),!0),t.view.addEventListener("mousedown",this.onMouseDown.bind(this),!0),document.body.addEventListener("mouseup",this.onMouseUp.bind(this),!0),t.view.addEventListener("mouseout",this.onMouseOut.bind(this),!0),t.view.addEventListener("touchstart",this.onTouchStart.bind(this),!0),t.view.addEventListener("touchend",this.onTouchEnd.bind(this),!0),t.view.addEventListener("touchmove",this.onTouchMove.bind(this),!0)},n.InteractionManager.prototype.update=function(){if(this.target){var t=Date.now(),e=t-this.last;if(e=30*e/1e3,!(1>e)){if(this.last=t,this.dirty){this.dirty=!1;for(var i=this.interactiveItems.length,r=0;i>r;r++)this.interactiveItems[r].interactiveChildren=!1;this.interactiveItems=[],this.stage.interactive&&this.interactiveItems.push(this.stage),this.collectInteractiveSprite(this.stage,this.stage)}var n=this.interactiveItems.length;this.target.view.style.cursor="default";for(var r=0;n>r;r++){var a=this.interactiveItems[r];(a.mouseover||a.mouseout||a.buttonMode)&&(a.__hit=this.hitTest(a,this.mouse),this.mouse.target=a,a.__hit?(a.buttonMode&&(this.target.view.style.cursor="pointer"),a.__isOver||(a.mouseover&&a.mouseover(this.mouse),a.__isOver=!0)):a.__isOver&&(a.mouseout&&a.mouseout(this.mouse),a.__isOver=!1))}}}},n.InteractionManager.prototype.onMouseMove=function(t){this.mouse.originalEvent=t||window.event;var e=this.target.view.getBoundingClientRect();this.mouse.global.x=(t.clientX-e.left)*(this.target.width/e.width),this.mouse.global.y=(t.clientY-e.top)*(this.target.height/e.height);for(var i=this.interactiveItems.length,r=(this.mouse.global,0);i>r;r++){var n=this.interactiveItems[r];n.mousemove&&n.mousemove(this.mouse)}},n.InteractionManager.prototype.onMouseDown=function(t){this.mouse.originalEvent=t||window.event;for(var e=this.interactiveItems.length,i=(this.mouse.global,this.stage,0);e>i;i++){var r=this.interactiveItems[i];if((r.mousedown||r.click)&&(r.__mouseIsDown=!0,r.__hit=this.hitTest(r,this.mouse),r.__hit&&(r.mousedown&&r.mousedown(this.mouse),r.__isDown=!0,!r.interactiveChildren)))break}},n.InteractionManager.prototype.onMouseOut=function(){var t=this.interactiveItems.length;this.target.view.style.cursor="default";for(var e=0;t>e;e++){var i=this.interactiveItems[e];i.__isOver&&(this.mouse.target=i,i.mouseout&&i.mouseout(this.mouse),i.__isOver=!1)}},n.InteractionManager.prototype.onMouseUp=function(t){this.mouse.originalEvent=t||window.event;for(var e=(this.mouse.global,this.interactiveItems.length),i=!1,r=0;e>r;r++){var n=this.interactiveItems[r];(n.mouseup||n.mouseupoutside||n.click)&&(n.__hit=this.hitTest(n,this.mouse),n.__hit&&!i?(n.mouseup&&n.mouseup(this.mouse),n.__isDown&&n.click&&n.click(this.mouse),n.interactiveChildren||(i=!0)):n.__isDown&&n.mouseupoutside&&n.mouseupoutside(this.mouse),n.__isDown=!1)}},n.InteractionManager.prototype.hitTest=function(t,e){var i=e.global;if(t.vcount!==n.visibleCount)return!1;var r=t instanceof n.Sprite,a=t.worldTransform,o=a[0],s=a[1],l=a[2],h=a[3],c=a[4],u=a[5],d=1/(o*c+s*-h),p=c*d*i.x+-s*d*i.y+(u*s-l*c)*d,f=o*d*i.y+-h*d*i.x+(-u*o+l*h)*d;if(e.target=t,t.hitArea&&t.hitArea.contains)return t.hitArea.contains(p,f)?(e.target=t,!0):!1;if(r){var g,b=t.texture.frame.width,m=t.texture.frame.height,v=-b*t.anchor.x;if(p>v&&v+b>p&&(g=-m*t.anchor.y,f>g&&g+m>f))return e.target=t,!0}for(var y=t.children.length,x=0;y>x;x++){var T=t.children[x],w=this.hitTest(T,e);if(w)return e.target=t,!0}return!1},n.InteractionManager.prototype.onTouchMove=function(t){for(var e=this.target.view.getBoundingClientRect(),i=t.changedTouches,r=0;r<i.length;r++){var n=i[r],a=this.touchs[n.identifier];a.originalEvent=t||window.event,a.global.x=(n.clientX-e.left)*(this.target.width/e.width),a.global.y=(n.clientY-e.top)*(this.target.height/e.height)}for(var o=this.interactiveItems.length,r=0;o>r;r++){var s=this.interactiveItems[r];s.touchmove&&s.touchmove(a)}},n.InteractionManager.prototype.onTouchStart=function(t){for(var e=this.target.view.getBoundingClientRect(),i=t.changedTouches,r=0;r<i.length;r++){var a=i[r],o=this.pool.pop();o||(o=new n.InteractionData),o.originalEvent=t||window.event,this.touchs[a.identifier]=o,o.global.x=(a.clientX-e.left)*(this.target.width/e.width),o.global.y=(a.clientY-e.top)*(this.target.height/e.height);for(var s=this.interactiveItems.length,l=0;s>l;l++){var h=this.interactiveItems[l];if((h.touchstart||h.tap)&&(h.__hit=this.hitTest(h,o),h.__hit&&(h.touchstart&&h.touchstart(o),h.__isDown=!0,h.__touchData=o,!h.interactiveChildren)))break}}},n.InteractionManager.prototype.onTouchEnd=function(t){for(var e=this.target.view.getBoundingClientRect(),i=t.changedTouches,r=0;r<i.length;r++){var n=i[r],a=this.touchs[n.identifier],o=!1;a.global.x=(n.clientX-e.left)*(this.target.width/e.width),a.global.y=(n.clientY-e.top)*(this.target.height/e.height);for(var s=this.interactiveItems.length,l=0;s>l;l++){var h=this.interactiveItems[l],c=h.__touchData;h.__hit=this.hitTest(h,a),c==a&&(a.originalEvent=t||window.event,(h.touchend||h.tap)&&(h.__hit&&!o?(h.touchend&&h.touchend(a),h.__isDown&&h.tap&&h.tap(a),h.interactiveChildren||(o=!0)):h.__isDown&&h.touchendoutside&&h.touchendoutside(a),h.__isDown=!1),h.__touchData=null)}this.pool.push(a),this.touchs[n.identifier]=null}},n.InteractionData=function(){this.global=new n.Point,this.local=new n.Point,this.target,this.originalEvent},n.InteractionData.prototype.getLocalPosition=function(t){var e=t.worldTransform,i=this.global,r=e[0],a=e[1],o=e[2],s=e[3],l=e[4],h=e[5],c=1/(r*l+a*-s);return new n.Point(l*c*i.x+-a*c*i.y+(h*a-o*l)*c,r*c*i.y+-s*c*i.x+(-h*r+o*s)*c)},n.InteractionData.prototype.constructor=n.InteractionData,n.Stage=function(t,e){n.DisplayObjectContainer.call(this),this.worldTransform=n.mat3.create(),this.interactive=e,this.interactionManager=new n.InteractionManager(this),this.dirty=!0,this.__childrenAdded=[],this.__childrenRemoved=[],this.stage=this,this.stage.hitArea=new n.Rectangle(0,0,1e5,1e5),this.setBackgroundColor(t),this.worldVisible=!0},n.Stage.prototype=Object.create(n.DisplayObjectContainer.prototype),n.Stage.prototype.constructor=n.Stage,n.Stage.prototype.updateTransform=function(){this.worldAlpha=1,this.vcount=n.visibleCount;for(var t=0,e=this.children.length;e>t;t++)this.children[t].updateTransform();this.dirty&&(this.dirty=!1,this.interactionManager.dirty=!0),this.interactive&&this.interactionManager.update()},n.Stage.prototype.setBackgroundColor=function(t){this.backgroundColor=t||0,this.backgroundColorSplit=e(this.backgroundColor);var i=this.backgroundColor.toString(16);i="000000".substr(0,6-i.length)+i,this.backgroundColorString="#"+i},n.Stage.prototype.getMousePosition=function(){return this.interactionManager.mouse.global};for(var o=0,s=["ms","moz","webkit","o"],l=0;l<s.length&&!window.requestAnimationFrame;++l)window.requestAnimationFrame=window[s[l]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[s[l]+"CancelAnimationFrame"]||window[s[l]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var e=(new Date).getTime(),i=Math.max(0,16-(e-o)),r=window.setTimeout(function(){t(e+i)},i);return o=e+i,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)}),window.requestAnimFrame=window.requestAnimationFrame,"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(){var t=Array.prototype.slice;return function(e){function i(){var a=n.concat(t.call(arguments));r.apply(this instanceof i?this:e,a)}var r=this,n=t.call(arguments,1);if("function"!=typeof r)throw new TypeError;return i.prototype=function a(t){return t&&(a.prototype=t),this instanceof a?void 0:new a}(r.prototype),i}}());var h=n.AjaxRequest=function(){var t=["Msxml2.XMLHTTP","Microsoft.XMLHTTP"];if(!window.ActiveXObject)return window.XMLHttpRequest?new XMLHttpRequest:!1;for(var e=0;e<t.length;e++)try{return new ActiveXObject(t[e])}catch(i){}};n.runList=function(t){console.log(">>>>>>>>>"),console.log("_");var e=0,i=t.first;for(console.log(i);i._iNext;)if(e++,i=i._iNext,console.log(i),e>100){console.log("BREAK");break}},n.EventTarget=function(){var t={};this.addEventListener=this.on=function(e,i){void 0===t[e]&&(t[e]=[]),-1===t[e].indexOf(i)&&t[e].push(i)},this.dispatchEvent=this.emit=function(e){for(var i in t[e.type])t[e.type][i](e)},this.removeEventListener=this.off=function(e,i){var r=t[e].indexOf(i);-1!==r&&t[e].splice(r,1)}},n.autoDetectRenderer=function(t,e,i,r,a){t||(t=800),e||(e=600);var o=function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(t){return!1}}();if(o){var s=-1!=navigator.userAgent.toLowerCase().indexOf("msie");o=!s}return o?new n.WebGLRenderer(t,e,i,r,a):new n.CanvasRenderer(t,e,i,r)},n.PolyK={},n.PolyK.Triangulate=function(t){var e=!0,i=t.length>>1;if(3>i)return[];for(var r=[],a=[],o=0;i>o;o++)a.push(o);for(var o=0,s=i;s>3;){var l=a[(o+0)%s],h=a[(o+1)%s],c=a[(o+2)%s],u=t[2*l],d=t[2*l+1],p=t[2*h],f=t[2*h+1],g=t[2*c],b=t[2*c+1],m=!1;if(n.PolyK._convex(u,d,p,f,g,b,e)){m=!0;for(var v=0;s>v;v++){var y=a[v];if(y!=l&&y!=h&&y!=c&&n.PolyK._PointInTriangle(t[2*y],t[2*y+1],u,d,p,f,g,b)){m=!1;break}}}if(m)r.push(l,h,c),a.splice((o+1)%s,1),s--,o=0;else if(o++>3*s){if(!e)return console.log("PIXI Warning: shape too complex to fill"),[];var r=[];a=[];for(var o=0;i>o;o++)a.push(o);o=0,s=i,e=!1}}return r.push(a[0],a[1],a[2]),r},n.PolyK._PointInTriangle=function(t,e,i,r,n,a,o,s){var l=o-i,h=s-r,c=n-i,u=a-r,d=t-i,p=e-r,f=l*l+h*h,g=l*c+h*u,b=l*d+h*p,m=c*c+u*u,v=c*d+u*p,y=1/(f*m-g*g),x=(m*b-g*v)*y,T=(f*v-g*b)*y;return x>=0&&T>=0&&1>x+T},n.PolyK._convex=function(t,e,i,r,n,a,o){return(e-r)*(n-i)+(i-t)*(a-r)>=0==o},n.shaderFragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y));","gl_FragColor = gl_FragColor * vColor;","}"],n.shaderVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","varying vec2 vTextureCoord;","varying float vColor;","void main(void) {","gl_Position = vec4( aVertexPosition.x / projectionVector.x -1.0, aVertexPosition.y / -projectionVector.y + 1.0 , 0.0, 1.0);","vTextureCoord = aTextureCoord;","vColor = aColor;","}"],n.stripShaderFragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying float vColor;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y));","gl_FragColor = gl_FragColor * alpha;","}"],n.stripShaderVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","varying vec2 vTextureCoord;","varying float vColor;","void main(void) {","vec3 v = translationMatrix * vec3(aVertexPosition, 1.0);","gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","vTextureCoord = aTextureCoord;","vColor = aColor;","}"],n.primitiveShaderFragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","gl_FragColor = vColor;","}"],n.primitiveShaderVertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform float alpha;","varying vec4 vColor;","void main(void) {","vec3 v = translationMatrix * vec3(aVertexPosition, 1.0);","gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","vColor = aColor  * alpha;","}"],n.initPrimitiveShader=function(){var t=n.gl,e=n.compileProgram(n.primitiveShaderVertexSrc,n.primitiveShaderFragmentSrc);t.useProgram(e),e.vertexPositionAttribute=t.getAttribLocation(e,"aVertexPosition"),e.colorAttribute=t.getAttribLocation(e,"aColor"),e.projectionVector=t.getUniformLocation(e,"projectionVector"),e.translationMatrix=t.getUniformLocation(e,"translationMatrix"),e.alpha=t.getUniformLocation(e,"alpha"),n.primitiveProgram=e},n.initDefaultShader=function(){var t=this.gl,e=n.compileProgram(n.shaderVertexSrc,n.shaderFragmentSrc);t.useProgram(e),e.vertexPositionAttribute=t.getAttribLocation(e,"aVertexPosition"),e.projectionVector=t.getUniformLocation(e,"projectionVector"),e.textureCoordAttribute=t.getAttribLocation(e,"aTextureCoord"),e.colorAttribute=t.getAttribLocation(e,"aColor"),e.samplerUniform=t.getUniformLocation(e,"uSampler"),n.shaderProgram=e},n.initDefaultStripShader=function(){var t=this.gl,e=n.compileProgram(n.stripShaderVertexSrc,n.stripShaderFragmentSrc);t.useProgram(e),e.vertexPositionAttribute=t.getAttribLocation(e,"aVertexPosition"),e.projectionVector=t.getUniformLocation(e,"projectionVector"),e.textureCoordAttribute=t.getAttribLocation(e,"aTextureCoord"),e.translationMatrix=t.getUniformLocation(e,"translationMatrix"),e.alpha=t.getUniformLocation(e,"alpha"),e.colorAttribute=t.getAttribLocation(e,"aColor"),e.projectionVector=t.getUniformLocation(e,"projectionVector"),e.samplerUniform=t.getUniformLocation(e,"uSampler"),n.stripShaderProgram=e},n.CompileVertexShader=function(t,e){return n._CompileShader(t,e,t.VERTEX_SHADER)},n.CompileFragmentShader=function(t,e){return n._CompileShader(t,e,t.FRAGMENT_SHADER)},n._CompileShader=function(t,e,i){var r=e.join("\n"),n=t.createShader(i);return t.shaderSource(n,r),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)?n:(alert(t.getShaderInfoLog(n)),null)},n.compileProgram=function(t,e){var i=n.gl,r=n.CompileFragmentShader(i,e),a=n.CompileVertexShader(i,t),o=i.createProgram();return i.attachShader(o,a),i.attachShader(o,r),i.linkProgram(o),i.getProgramParameter(o,i.LINK_STATUS)||alert("Could not initialise shaders"),o},n.activateDefaultShader=function(){var t=n.gl,e=n.shaderProgram;t.useProgram(e),t.enableVertexAttribArray(e.vertexPositionAttribute),t.enableVertexAttribArray(e.textureCoordAttribute),t.enableVertexAttribArray(e.colorAttribute)},n.activatePrimitiveShader=function(){var t=n.gl;t.disableVertexAttribArray(n.shaderProgram.textureCoordAttribute),t.disableVertexAttribArray(n.shaderProgram.colorAttribute),t.useProgram(n.primitiveProgram),t.enableVertexAttribArray(n.primitiveProgram.vertexPositionAttribute),t.enableVertexAttribArray(n.primitiveProgram.colorAttribute)},n.WebGLGraphics=function(){},n.WebGLGraphics.renderGraphics=function(t,e){var i=n.gl;t._webGL||(t._webGL={points:[],indices:[],lastIndex:0,buffer:i.createBuffer(),indexBuffer:i.createBuffer()}),t.dirty&&(t.dirty=!1,t.clearDirty&&(t.clearDirty=!1,t._webGL.lastIndex=0,t._webGL.points=[],t._webGL.indices=[]),n.WebGLGraphics.updateGraphics(t)),n.activatePrimitiveShader();var r=n.mat3.clone(t.worldTransform);n.mat3.transpose(r),i.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA),i.uniformMatrix3fv(n.primitiveProgram.translationMatrix,!1,r),i.uniform2f(n.primitiveProgram.projectionVector,e.x,e.y),i.uniform1f(n.primitiveProgram.alpha,t.worldAlpha),i.bindBuffer(i.ARRAY_BUFFER,t._webGL.buffer),i.vertexAttribPointer(n.shaderProgram.vertexPositionAttribute,2,i.FLOAT,!1,0,0),i.vertexAttribPointer(n.primitiveProgram.vertexPositionAttribute,2,i.FLOAT,!1,24,0),i.vertexAttribPointer(n.primitiveProgram.colorAttribute,4,i.FLOAT,!1,24,8),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t._webGL.indexBuffer),i.drawElements(i.TRIANGLE_STRIP,t._webGL.indices.length,i.UNSIGNED_SHORT,0),n.activateDefaultShader()},n.WebGLGraphics.updateGraphics=function(t){for(var e=t._webGL.lastIndex;e<t.graphicsData.length;e++){var i=t.graphicsData[e];i.type==n.Graphics.POLY?(i.fill&&i.points.length>3&&n.WebGLGraphics.buildPoly(i,t._webGL),i.lineWidth>0&&n.WebGLGraphics.buildLine(i,t._webGL)):i.type==n.Graphics.RECT?n.WebGLGraphics.buildRectangle(i,t._webGL):(i.type==n.Graphics.CIRC||i.type==n.Graphics.ELIP)&&n.WebGLGraphics.buildCircle(i,t._webGL)}t._webGL.lastIndex=t.graphicsData.length;var r=n.gl;t._webGL.glPoints=new Float32Array(t._webGL.points),r.bindBuffer(r.ARRAY_BUFFER,t._webGL.buffer),r.bufferData(r.ARRAY_BUFFER,t._webGL.glPoints,r.STATIC_DRAW),t._webGL.glIndicies=new Uint16Array(t._webGL.indices),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t._webGL.indexBuffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,t._webGL.glIndicies,r.STATIC_DRAW)},n.WebGLGraphics.buildRectangle=function(t,i){var r=t.points,a=r[0],o=r[1],s=r[2],l=r[3];if(t.fill){var h=e(t.fillColor),c=t.fillAlpha,u=h[0]*c,d=h[1]*c,p=h[2]*c,f=i.points,g=i.indices,b=f.length/6;f.push(a,o),f.push(u,d,p,c),f.push(a+s,o),f.push(u,d,p,c),f.push(a,o+l),f.push(u,d,p,c),f.push(a+s,o+l),f.push(u,d,p,c),g.push(b,b,b+1,b+2,b+3,b+3)}t.lineWidth&&(t.points=[a,o,a+s,o,a+s,o+l,a,o+l,a,o],n.WebGLGraphics.buildLine(t,i))},n.WebGLGraphics.buildCircle=function(t,i){var r=t.points,a=r[0],o=r[1],s=r[2],l=r[3],h=40,c=2*Math.PI/h;if(t.fill){var u=e(t.fillColor),d=t.fillAlpha,p=u[0]*d,f=u[1]*d,g=u[2]*d,b=i.points,m=i.indices,v=b.length/6;m.push(v);for(var y=0;h+1>y;y++)b.push(a,o,p,f,g,d),b.push(a+Math.sin(c*y)*s,o+Math.cos(c*y)*l,p,f,g,d),m.push(v++,v++);m.push(v-1)}if(t.lineWidth){t.points=[];for(var y=0;h+1>y;y++)t.points.push(a+Math.sin(c*y)*s,o+Math.cos(c*y)*l);n.WebGLGraphics.buildLine(t,i)}},n.WebGLGraphics.buildLine=function(t,i){var r=t.points;if(0!=r.length){var a=new n.Point(r[0],r[1]),o=new n.Point(r[r.length-2],r[r.length-1]);if(a.x==o.x&&a.y==o.y){r.pop(),r.pop(),o=new n.Point(r[r.length-2],r[r.length-1]);var s=o.x+.5*(a.x-o.x),l=o.y+.5*(a.y-o.y);r.unshift(s,l),r.push(s,l)}var h,c,u,d,p,f,g,b,m,v,y,x,T,w,_,A,S,C,E,R,j,L=i.points,I=i.indices,P=r.length/2,k=r.length,B=L.length/6,G=t.lineWidth/2,F=e(t.lineColor),O=t.lineAlpha,D=F[0]*O,N=F[1]*O,M=F[2]*O;h=r[0],c=r[1],u=r[2],d=r[3],g=-(c-d),b=h-u,j=Math.sqrt(g*g+b*b),g/=j,b/=j,g*=G,b*=G,L.push(h-g,c-b,D,N,M,O),L.push(h+g,c+b,D,N,M,O);for(var W=1;P-1>W;W++)h=r[2*(W-1)],c=r[2*(W-1)+1],u=r[2*W],d=r[2*W+1],p=r[2*(W+1)],f=r[2*(W+1)+1],g=-(c-d),b=h-u,j=Math.sqrt(g*g+b*b),g/=j,b/=j,g*=G,b*=G,m=-(d-f),v=u-p,j=Math.sqrt(m*m+v*v),m/=j,v/=j,m*=G,v*=G,T=-b+c-(-b+d),w=-g+u-(-g+h),_=(-g+h)*(-b+d)-(-g+u)*(-b+c),A=-v+f-(-v+d),S=-m+u-(-m+p),C=(-m+p)*(-v+d)-(-m+u)*(-v+f),E=T*S-A*w,0==E&&(E+=1),px=(w*C-S*_)/E,py=(A*_-T*C)/E,R=(px-u)*(px-u)+(py-d)+(py-d),R>19600?(y=g-m,x=b-v,j=Math.sqrt(y*y+x*x),y/=j,x/=j,y*=G,x*=G,L.push(u-y,d-x),L.push(D,N,M,O),L.push(u+y,d+x),L.push(D,N,M,O),L.push(u-y,d-x),L.push(D,N,M,O),k++):(L.push(px,py),L.push(D,N,M,O),L.push(u-(px-u),d-(py-d)),L.push(D,N,M,O));h=r[2*(P-2)],c=r[2*(P-2)+1],u=r[2*(P-1)],d=r[2*(P-1)+1],g=-(c-d),b=h-u,j=Math.sqrt(g*g+b*b),g/=j,b/=j,g*=G,b*=G,L.push(u-g,d-b),L.push(D,N,M,O),L.push(u+g,d+b),L.push(D,N,M,O),I.push(B);for(var W=0;k>W;W++)I.push(B++);I.push(B-1)}},n.WebGLGraphics.buildPoly=function(t,i){var r=t.points;if(!(r.length<6)){for(var a=i.points,o=i.indices,s=r.length/2,l=e(t.fillColor),h=t.fillAlpha,c=l[0]*h,u=l[1]*h,d=l[2]*h,p=n.PolyK.Triangulate(r),f=a.length/6,g=0;g<p.length;g+=3)o.push(p[g]+f),o.push(p[g]+f),o.push(p[g+1]+f),o.push(p[g+2]+f),o.push(p[g+2]+f);for(var g=0;s>g;g++)a.push(r[2*g],r[2*g+1],c,u,d,h)}},n._defaultFrame=new n.Rectangle(0,0,1,1),n.gl,n.WebGLRenderer=function(t,e,i,r,a){this.transparent=!!r,this.width=t||800,this.height=e||600,this.view=i||document.createElement("canvas"),this.view.width=this.width,this.view.height=this.height;var o=this;this.view.addEventListener("webglcontextlost",function(t){o.handleContextLost(t)},!1),this.view.addEventListener("webglcontextrestored",function(t){o.handleContextRestored(t)},!1),this.batchs=[];try{n.gl=this.gl=this.view.getContext("experimental-webgl",{alpha:this.transparent,antialias:!!a,premultipliedAlpha:!1,stencil:!0})}catch(s){throw new Error(" This browser does not support webGL. Try using the canvas renderer"+this)}n.initPrimitiveShader(),n.initDefaultShader(),n.initDefaultStripShader(),n.activateDefaultShader();var l=this.gl;n.WebGLRenderer.gl=l,this.batch=new n.WebGLBatch(l),l.disable(l.DEPTH_TEST),l.disable(l.CULL_FACE),l.enable(l.BLEND),l.colorMask(!0,!0,!0,this.transparent),n.projection=new n.Point(400,300),this.resize(this.width,this.height),this.contextLost=!1,this.stageRenderGroup=new n.WebGLRenderGroup(this.gl)},n.WebGLRenderer.prototype.constructor=n.WebGLRenderer,n.WebGLRenderer.getBatch=function(){return 0==n._batchs.length?new n.WebGLBatch(n.WebGLRenderer.gl):n._batchs.pop()},n.WebGLRenderer.returnBatch=function(t){t.clean(),n._batchs.push(t)},n.WebGLRenderer.prototype.render=function(t){if(!this.contextLost){this.__stage!==t&&(this.__stage=t,this.stageRenderGroup.setRenderable(t)),n.WebGLRenderer.updateTextures(),n.visibleCount++,t.updateTransform();var e=this.gl;if(e.colorMask(!0,!0,!0,this.transparent),e.viewport(0,0,this.width,this.height),e.bindFramebuffer(e.FRAMEBUFFER,null),e.clearColor(t.backgroundColorSplit[0],t.backgroundColorSplit[1],t.backgroundColorSplit[2],!this.transparent),e.clear(e.COLOR_BUFFER_BIT),this.stageRenderGroup.backgroundColor=t.backgroundColorSplit,this.stageRenderGroup.render(n.projection),t.interactive&&(t._interactiveEventsAdded||(t._interactiveEventsAdded=!0,t.interactionManager.setTarget(this))),n.Texture.frameUpdates.length>0){for(var i=0;i<n.Texture.frameUpdates.length;i++)n.Texture.frameUpdates[i].updateFrame=!1;n.Texture.frameUpdates=[]}}},n.WebGLRenderer.updateTextures=function(){for(var t=0;t<n.texturesToUpdate.length;t++)n.WebGLRenderer.updateTexture(n.texturesToUpdate[t]);for(var t=0;t<n.texturesToDestroy.length;t++)n.WebGLRenderer.destroyTexture(n.texturesToDestroy[t]);n.texturesToUpdate=[],n.texturesToDestroy=[]},n.WebGLRenderer.updateTexture=function(t){var e=n.gl;t._glTexture||(t._glTexture=e.createTexture()),t.hasLoaded&&(e.bindTexture(e.TEXTURE_2D,t._glTexture),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t.source),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),t._powerOf2?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)),e.bindTexture(e.TEXTURE_2D,null))},n.WebGLRenderer.destroyTexture=function(t){var e=n.gl;t._glTexture&&(t._glTexture=e.createTexture(),e.deleteTexture(e.TEXTURE_2D,t._glTexture))},n.WebGLRenderer.prototype.resize=function(t,e){this.width=t,this.height=e,this.view.width=t,this.view.height=e,this.gl.viewport(0,0,this.width,this.height),n.projection.x=this.width/2,n.projection.y=this.height/2},n.WebGLRenderer.prototype.handleContextLost=function(t){t.preventDefault(),this.contextLost=!0},n.WebGLRenderer.prototype.handleContextRestored=function(){this.gl=this.view.getContext("experimental-webgl",{alpha:!0}),this.initShaders();for(var t in n.TextureCache){var e=n.TextureCache[t].baseTexture;e._glTexture=null,n.WebGLRenderer.updateTexture(e)}for(var i=0;i<this.batchs.length;i++)this.batchs[i].restoreLostContext(this.gl),this.batchs[i].dirty=!0;n._restoreBatchs(this.gl),this.contextLost=!1},n._batchs=[],n._getBatch=function(t){return 0==n._batchs.length?new n.WebGLBatch(t):n._batchs.pop()},n._returnBatch=function(t){t.clean(),n._batchs.push(t)},n._restoreBatchs=function(t){for(var e=0;e<n._batchs.length;e++)n._batchs[e].restoreLostContext(t)},n.WebGLBatch=function(t){this.gl=t,this.size=0,this.vertexBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),this.uvBuffer=t.createBuffer(),this.colorBuffer=t.createBuffer(),this.blendMode=n.blendModes.NORMAL,this.dynamicSize=1},n.WebGLBatch.prototype.constructor=n.WebGLBatch,n.WebGLBatch.prototype.clean=function(){this.verticies=[],this.uvs=[],this.indices=[],this.colors=[],this.dynamicSize=1,this.texture=null,this.last=null,this.size=0,this.head,this.tail},n.WebGLBatch.prototype.restoreLostContext=function(t){this.gl=t,this.vertexBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),this.uvBuffer=t.createBuffer(),this.colorBuffer=t.createBuffer()},n.WebGLBatch.prototype.init=function(t){t.batch=this,this.dirty=!0,this.blendMode=t.blendMode,this.texture=t.texture.baseTexture,this.head=t,this.tail=t,this.size=1,this.growBatch()},n.WebGLBatch.prototype.insertBefore=function(t,e){this.size++,t.batch=this,this.dirty=!0;var i=e.__prev;e.__prev=t,t.__next=e,i?(t.__prev=i,i.__next=t):this.head=t},n.WebGLBatch.prototype.insertAfter=function(t,e){this.size++,t.batch=this,this.dirty=!0;var i=e.__next;e.__next=t,t.__prev=e,i?(t.__next=i,i.__prev=t):this.tail=t},n.WebGLBatch.prototype.remove=function(t){return this.size--,0==this.size?(t.batch=null,t.__prev=null,void(t.__next=null)):(t.__prev?t.__prev.__next=t.__next:(this.head=t.__next,this.head.__prev=null),t.__next?t.__next.__prev=t.__prev:(this.tail=t.__prev,this.tail.__next=null),t.batch=null,t.__next=null,t.__prev=null,void(this.dirty=!0))},n.WebGLBatch.prototype.split=function(t){this.dirty=!0;var e=new n.WebGLBatch(this.gl);e.init(t),e.texture=this.texture,e.tail=this.tail,this.tail=t.__prev,this.tail.__next=null,t.__prev=null;for(var i=0;t;)i++,t.batch=e,t=t.__next;return e.size=i,this.size-=i,e},n.WebGLBatch.prototype.merge=function(t){this.dirty=!0,this.tail.__next=t.head,t.head.__prev=this.tail,this.size+=t.size,this.tail=t.tail;for(var e=t.head;e;)e.batch=this,e=e.__next},n.WebGLBatch.prototype.growBatch=function(){var t=this.gl;this.dynamicSize=1==this.size?1:1.5*this.size,this.verticies=new Float32Array(8*this.dynamicSize),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.verticies,t.DYNAMIC_DRAW),this.uvs=new Float32Array(8*this.dynamicSize),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),t.bufferData(t.ARRAY_BUFFER,this.uvs,t.DYNAMIC_DRAW),this.dirtyUVS=!0,this.colors=new Float32Array(4*this.dynamicSize),t.bindBuffer(t.ARRAY_BUFFER,this.colorBuffer),t.bufferData(t.ARRAY_BUFFER,this.colors,t.DYNAMIC_DRAW),this.dirtyColors=!0,this.indices=new Uint16Array(6*this.dynamicSize);for(var e=this.indices.length/6,i=0;e>i;i++){var r=6*i,n=4*i;this.indices[r+0]=n+0,this.indices[r+1]=n+1,this.indices[r+2]=n+2,this.indices[r+3]=n+0,this.indices[r+4]=n+2,this.indices[r+5]=n+3}t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW)},n.WebGLBatch.prototype.refresh=function(){this.gl;this.dynamicSize<this.size&&this.growBatch();for(var t,e=0,i=this.head;i;){t=8*e;var r=i.texture,n=r.frame,a=r.baseTexture.width,o=r.baseTexture.height;this.uvs[t+0]=n.x/a,this.uvs[t+1]=n.y/o,this.uvs[t+2]=(n.x+n.width)/a,this.uvs[t+3]=n.y/o,this.uvs[t+4]=(n.x+n.width)/a,this.uvs[t+5]=(n.y+n.height)/o,this.uvs[t+6]=n.x/a,this.uvs[t+7]=(n.y+n.height)/o,i.updateFrame=!1,colorIndex=4*e,this.colors[colorIndex]=this.colors[colorIndex+1]=this.colors[colorIndex+2]=this.colors[colorIndex+3]=i.worldAlpha,i=i.__next,e++}this.dirtyUVS=!0,this.dirtyColors=!0},n.WebGLBatch.prototype.update=function(){for(var t,e,i,r,a,o,s,l,h,c,u,d,p,f,g,b,m=(this.gl,0),v=this.head;v;){if(v.vcount===n.visibleCount){if(e=v.texture.frame.width,i=v.texture.frame.height,r=v.anchor.x,a=v.anchor.y,o=e*(1-r),s=e*-r,l=i*(1-a),h=i*-a,c=8*m,t=v.worldTransform,u=t[0],d=t[3],p=t[1],f=t[4],g=t[2],b=t[5],this.verticies[c+0]=u*s+p*h+g,this.verticies[c+1]=f*h+d*s+b,this.verticies[c+2]=u*o+p*h+g,this.verticies[c+3]=f*h+d*o+b,this.verticies[c+4]=u*o+p*l+g,this.verticies[c+5]=f*l+d*o+b,this.verticies[c+6]=u*s+p*l+g,this.verticies[c+7]=f*l+d*s+b,v.updateFrame||v.texture.updateFrame){this.dirtyUVS=!0;var y=v.texture,x=y.frame,T=y.baseTexture.width,w=y.baseTexture.height;this.uvs[c+0]=x.x/T,this.uvs[c+1]=x.y/w,this.uvs[c+2]=(x.x+x.width)/T,this.uvs[c+3]=x.y/w,this.uvs[c+4]=(x.x+x.width)/T,this.uvs[c+5]=(x.y+x.height)/w,this.uvs[c+6]=x.x/T,this.uvs[c+7]=(x.y+x.height)/w,v.updateFrame=!1}if(v.cacheAlpha!=v.worldAlpha){v.cacheAlpha=v.worldAlpha;var _=4*m;this.colors[_]=this.colors[_+1]=this.colors[_+2]=this.colors[_+3]=v.worldAlpha,this.dirtyColors=!0}}else c=8*m,this.verticies[c+0]=0,this.verticies[c+1]=0,this.verticies[c+2]=0,this.verticies[c+3]=0,this.verticies[c+4]=0,this.verticies[c+5]=0,this.verticies[c+6]=0,this.verticies[c+7]=0;m++,v=v.__next}},n.WebGLBatch.prototype.render=function(t,e){if(t=t||0,void 0==e&&(e=this.size),this.dirty&&(this.refresh(),this.dirty=!1),0!=this.size){this.update();var i=this.gl,r=n.shaderProgram;i.useProgram(r),i.bindBuffer(i.ARRAY_BUFFER,this.vertexBuffer),i.bufferSubData(i.ARRAY_BUFFER,0,this.verticies),i.vertexAttribPointer(r.vertexPositionAttribute,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this.uvBuffer),this.dirtyUVS&&(this.dirtyUVS=!1,i.bufferSubData(i.ARRAY_BUFFER,0,this.uvs)),i.vertexAttribPointer(r.textureCoordAttribute,2,i.FLOAT,!1,0,0),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,this.texture._glTexture),i.bindBuffer(i.ARRAY_BUFFER,this.colorBuffer),this.dirtyColors&&(this.dirtyColors=!1,i.bufferSubData(i.ARRAY_BUFFER,0,this.colors)),i.vertexAttribPointer(r.colorAttribute,1,i.FLOAT,!1,0,0),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var a=e-t;i.drawElements(i.TRIANGLES,6*a,i.UNSIGNED_SHORT,2*t*6)}},n.WebGLRenderGroup=function(t){this.gl=t,this.root,this.backgroundColor,this.batchs=[],this.toRemove=[]},n.WebGLRenderGroup.prototype.constructor=n.WebGLRenderGroup,n.WebGLRenderGroup.prototype.setRenderable=function(t){this.root&&this.removeDisplayObjectAndChildren(this.root),t.worldVisible=t.visible,this.root=t,this.addDisplayObjectAndChildren(t)},n.WebGLRenderGroup.prototype.render=function(t){n.WebGLRenderer.updateTextures();var e=this.gl;e.uniform2f(n.shaderProgram.projectionVector,t.x,t.y),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA);for(var i,r=0;r<this.batchs.length;r++)if(i=this.batchs[r],i instanceof n.WebGLBatch)this.batchs[r].render();else{var a=i.vcount===n.visibleCount;i instanceof n.TilingSprite?a&&this.renderTilingSprite(i,t):i instanceof n.Strip?a&&this.renderStrip(i,t):i instanceof n.Graphics?a&&i.renderable&&n.WebGLGraphics.renderGraphics(i,t):i instanceof n.FilterBlock&&(i.open?(e.enable(e.STENCIL_TEST),e.colorMask(!1,!1,!1,!1),e.stencilFunc(e.ALWAYS,1,255),e.stencilOp(e.KEEP,e.KEEP,e.REPLACE),n.WebGLGraphics.renderGraphics(i.mask,t),e.colorMask(!0,!0,!0,!1),e.stencilFunc(e.NOTEQUAL,0,255),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)):e.disable(e.STENCIL_TEST))}},n.WebGLRenderGroup.prototype.handleFilter=function(){},n.WebGLRenderGroup.prototype.renderSpecific=function(t,e){n.WebGLRenderer.updateTextures();var i=this.gl;i.uniform2f(n.shaderProgram.projectionVector,e.x,e.y);for(var r,a,o,s,l=t.first;l._iNext&&(l=l._iNext,!l.renderable||!l.__renderGroup););var h=l.batch;if(l instanceof n.Sprite){h=l.batch;var c=h.head;if(c==l)r=0;else for(r=1;c.__next!=l;)r++,c=c.__next}else h=l;for(var u,d=t,p=t;p.children.length>0;)p=p.children[p.children.length-1],p.renderable&&(d=p);if(d instanceof n.Sprite){u=d.batch;var c=u.head;if(c==d)o=0;else for(o=1;c.__next!=d;)o++,c=c.__next}else u=d;if(h==u)return void(h instanceof n.WebGLBatch?h.render(r,o+1):this.renderSpecial(h,e));
a=this.batchs.indexOf(h),s=this.batchs.indexOf(u),h instanceof n.WebGLBatch?h.render(r):this.renderSpecial(h,e);for(var f=a+1;s>f;f++)renderable=this.batchs[f],renderable instanceof n.WebGLBatch?this.batchs[f].render():this.renderSpecial(renderable,e);u instanceof n.WebGLBatch?u.render(0,o+1):this.renderSpecial(u,e)},n.WebGLRenderGroup.prototype.renderSpecial=function(t,e){var i=t.vcount===n.visibleCount;if(t instanceof n.TilingSprite)i&&this.renderTilingSprite(t,e);else if(t instanceof n.Strip)i&&this.renderStrip(t,e);else if(t instanceof n.CustomRenderable)i&&t.renderWebGL(this,e);else if(t instanceof n.Graphics)i&&t.renderable&&n.WebGLGraphics.renderGraphics(t,e);else if(t instanceof n.FilterBlock){var r=n.gl;t.open?(r.enable(r.STENCIL_TEST),r.colorMask(!1,!1,!1,!1),r.stencilFunc(r.ALWAYS,1,255),r.stencilOp(r.KEEP,r.KEEP,r.REPLACE),n.WebGLGraphics.renderGraphics(t.mask,e),r.colorMask(!0,!0,!0,!0),r.stencilFunc(r.NOTEQUAL,0,255),r.stencilOp(r.KEEP,r.KEEP,r.KEEP)):r.disable(r.STENCIL_TEST)}},n.WebGLRenderGroup.prototype.updateTexture=function(t){this.removeObject(t);for(var e=t.first;e!=this.root&&(e=e._iPrev,!e.renderable||!e.__renderGroup););for(var i=t.last;i._iNext&&(i=i._iNext,!i.renderable||!i.__renderGroup););this.insertObject(t,e,i)},n.WebGLRenderGroup.prototype.addFilterBlocks=function(t,e){t.__renderGroup=this,e.__renderGroup=this;for(var i=t;i!=this.root&&(i=i._iPrev,!i.renderable||!i.__renderGroup););this.insertAfter(t,i);for(var r=e;r!=this.root&&(r=r._iPrev,!r.renderable||!r.__renderGroup););this.insertAfter(e,r)},n.WebGLRenderGroup.prototype.removeFilterBlocks=function(t,e){this.removeObject(t),this.removeObject(e)},n.WebGLRenderGroup.prototype.addDisplayObjectAndChildren=function(t){t.__renderGroup&&t.__renderGroup.removeDisplayObjectAndChildren(t);for(var e=t.first;e!=this.root.first&&(e=e._iPrev,!e.renderable||!e.__renderGroup););for(var i=t.last;i._iNext&&(i=i._iNext,!i.renderable||!i.__renderGroup););var r=t.first,n=t.last._iNext;do r.__renderGroup=this,r.renderable&&(this.insertObject(r,e,i),e=r),r=r._iNext;while(r!=n)},n.WebGLRenderGroup.prototype.removeDisplayObjectAndChildren=function(t){if(t.__renderGroup==this){{t.last}do t.__renderGroup=null,t.renderable&&this.removeObject(t),t=t._iNext;while(t)}},n.WebGLRenderGroup.prototype.insertObject=function(t,e,i){var r=e,a=i;if(t instanceof n.Sprite){var o,s;if(r instanceof n.Sprite){if(o=r.batch,o&&o.texture==t.texture.baseTexture&&o.blendMode==t.blendMode)return void o.insertAfter(t,r)}else o=r;if(a)if(a instanceof n.Sprite){if(s=a.batch){if(s.texture==t.texture.baseTexture&&s.blendMode==t.blendMode)return void s.insertBefore(t,a);if(s==o){var l=o.split(a),h=n.WebGLRenderer.getBatch(),c=this.batchs.indexOf(o);return h.init(t),void this.batchs.splice(c+1,0,h,l)}}}else s=a;var h=n.WebGLRenderer.getBatch();if(h.init(t),o){var c=this.batchs.indexOf(o);this.batchs.splice(c+1,0,h)}else this.batchs.push(h)}else t instanceof n.TilingSprite?this.initTilingSprite(t):t instanceof n.Strip&&this.initStrip(t),this.insertAfter(t,r)},n.WebGLRenderGroup.prototype.insertAfter=function(t,e){if(e instanceof n.Sprite){var i=e.batch;if(i)if(i.tail==e){var r=this.batchs.indexOf(i);this.batchs.splice(r+1,0,t)}else{var a=i.split(e.__next),r=this.batchs.indexOf(i);this.batchs.splice(r+1,0,t,a)}else this.batchs.push(t)}else{var r=this.batchs.indexOf(e);this.batchs.splice(r+1,0,t)}},n.WebGLRenderGroup.prototype.removeObject=function(t){var e;if(t instanceof n.Sprite){var i=t.batch;if(!i)return;i.remove(t),0==i.size&&(e=i)}else e=t;if(e){var r=this.batchs.indexOf(e);if(-1==r)return;if(0==r||r==this.batchs.length-1)return this.batchs.splice(r,1),void(e instanceof n.WebGLBatch&&n.WebGLRenderer.returnBatch(e));if(this.batchs[r-1]instanceof n.WebGLBatch&&this.batchs[r+1]instanceof n.WebGLBatch&&this.batchs[r-1].texture==this.batchs[r+1].texture&&this.batchs[r-1].blendMode==this.batchs[r+1].blendMode)return this.batchs[r-1].merge(this.batchs[r+1]),e instanceof n.WebGLBatch&&n.WebGLRenderer.returnBatch(e),n.WebGLRenderer.returnBatch(this.batchs[r+1]),void this.batchs.splice(r,2);this.batchs.splice(r,1),e instanceof n.WebGLBatch&&n.WebGLRenderer.returnBatch(e)}},n.WebGLRenderGroup.prototype.initTilingSprite=function(t){var e=this.gl;t.verticies=new Float32Array([0,0,t.width,0,t.width,t.height,0,t.height]),t.uvs=new Float32Array([0,0,1,0,1,1,0,1]),t.colors=new Float32Array([1,1,1,1]),t.indices=new Uint16Array([0,1,3,2]),t._vertexBuffer=e.createBuffer(),t._indexBuffer=e.createBuffer(),t._uvBuffer=e.createBuffer(),t._colorBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,t._vertexBuffer),e.bufferData(e.ARRAY_BUFFER,t.verticies,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,t._uvBuffer),e.bufferData(e.ARRAY_BUFFER,t.uvs,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,t._colorBuffer),e.bufferData(e.ARRAY_BUFFER,t.colors,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t._indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,t.indices,e.STATIC_DRAW),t.texture.baseTexture._glTexture?(e.bindTexture(e.TEXTURE_2D,t.texture.baseTexture._glTexture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),t.texture.baseTexture._powerOf2=!0):t.texture.baseTexture._powerOf2=!0},n.WebGLRenderGroup.prototype.renderStrip=function(t,e){var i=this.gl,r=n.shaderProgram;i.useProgram(n.stripShaderProgram);var a=n.mat3.clone(t.worldTransform);n.mat3.transpose(a),i.uniformMatrix3fv(n.stripShaderProgram.translationMatrix,!1,a),i.uniform2f(n.stripShaderProgram.projectionVector,e.x,e.y),i.uniform1f(n.stripShaderProgram.alpha,t.worldAlpha),t.dirty?(t.dirty=!1,i.bindBuffer(i.ARRAY_BUFFER,t._vertexBuffer),i.bufferData(i.ARRAY_BUFFER,t.verticies,i.STATIC_DRAW),i.vertexAttribPointer(r.vertexPositionAttribute,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,t._uvBuffer),i.bufferData(i.ARRAY_BUFFER,t.uvs,i.STATIC_DRAW),i.vertexAttribPointer(r.textureCoordAttribute,2,i.FLOAT,!1,0,0),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,t.texture.baseTexture._glTexture),i.bindBuffer(i.ARRAY_BUFFER,t._colorBuffer),i.bufferData(i.ARRAY_BUFFER,t.colors,i.STATIC_DRAW),i.vertexAttribPointer(r.colorAttribute,1,i.FLOAT,!1,0,0),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t._indexBuffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,t.indices,i.STATIC_DRAW)):(i.bindBuffer(i.ARRAY_BUFFER,t._vertexBuffer),i.bufferSubData(i.ARRAY_BUFFER,0,t.verticies),i.vertexAttribPointer(r.vertexPositionAttribute,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,t._uvBuffer),i.vertexAttribPointer(r.textureCoordAttribute,2,i.FLOAT,!1,0,0),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,t.texture.baseTexture._glTexture),i.bindBuffer(i.ARRAY_BUFFER,t._colorBuffer),i.vertexAttribPointer(r.colorAttribute,1,i.FLOAT,!1,0,0),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t._indexBuffer)),i.drawElements(i.TRIANGLE_STRIP,t.indices.length,i.UNSIGNED_SHORT,0),i.useProgram(n.shaderProgram)},n.WebGLRenderGroup.prototype.renderTilingSprite=function(t,e){var i=this.gl,r=(n.shaderProgram,t.tilePosition),a=t.tileScale,o=r.x/t.texture.baseTexture.width,s=r.y/t.texture.baseTexture.height,l=t.width/t.texture.baseTexture.width/a.x,h=t.height/t.texture.baseTexture.height/a.y;t.uvs[0]=0-o,t.uvs[1]=0-s,t.uvs[2]=1*l-o,t.uvs[3]=0-s,t.uvs[4]=1*l-o,t.uvs[5]=1*h-s,t.uvs[6]=0-o,t.uvs[7]=1*h-s,i.bindBuffer(i.ARRAY_BUFFER,t._uvBuffer),i.bufferSubData(i.ARRAY_BUFFER,0,t.uvs),this.renderStrip(t,e)},n.WebGLRenderGroup.prototype.initStrip=function(t){{var e=this.gl;this.shaderProgram}t._vertexBuffer=e.createBuffer(),t._indexBuffer=e.createBuffer(),t._uvBuffer=e.createBuffer(),t._colorBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,t._vertexBuffer),e.bufferData(e.ARRAY_BUFFER,t.verticies,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,t._uvBuffer),e.bufferData(e.ARRAY_BUFFER,t.uvs,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,t._colorBuffer),e.bufferData(e.ARRAY_BUFFER,t.colors,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t._indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,t.indices,e.STATIC_DRAW)},n.CanvasRenderer=function(t,e,i,r){this.transparent=r,this.width=t||800,this.height=e||600,this.view=i||document.createElement("canvas"),this.context=this.view.getContext("2d"),this.refresh=!0,this.view.width=this.width,this.view.height=this.height,this.count=0},n.CanvasRenderer.prototype.constructor=n.CanvasRenderer,n.CanvasRenderer.prototype.render=function(t){n.texturesToUpdate=[],n.texturesToDestroy=[],n.visibleCount++,t.updateTransform(),this.view.style.backgroundColor==t.backgroundColorString||this.transparent||(this.view.style.backgroundColor=t.backgroundColorString),this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.width,this.height),this.renderDisplayObject(t),t.interactive&&(t._interactiveEventsAdded||(t._interactiveEventsAdded=!0,t.interactionManager.setTarget(this))),n.Texture.frameUpdates.length>0&&(n.Texture.frameUpdates=[])},n.CanvasRenderer.prototype.resize=function(t,e){this.width=t,this.height=e,this.view.width=t,this.view.height=e},n.CanvasRenderer.prototype.renderDisplayObject=function(t){var e,i=this.context;i.globalCompositeOperation="source-over";var r=t.last._iNext;t=t.first;do if(e=t.worldTransform,t.visible)if(t.renderable){if(t instanceof n.Sprite){var a=t.texture.frame;a&&(i.globalAlpha=t.worldAlpha,i.setTransform(e[0],e[3],e[1],e[4],e[2],e[5]),i.drawImage(t.texture.baseTexture.source,a.x,a.y,a.width,a.height,t.anchor.x*-a.width,t.anchor.y*-a.height,a.width,a.height))}else if(t instanceof n.Strip)i.setTransform(e[0],e[3],e[1],e[4],e[2],e[5]),this.renderStrip(t);else if(t instanceof n.TilingSprite)i.setTransform(e[0],e[3],e[1],e[4],e[2],e[5]),this.renderTilingSprite(t);else if(t instanceof n.CustomRenderable)t.renderCanvas(this);else if(t instanceof n.Graphics)i.setTransform(e[0],e[3],e[1],e[4],e[2],e[5]),n.CanvasGraphics.renderGraphics(t,i);else if(t instanceof n.FilterBlock)if(t.open){i.save();var o=t.mask.alpha,s=t.mask.worldTransform;i.setTransform(s[0],s[3],s[1],s[4],s[2],s[5]),t.mask.worldAlpha=.5,i.worldAlpha=0,n.CanvasGraphics.renderGraphicsMask(t.mask,i),i.clip(),t.mask.worldAlpha=o}else i.restore();t=t._iNext}else t=t._iNext;else t=t.last._iNext;while(t!=r)},n.CanvasRenderer.prototype.renderStripFlat=function(t){var e=this.context,i=t.verticies,r=(t.uvs,i.length/2);this.count++,e.beginPath();for(var n=1;r-2>n;n++){var a=2*n,o=i[a],s=i[a+2],l=i[a+4],h=i[a+1],c=i[a+3],u=i[a+5];e.moveTo(o,h),e.lineTo(s,c),e.lineTo(l,u)}e.fillStyle="#FF0000",e.fill(),e.closePath()},n.CanvasRenderer.prototype.renderTilingSprite=function(t){var e=this.context;e.globalAlpha=t.worldAlpha,t.__tilePattern||(t.__tilePattern=e.createPattern(t.texture.baseTexture.source,"repeat")),e.beginPath();var i=t.tilePosition,r=t.tileScale;e.scale(r.x,r.y),e.translate(i.x,i.y),e.fillStyle=t.__tilePattern,e.fillRect(-i.x,-i.y,t.width/r.x,t.height/r.y),e.scale(1/r.x,1/r.y),e.translate(-i.x,-i.y),e.closePath()},n.CanvasRenderer.prototype.renderStrip=function(t){var e=this.context,i=t.verticies,r=t.uvs,n=i.length/2;this.count++;for(var a=1;n-2>a;a++){var o=2*a,s=i[o],l=i[o+2],h=i[o+4],c=i[o+1],u=i[o+3],d=i[o+5],p=r[o]*t.texture.width,f=r[o+2]*t.texture.width,g=r[o+4]*t.texture.width,b=r[o+1]*t.texture.height,m=r[o+3]*t.texture.height,v=r[o+5]*t.texture.height;e.save(),e.beginPath(),e.moveTo(s,c),e.lineTo(l,u),e.lineTo(h,d),e.closePath(),e.clip();var y=p*m+b*g+f*v-m*g-b*f-p*v,x=s*m+b*h+l*v-m*h-b*l-s*v,T=p*l+s*g+f*h-l*g-s*f-p*h,w=p*m*h+b*l*g+s*f*v-s*m*g-b*f*h-p*l*v,_=c*m+b*d+u*v-m*d-b*u-c*v,A=p*u+c*g+f*d-u*g-c*f-p*d,S=p*m*d+b*u*g+c*f*v-c*m*g-b*f*d-p*u*v;e.transform(x/y,_/y,T/y,A/y,w/y,S/y),e.drawImage(t.texture.baseTexture.source,0,0),e.restore()}},n.CanvasGraphics=function(){},n.CanvasGraphics.renderGraphics=function(t,e){for(var i=t.worldAlpha,r=0;r<t.graphicsData.length;r++){var a=t.graphicsData[r],o=a.points;if(e.strokeStyle=color="#"+("00000"+(0|a.lineColor).toString(16)).substr(-6),e.lineWidth=a.lineWidth,a.type===n.Graphics.POLY){e.beginPath(),e.moveTo(o[0],o[1]);for(var s=1;s<o.length/2;s++)e.lineTo(o[2*s],o[2*s+1]);o[0]===o[o.length-2]&&o[1]===o[o.length-1]&&e.closePath(),a.fill&&(e.globalAlpha=a.fillAlpha*i,e.fillStyle=color="#"+("00000"+(0|a.fillColor).toString(16)).substr(-6),e.fill()),a.lineWidth&&(e.globalAlpha=a.lineAlpha*i,e.stroke())}else if(a.type===n.Graphics.RECT)void 0!=a.fillColor&&(e.globalAlpha=a.fillAlpha*i,e.fillStyle=color="#"+("00000"+(0|a.fillColor).toString(16)).substr(-6),e.fillRect(o[0],o[1],o[2],o[3])),a.lineWidth&&(e.globalAlpha=a.lineAlpha*i,e.strokeRect(o[0],o[1],o[2],o[3]));else if(a.type==n.Graphics.CIRC)e.beginPath(),e.arc(o[0],o[1],o[2],0,2*Math.PI),e.closePath(),a.fill&&(e.globalAlpha=a.fillAlpha*i,e.fillStyle=color="#"+("00000"+(0|a.fillColor).toString(16)).substr(-6),e.fill()),a.lineWidth&&(e.globalAlpha=a.lineAlpha*i,e.stroke());else if(a.type==n.Graphics.ELIP){var l=a.points,h=2*l[2],c=2*l[3],u=l[0]-h/2,d=l[1]-c/2;e.beginPath();var p=.5522848,f=h/2*p,g=c/2*p,b=u+h,m=d+c,v=u+h/2,y=d+c/2;e.moveTo(u,y),e.bezierCurveTo(u,y-g,v-f,d,v,d),e.bezierCurveTo(v+f,d,b,y-g,b,y),e.bezierCurveTo(b,y+g,v+f,m,v,m),e.bezierCurveTo(v-f,m,u,y+g,u,y),e.closePath(),a.fill&&(e.globalAlpha=a.fillAlpha*i,e.fillStyle=color="#"+("00000"+(0|a.fillColor).toString(16)).substr(-6),e.fill()),a.lineWidth&&(e.globalAlpha=a.lineAlpha*i,e.stroke())}}},n.CanvasGraphics.renderGraphicsMask=function(t,e){var i=(t.worldAlpha,t.graphicsData.length);i>1&&(i=1,console.log("Pixi.js warning: masks in canvas can only mask using the first path in the graphics object"));for(var r=0;1>r;r++){var a=t.graphicsData[r],o=a.points;if(a.type==n.Graphics.POLY){e.beginPath(),e.moveTo(o[0],o[1]);for(var s=1;s<o.length/2;s++)e.lineTo(o[2*s],o[2*s+1]);o[0]==o[o.length-2]&&o[1]==o[o.length-1]&&e.closePath()}else if(a.type==n.Graphics.RECT)e.beginPath(),e.rect(o[0],o[1],o[2],o[3]),e.closePath();else if(a.type==n.Graphics.CIRC)e.beginPath(),e.arc(o[0],o[1],o[2],0,2*Math.PI),e.closePath();else if(a.type==n.Graphics.ELIP){var l=a.points,h=2*l[2],c=2*l[3],u=l[0]-h/2,d=l[1]-c/2;e.beginPath();var p=.5522848,f=h/2*p,g=c/2*p,b=u+h,m=d+c,v=u+h/2,y=d+c/2;e.moveTo(u,y),e.bezierCurveTo(u,y-g,v-f,d,v,d),e.bezierCurveTo(v+f,d,b,y-g,b,y),e.bezierCurveTo(b,y+g,v+f,m,v,m),e.bezierCurveTo(v-f,m,u,y+g,u,y),e.closePath()}}},n.Graphics=function(){n.DisplayObjectContainer.call(this),this.renderable=!0,this.fillAlpha=1,this.lineWidth=0,this.lineColor="black",this.graphicsData=[],this.currentPath={points:[]}},n.Graphics.prototype=Object.create(n.DisplayObjectContainer.prototype),n.Graphics.prototype.constructor=n.Graphics,n.Graphics.prototype.lineStyle=function(t,e,i){0==this.currentPath.points.length&&this.graphicsData.pop(),this.lineWidth=t||0,this.lineColor=e||0,this.lineAlpha=void 0==i?1:i,this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:n.Graphics.POLY},this.graphicsData.push(this.currentPath)},n.Graphics.prototype.moveTo=function(t,e){0==this.currentPath.points.length&&this.graphicsData.pop(),this.currentPath=this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:n.Graphics.POLY},this.currentPath.points.push(t,e),this.graphicsData.push(this.currentPath)},n.Graphics.prototype.lineTo=function(t,e){this.currentPath.points.push(t,e),this.dirty=!0},n.Graphics.prototype.beginFill=function(t,e){this.filling=!0,this.fillColor=t||0,this.fillAlpha=void 0==e?1:e},n.Graphics.prototype.endFill=function(){this.filling=!1,this.fillColor=null,this.fillAlpha=1},n.Graphics.prototype.drawRect=function(t,e,i,r){0==this.currentPath.points.length&&this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[t,e,i,r],type:n.Graphics.RECT},this.graphicsData.push(this.currentPath),this.dirty=!0},n.Graphics.prototype.drawCircle=function(t,e,i){0==this.currentPath.points.length&&this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[t,e,i,i],type:n.Graphics.CIRC},this.graphicsData.push(this.currentPath),this.dirty=!0},n.Graphics.prototype.drawElipse=function(t,e,i,r){0==this.currentPath.points.length&&this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[t,e,i,r],type:n.Graphics.ELIP},this.graphicsData.push(this.currentPath),this.dirty=!0},n.Graphics.prototype.clear=function(){this.lineWidth=0,this.filling=!1,this.dirty=!0,this.clearDirty=!0,this.graphicsData=[]},n.Graphics.POLY=0,n.Graphics.RECT=1,n.Graphics.CIRC=2,n.Graphics.ELIP=3,n.Strip=function(t,e,i){n.DisplayObjectContainer.call(this),this.texture=t,this.blendMode=n.blendModes.NORMAL;try{this.uvs=new Float32Array([0,1,1,1,1,0,0,1]),this.verticies=new Float32Array([0,0,0,0,0,0,0,0,0]),this.colors=new Float32Array([1,1,1,1]),this.indices=new Uint16Array([0,1,2,3])}catch(r){this.uvs=[0,1,1,1,1,0,0,1],this.verticies=[0,0,0,0,0,0,0,0,0],this.colors=[1,1,1,1],this.indices=[0,1,2,3]}this.width=e,this.height=i,t.baseTexture.hasLoaded?(this.width=this.texture.frame.width,this.height=this.texture.frame.height,this.updateFrame=!0):(this.onTextureUpdateBind=this.onTextureUpdate.bind(this),this.texture.addEventListener("update",this.onTextureUpdateBind)),this.renderable=!0},n.Strip.prototype=Object.create(n.DisplayObjectContainer.prototype),n.Strip.prototype.constructor=n.Strip,n.Strip.prototype.setTexture=function(t){this.texture=t,this.width=t.frame.width,this.height=t.frame.height,this.updateFrame=!0},n.Strip.prototype.onTextureUpdate=function(){this.updateFrame=!0},n.Rope=function(t,e){n.Strip.call(this,t),this.points=e;try{this.verticies=new Float32Array(4*e.length),this.uvs=new Float32Array(4*e.length),this.colors=new Float32Array(2*e.length),this.indices=new Uint16Array(2*e.length)}catch(i){this.verticies=verticies,this.uvs=uvs,this.colors=colors,this.indices=indices}this.refresh()},n.Rope.prototype=Object.create(n.Strip.prototype),n.Rope.prototype.constructor=n.Rope,n.Rope.prototype.refresh=function(){var t=this.points;if(!(t.length<1)){var e=this.uvs,i=this.indices,r=this.colors,n=t[0],a=t[0];this.count-=.2,e[0]=0,e[1]=1,e[2]=0,e[3]=1,r[0]=1,r[1]=1,i[0]=0,i[1]=1;for(var o=t.length,s=1;o>s;s++){var a=t[s],l=4*s,h=s/(o-1);s%2?(e[l]=h,e[l+1]=0,e[l+2]=h,e[l+3]=1):(e[l]=h,e[l+1]=0,e[l+2]=h,e[l+3]=1),l=2*s,r[l]=1,r[l+1]=1,l=2*s,i[l]=l,i[l+1]=l+1,n=a}}},n.Rope.prototype.updateTransform=function(){var t=this.points;if(!(t.length<1)){var e,i=this.verticies,r=t[0],a={x:0,y:0},o=t[0];this.count-=.2,i[0]=o.x+a.x,i[1]=o.y+a.y,i[2]=o.x-a.x,i[3]=o.y-a.y;for(var s=t.length,l=1;s>l;l++){var o=t[l],h=4*l;e=l<t.length-1?t[l+1]:o,a.y=-(e.x-r.x),a.x=e.y-r.y;var c=10*(1-l/(s-1));c>1&&(c=1);var u=Math.sqrt(a.x*a.x+a.y*a.y),d=this.texture.height/2;a.x/=u,a.y/=u,a.x*=d,a.y*=d,i[h]=o.x+a.x,i[h+1]=o.y+a.y,i[h+2]=o.x-a.x,i[h+3]=o.y-a.y,r=o}n.DisplayObjectContainer.prototype.updateTransform.call(this)}},n.Rope.prototype.setTexture=function(t){this.texture=t,this.updateFrame=!0},n.TilingSprite=function(t,e,i){n.DisplayObjectContainer.call(this),this.texture=t,this.width=e,this.height=i,this.tileScale=new n.Point(1,1),this.tilePosition=new n.Point(0,0),this.renderable=!0,this.blendMode=n.blendModes.NORMAL},n.TilingSprite.prototype=Object.create(n.DisplayObjectContainer.prototype),n.TilingSprite.prototype.constructor=n.TilingSprite,n.TilingSprite.prototype.setTexture=function(t){this.texture=t,this.updateFrame=!0},n.TilingSprite.prototype.onTextureUpdate=function(){this.updateFrame=!0},n.Spine=function(t){if(n.DisplayObjectContainer.call(this),this.spineData=n.AnimCache[t],this.baseUrl=t.replace(/[^\/]*$/,""),!this.spineData)throw new Error("Spine data must be preloaded using PIXI.SpineLoader or PIXI.AssetLoader: "+t);this.skeleton=new c.Skeleton(this.spineData),this.skeleton.updateWorldTransform(),this.stateData=new c.AnimationStateData(this.spineData),this.state=new c.AnimationState(this.stateData),this.slotContainers=[];for(var e=0,i=this.skeleton.drawOrder.length;i>e;e++){var r=this.skeleton.drawOrder[e],a=r.attachment,o=new n.DisplayObjectContainer;if(this.slotContainers.push(o),this.addChild(o),a instanceof c.RegionAttachment){-1===a.rendererObject.name.indexOf(this.baseUrl)&&(a.rendererObject.name=this.baseUrl+a.rendererObject.name);var s=a.rendererObject.name,l=this.createSprite(r,a.rendererObject);r.currentSprite=l,r.currentSpriteName=s,o.addChild(l)}}},n.Spine.prototype=Object.create(n.DisplayObjectContainer.prototype),n.Spine.prototype.constructor=n.Spine,n.Spine.prototype.updateTransform=function(){this.lastTime=this.lastTime||Date.now();var t=.001*(Date.now()-this.lastTime);this.lastTime=Date.now(),this.state.update(t),this.state.apply(this.skeleton),this.skeleton.updateWorldTransform();for(var e=this.skeleton.drawOrder,i=0,r=e.length;r>i;i++){var a=e[i],o=a.attachment,s=this.slotContainers[i];if(o instanceof c.RegionAttachment){if(o.rendererObject&&(!a.currentSpriteName||a.currentSpriteName!=o.name)){-1===o.rendererObject.name.indexOf(this.baseUrl)&&(o.rendererObject.name=this.baseUrl+o.rendererObject.name);var l=o.rendererObject.name;if(void 0!==a.currentSprite&&(a.currentSprite.visible=!1),a.sprites=a.sprites||{},void 0!==a.sprites[l])a.sprites[l].visible=!0;else{var h=this.createSprite(a,o.rendererObject);s.addChild(h)}a.currentSprite=a.sprites[l],a.currentSpriteName=l}s.visible=!0;var u=a.bone;s.position.x=u.worldX+o.x*u.m00+o.y*u.m01,s.position.y=u.worldY+o.x*u.m10+o.y*u.m11,s.scale.x=u.worldScaleX,s.scale.y=u.worldScaleY,s.rotation=-(a.bone.worldRotation*Math.PI/180)}else s.visible=!1}n.DisplayObjectContainer.prototype.updateTransform.call(this)},n.Spine.prototype.createSprite=function(t,e){var i=n.TextureCache[e.name]?e.name:e.name+".png",r=new n.Sprite(n.Texture.fromFrame(i));return r.scale=e.scale,r.rotation=e.rotation,r.anchor.x=r.anchor.y=.5,t.sprites=t.sprites||{},t.sprites[e.name]=r,r};var c={};c.BoneData=function(t,e){this.name=t,this.parent=e},c.BoneData.prototype={length:0,x:0,y:0,rotation:0,scaleX:1,scaleY:1},c.SlotData=function(t,e){this.name=t,this.boneData=e},c.SlotData.prototype={r:1,g:1,b:1,a:1,attachmentName:null},c.Bone=function(t,e){this.data=t,this.parent=e,this.setToSetupPose()},c.Bone.yDown=!1,c.Bone.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,m00:0,m01:0,worldX:0,m10:0,m11:0,worldY:0,worldRotation:0,worldScaleX:1,worldScaleY:1,updateWorldTransform:function(t,e){var i=this.parent;null!=i?(this.worldX=this.x*i.m00+this.y*i.m01+i.worldX,this.worldY=this.x*i.m10+this.y*i.m11+i.worldY,this.worldScaleX=i.worldScaleX*this.scaleX,this.worldScaleY=i.worldScaleY*this.scaleY,this.worldRotation=i.worldRotation+this.rotation):(this.worldX=this.x,this.worldY=this.y,this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY,this.worldRotation=this.rotation);var r=this.worldRotation*Math.PI/180,n=Math.cos(r),a=Math.sin(r);this.m00=n*this.worldScaleX,this.m10=a*this.worldScaleX,this.m01=-a*this.worldScaleY,this.m11=n*this.worldScaleY,t&&(this.m00=-this.m00,this.m01=-this.m01),e&&(this.m10=-this.m10,this.m11=-this.m11),c.Bone.yDown&&(this.m10=-this.m10,this.m11=-this.m11)},setToSetupPose:function(){var t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY}},c.Slot=function(t,e,i){this.data=t,this.skeleton=e,this.bone=i,this.setToSetupPose()},c.Slot.prototype={r:1,g:1,b:1,a:1,_attachmentTime:0,attachment:null,setAttachment:function(t){this.attachment=t,this._attachmentTime=this.skeleton.time},setAttachmentTime:function(t){this._attachmentTime=this.skeleton.time-t},getAttachmentTime:function(){return this.skeleton.time-this._attachmentTime},setToSetupPose:function(){var t=this.data;this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a;for(var e=this.skeleton.data.slots,i=0,r=e.length;r>i;i++)if(e[i]==t){this.setAttachment(t.attachmentName?this.skeleton.getAttachmentBySlotIndex(i,t.attachmentName):null);break}}},c.Skin=function(t){this.name=t,this.attachments={}},c.Skin.prototype={addAttachment:function(t,e,i){this.attachments[t+":"+e]=i},getAttachment:function(t,e){return this.attachments[t+":"+e]},_attachAll:function(t,e){for(var i in e.attachments){var r=i.indexOf(":"),n=parseInt(i.substring(0,r)),a=i.substring(r+1),o=t.slots[n];if(o.attachment&&o.attachment.name==a){var s=this.getAttachment(n,a);s&&o.setAttachment(s)}}}},c.Animation=function(t,e,i){this.name=t,this.timelines=e,this.duration=i},c.Animation.prototype={apply:function(t,e,i){i&&0!=this.duration&&(e%=this.duration);for(var r=this.timelines,n=0,a=r.length;a>n;n++)r[n].apply(t,e,1)},mix:function(t,e,i,r){i&&0!=this.duration&&(e%=this.duration);for(var n=this.timelines,a=0,o=n.length;o>a;a++)n[a].apply(t,e,r)}},c.binarySearch=function(t,e,i){var r=0,n=Math.floor(t.length/i)-2;if(0==n)return i;for(var a=n>>>1;;){if(t[(a+1)*i]<=e?r=a+1:n=a,r==n)return(r+1)*i;a=r+n>>>1}},c.linearSearch=function(t,e,i){for(var r=0,n=t.length-i;n>=r;r+=i)if(t[r]>e)return r;return-1},c.Curves=function(t){this.curves=[],this.curves.length=6*(t-1)},c.Curves.prototype={setLinear:function(t){this.curves[6*t]=0},setStepped:function(t){this.curves[6*t]=-1},setCurve:function(t,e,i,r,n){var a=.1,o=a*a,s=o*a,l=3*a,h=3*o,c=6*o,u=6*s,d=2*-e+r,p=2*-i+n,f=3*(e-r)+1,g=3*(i-n)+1,b=6*t,m=this.curves;m[b]=e*l+d*h+f*s,m[b+1]=i*l+p*h+g*s,m[b+2]=d*c+f*u,m[b+3]=p*c+g*u,m[b+4]=f*u,m[b+5]=g*u},getCurvePercent:function(t,e){e=0>e?0:e>1?1:e;var i=6*t,r=this.curves,n=r[i];if(!n)return e;if(-1==n)return 0;for(var a=r[i+1],o=r[i+2],s=r[i+3],l=r[i+4],h=r[i+5],c=n,u=a,d=8;;){if(c>=e){var p=c-n,f=u-a;return f+(u-f)*(e-p)/(c-p)}if(0==d)break;d--,n+=o,a+=s,o+=l,s+=h,c+=n,u+=a}return u+(1-u)*(e-c)/(1-c)}},c.RotateTimeline=function(t){this.curves=new c.Curves(t),this.frames=[],this.frames.length=2*t},c.RotateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e,i){t*=2,this.frames[t]=e,this.frames[t+1]=i},apply:function(t,e,i){var r=this.frames;if(!(e<r[0])){var n=t.bones[this.boneIndex];if(e>=r[r.length-2]){for(var a=n.data.rotation+r[r.length-1]-n.rotation;a>180;)a-=360;for(;-180>a;)a+=360;return void(n.rotation+=a*i)}var o=c.binarySearch(r,e,2),s=r[o-1],l=r[o],h=1-(e-l)/(r[o-2]-l);h=this.curves.getCurvePercent(o/2-1,h);for(var a=r[o+1]-s;a>180;)a-=360;for(;-180>a;)a+=360;for(a=n.data.rotation+(s+a*h)-n.rotation;a>180;)a-=360;for(;-180>a;)a+=360;n.rotation+=a*i}}},c.TranslateTimeline=function(t){this.curves=new c.Curves(t),this.frames=[],this.frames.length=3*t},c.TranslateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,i,r){t*=3,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=r},apply:function(t,e,i){var r=this.frames;if(!(e<r[0])){var n=t.bones[this.boneIndex];if(e>=r[r.length-3])return n.x+=(n.data.x+r[r.length-2]-n.x)*i,void(n.y+=(n.data.y+r[r.length-1]-n.y)*i);var a=c.binarySearch(r,e,3),o=r[a-2],s=r[a-1],l=r[a],h=1-(e-l)/(r[a+-3]-l);h=this.curves.getCurvePercent(a/3-1,h),n.x+=(n.data.x+o+(r[a+1]-o)*h-n.x)*i,n.y+=(n.data.y+s+(r[a+2]-s)*h-n.y)*i}}},c.ScaleTimeline=function(t){this.curves=new c.Curves(t),this.frames=[],this.frames.length=3*t},c.ScaleTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(t,e,i,r){t*=3,this.frames[t]=e,this.frames[t+1]=i,this.frames[t+2]=r},apply:function(t,e,i){var r=this.frames;if(!(e<r[0])){var n=t.bones[this.boneIndex];if(e>=r[r.length-3])return n.scaleX+=(n.data.scaleX-1+r[r.length-2]-n.scaleX)*i,void(n.scaleY+=(n.data.scaleY-1+r[r.length-1]-n.scaleY)*i);var a=c.binarySearch(r,e,3),o=r[a-2],s=r[a-1],l=r[a],h=1-(e-l)/(r[a+-3]-l);h=this.curves.getCurvePercent(a/3-1,h),n.scaleX+=(n.data.scaleX-1+o+(r[a+1]-o)*h-n.scaleX)*i,n.scaleY+=(n.data.scaleY-1+s+(r[a+2]-s)*h-n.scaleY)*i}}},c.ColorTimeline=function(t){this.curves=new c.Curves(t),this.frames=[],this.frames.length=5*t},c.ColorTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(t,e){t*=5,this.frames[t]=e,this.frames[t+1]=r,this.frames[t+2]=g,this.frames[t+3]=b,this.frames[t+4]=a},apply:function(t,e,i){var r=this.frames;if(!(e<r[0])){var n=t.slots[this.slotIndex];if(e>=r[r.length-5]){var a=r.length-1;return n.r=r[a-3],n.g=r[a-2],n.b=r[a-1],void(n.a=r[a])}var o=c.binarySearch(r,e,5),s=r[o-4],l=r[o-3],h=r[o-2],u=r[o-1],d=r[o],p=1-(e-d)/(r[o-5]-d);p=this.curves.getCurvePercent(o/5-1,p);var f=s+(r[o+1]-s)*p,g=l+(r[o+2]-l)*p,b=h+(r[o+3]-h)*p,m=u+(r[o+4]-u)*p;1>i?(n.r+=(f-n.r)*i,n.g+=(g-n.g)*i,n.b+=(b-n.b)*i,n.a+=(m-n.a)*i):(n.r=f,n.g=g,n.b=b,n.a=m)}}},c.AttachmentTimeline=function(t){this.curves=new c.Curves(t),this.frames=[],this.frames.length=t,this.attachmentNames=[],this.attachmentNames.length=t},c.AttachmentTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length},setFrame:function(t,e,i){this.frames[t]=e,this.attachmentNames[t]=i},apply:function(t,e){var i=this.frames;if(!(e<i[0])){var r;r=e>=i[i.length-1]?i.length-1:c.binarySearch(i,e,1)-1;var n=this.attachmentNames[r];t.slots[this.slotIndex].setAttachment(n?t.getAttachmentBySlotIndex(this.slotIndex,n):null)}}},c.SkeletonData=function(){this.bones=[],this.slots=[],this.skins=[],this.animations=[]},c.SkeletonData.prototype={defaultSkin:null,findBone:function(t){for(var e=this.bones,i=0,r=e.length;r>i;i++)if(e[i].name==t)return e[i];return null},findBoneIndex:function(t){for(var e=this.bones,i=0,r=e.length;r>i;i++)if(e[i].name==t)return i;return-1},findSlot:function(t){for(var e=this.slots,i=0,r=e.length;r>i;i++)if(e[i].name==t)return slot[i];return null},findSlotIndex:function(t){for(var e=this.slots,i=0,r=e.length;r>i;i++)if(e[i].name==t)return i;return-1},findSkin:function(t){for(var e=this.skins,i=0,r=e.length;r>i;i++)if(e[i].name==t)return e[i];return null},findAnimation:function(t){for(var e=this.animations,i=0,r=e.length;r>i;i++)if(e[i].name==t)return e[i];return null}},c.Skeleton=function(t){this.data=t,this.bones=[];for(var e=0,i=t.bones.length;i>e;e++){var r=t.bones[e],n=r.parent?this.bones[t.bones.indexOf(r.parent)]:null;this.bones.push(new c.Bone(r,n))}this.slots=[],this.drawOrder=[];for(var e=0,i=t.slots.length;i>e;e++){var a=t.slots[e],o=this.bones[t.bones.indexOf(a.boneData)],s=new c.Slot(a,this,o);this.slots.push(s),this.drawOrder.push(s)}},c.Skeleton.prototype={x:0,y:0,skin:null,r:1,g:1,b:1,a:1,time:0,flipX:!1,flipY:!1,updateWorldTransform:function(){for(var t=this.flipX,e=this.flipY,i=this.bones,r=0,n=i.length;n>r;r++)i[r].updateWorldTransform(t,e)},setToSetupPose:function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},setBonesToSetupPose:function(){for(var t=this.bones,e=0,i=t.length;i>e;e++)t[e].setToSetupPose()},setSlotsToSetupPose:function(){for(var t=this.slots,e=0,i=t.length;i>e;e++)t[e].setToSetupPose(e)},getRootBone:function(){return 0==this.bones.length?null:this.bones[0]},findBone:function(t){for(var e=this.bones,i=0,r=e.length;r>i;i++)if(e[i].data.name==t)return e[i];return null},findBoneIndex:function(t){for(var e=this.bones,i=0,r=e.length;r>i;i++)if(e[i].data.name==t)return i;return-1},findSlot:function(t){for(var e=this.slots,i=0,r=e.length;r>i;i++)if(e[i].data.name==t)return e[i];return null},findSlotIndex:function(t){for(var e=this.slots,i=0,r=e.length;r>i;i++)if(e[i].data.name==t)return i;return-1},setSkinByName:function(t){var e=this.data.findSkin(t);if(!e)throw"Skin not found: "+t;this.setSkin(e)},setSkin:function(t){this.skin&&t&&t._attachAll(this,this.skin),this.skin=t},getAttachmentBySlotName:function(t,e){return this.getAttachmentBySlotIndex(this.data.findSlotIndex(t),e)},getAttachmentBySlotIndex:function(t,e){if(this.skin){var i=this.skin.getAttachment(t,e);if(i)return i}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null
},setAttachment:function(t,e){for(var i=this.slots,r=0,n=i.size;n>r;r++){var a=i[r];if(a.data.name==t){var o=null;if(e&&(o=this.getAttachment(r,e),null==o))throw"Attachment not found: "+e+", for slot: "+t;return void a.setAttachment(o)}}throw"Slot not found: "+t},update:function(t){time+=t}},c.AttachmentType={region:0},c.RegionAttachment=function(){this.offset=[],this.offset.length=8,this.uvs=[],this.uvs.length=8},c.RegionAttachment.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,width:0,height:0,rendererObject:null,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,setUVs:function(t,e,i,r,n){var a=this.uvs;n?(a[2]=t,a[3]=r,a[4]=t,a[5]=e,a[6]=i,a[7]=e,a[0]=i,a[1]=r):(a[0]=t,a[1]=r,a[2]=t,a[3]=e,a[4]=i,a[5]=e,a[6]=i,a[7]=r)},updateOffset:function(){var t=this.width/this.regionOriginalWidth*this.scaleX,e=this.height/this.regionOriginalHeight*this.scaleY,i=-this.width/2*this.scaleX+this.regionOffsetX*t,r=-this.height/2*this.scaleY+this.regionOffsetY*e,n=i+this.regionWidth*t,a=r+this.regionHeight*e,o=this.rotation*Math.PI/180,s=Math.cos(o),l=Math.sin(o),h=i*s+this.x,c=i*l,u=r*s+this.y,d=r*l,p=n*s+this.x,f=n*l,g=a*s+this.y,b=a*l,m=this.offset;m[0]=h-d,m[1]=u+c,m[2]=h-b,m[3]=g+c,m[4]=p-b,m[5]=g+f,m[6]=p-d,m[7]=u+f},computeVertices:function(t,e,i,r){t+=i.worldX,e+=i.worldY;var n=i.m00,a=i.m01,o=i.m10,s=i.m11,l=this.offset;r[0]=l[0]*n+l[1]*a+t,r[1]=l[0]*o+l[1]*s+e,r[2]=l[2]*n+l[3]*a+t,r[3]=l[2]*o+l[3]*s+e,r[4]=l[4]*n+l[5]*a+t,r[5]=l[4]*o+l[5]*s+e,r[6]=l[6]*n+l[7]*a+t,r[7]=l[6]*o+l[7]*s+e}},c.AnimationStateData=function(t){this.skeletonData=t,this.animationToMixTime={}},c.AnimationStateData.prototype={defaultMix:0,setMixByName:function(t,e,i){var r=this.skeletonData.findAnimation(t);if(!r)throw"Animation not found: "+t;var n=this.skeletonData.findAnimation(e);if(!n)throw"Animation not found: "+e;this.setMix(r,n,i)},setMix:function(t,e,i){this.animationToMixTime[t.name+":"+e.name]=i},getMix:function(t,e){var i=this.animationToMixTime[t.name+":"+e.name];return i?i:this.defaultMix}},c.AnimationState=function(t){this.data=t,this.queue=[]},c.AnimationState.prototype={current:null,previous:null,currentTime:0,previousTime:0,currentLoop:!1,previousLoop:!1,mixTime:0,mixDuration:0,update:function(t){if(this.currentTime+=t,this.previousTime+=t,this.mixTime+=t,this.queue.length>0){var e=this.queue[0];this.currentTime>=e.delay&&(this._setAnimation(e.animation,e.loop),this.queue.shift())}},apply:function(t){if(this.current)if(this.previous){this.previous.apply(t,this.previousTime,this.previousLoop);var e=this.mixTime/this.mixDuration;e>=1&&(e=1,this.previous=null),this.current.mix(t,this.currentTime,this.currentLoop,e)}else this.current.apply(t,this.currentTime,this.currentLoop)},clearAnimation:function(){this.previous=null,this.current=null,this.queue.length=0},_setAnimation:function(t,e){this.previous=null,t&&this.current&&(this.mixDuration=this.data.getMix(this.current,t),this.mixDuration>0&&(this.mixTime=0,this.previous=this.current,this.previousTime=this.currentTime,this.previousLoop=this.currentLoop)),this.current=t,this.currentLoop=e,this.currentTime=0},setAnimationByName:function(t,e){var i=this.data.skeletonData.findAnimation(t);if(!i)throw"Animation not found: "+t;this.setAnimation(i,e)},setAnimation:function(t,e){this.queue.length=0,this._setAnimation(t,e)},addAnimationByName:function(t,e,i){var r=this.data.skeletonData.findAnimation(t);if(!r)throw"Animation not found: "+t;this.addAnimation(r,e,i)},addAnimation:function(t,e,i){var r={};if(r.animation=t,r.loop=e,!i||0>=i){var n=0==this.queue.length?this.current:this.queue[this.queue.length-1].animation;i=null!=n?n.duration-this.data.getMix(n,t)+(i||0):0}r.delay=i,this.queue.push(r)},isComplete:function(){return!this.current||this.currentTime>=this.current.duration}},c.SkeletonJson=function(t){this.attachmentLoader=t},c.SkeletonJson.prototype={scale:1,readSkeletonData:function(t){for(var e=new c.SkeletonData,i=t.bones,r=0,n=i.length;n>r;r++){var a=i[r],o=null;if(a.parent&&(o=e.findBone(a.parent),!o))throw"Parent bone not found: "+a.parent;var s=new c.BoneData(a.name,o);s.length=(a.length||0)*this.scale,s.x=(a.x||0)*this.scale,s.y=(a.y||0)*this.scale,s.rotation=a.rotation||0,s.scaleX=a.scaleX||1,s.scaleY=a.scaleY||1,e.bones.push(s)}for(var l=t.slots,r=0,n=l.length;n>r;r++){var h=l[r],s=e.findBone(h.bone);if(!s)throw"Slot bone not found: "+h.bone;var u=new c.SlotData(h.name,s),d=h.color;d&&(u.r=c.SkeletonJson.toColor(d,0),u.g=c.SkeletonJson.toColor(d,1),u.b=c.SkeletonJson.toColor(d,2),u.a=c.SkeletonJson.toColor(d,3)),u.attachmentName=h.attachment,e.slots.push(u)}var p=t.skins;for(var f in p)if(p.hasOwnProperty(f)){var g=p[f],b=new c.Skin(f);for(var m in g)if(g.hasOwnProperty(m)){var v=e.findSlotIndex(m),y=g[m];for(var x in y)if(y.hasOwnProperty(x)){var T=this.readAttachment(b,x,y[x]);null!=T&&b.addAttachment(v,x,T)}}e.skins.push(b),"default"==b.name&&(e.defaultSkin=b)}var w=t.animations;for(var _ in w)w.hasOwnProperty(_)&&this.readAnimation(_,w[_],e);return e},readAttachment:function(t,e,i){e=i.name||e;var r=c.AttachmentType[i.type||"region"];if(r==c.AttachmentType.region){var n=new c.RegionAttachment;return n.x=(i.x||0)*this.scale,n.y=(i.y||0)*this.scale,n.scaleX=i.scaleX||1,n.scaleY=i.scaleY||1,n.rotation=i.rotation||0,n.width=(i.width||32)*this.scale,n.height=(i.height||32)*this.scale,n.updateOffset(),n.rendererObject={},n.rendererObject.name=e,n.rendererObject.scale={},n.rendererObject.scale.x=n.scaleX,n.rendererObject.scale.y=n.scaleY,n.rendererObject.rotation=-n.rotation*Math.PI/180,n}throw"Unknown attachment type: "+r},readAnimation:function(t,e,i){var r=[],n=0,a=e.bones;for(var o in a)if(a.hasOwnProperty(o)){var s=i.findBoneIndex(o);if(-1==s)throw"Bone not found: "+o;var l=a[o];for(var h in l)if(l.hasOwnProperty(h)){var u=l[h];if("rotate"==h){var d=new c.RotateTimeline(u.length);d.boneIndex=s;for(var p=0,f=0,g=u.length;g>f;f++){var b=u[f];d.setFrame(p,b.time,b.angle),c.SkeletonJson.readCurve(d,p,b),p++}r.push(d),n=Math.max(n,d.frames[2*d.getFrameCount()-2])}else{if("translate"!=h&&"scale"!=h)throw"Invalid timeline type for a bone: "+h+" ("+o+")";var d,m=1;"scale"==h?d=new c.ScaleTimeline(u.length):(d=new c.TranslateTimeline(u.length),m=this.scale),d.boneIndex=s;for(var p=0,f=0,g=u.length;g>f;f++){var b=u[f],v=(b.x||0)*m,y=(b.y||0)*m;d.setFrame(p,b.time,v,y),c.SkeletonJson.readCurve(d,p,b),p++}r.push(d),n=Math.max(n,d.frames[3*d.getFrameCount()-3])}}}var x=e.slots;for(var T in x)if(x.hasOwnProperty(T)){var w=x[T],_=i.findSlotIndex(T);for(var h in w)if(w.hasOwnProperty(h)){var u=w[h];if("color"==h){var d=new c.ColorTimeline(u.length);d.slotIndex=_;for(var p=0,f=0,g=u.length;g>f;f++){var b=u[f],A=b.color,S=c.SkeletonJson.toColor(A,0),C=c.SkeletonJson.toColor(A,1),E=c.SkeletonJson.toColor(A,2),R=c.SkeletonJson.toColor(A,3);d.setFrame(p,b.time,S,C,E,R),c.SkeletonJson.readCurve(d,p,b),p++}r.push(d),n=Math.max(n,d.frames[5*d.getFrameCount()-5])}else{if("attachment"!=h)throw"Invalid timeline type for a slot: "+h+" ("+T+")";var d=new c.AttachmentTimeline(u.length);d.slotIndex=_;for(var p=0,f=0,g=u.length;g>f;f++){var b=u[f];d.setFrame(p++,b.time,b.name)}r.push(d),n=Math.max(n,d.frames[d.getFrameCount()-1])}}}i.animations.push(new c.Animation(t,r,n))}},c.SkeletonJson.readCurve=function(t,e,i){var r=i.curve;r&&("stepped"==r?t.curves.setStepped(e):r instanceof Array&&t.curves.setCurve(e,r[0],r[1],r[2],r[3]))},c.SkeletonJson.toColor=function(t,e){if(8!=t.length)throw"Color hexidecimal length must be 8, recieved: "+t;return parseInt(t.substring(2*e,2),16)/255},c.Atlas=function(t,e){this.textureLoader=e,this.pages=[],this.regions=[];var i=new c.AtlasReader(t),r=[];r.length=4;for(var n=null;;){var a=i.readLine();if(null==a)break;if(a=i.trim(a),0==a.length)n=null;else if(n){var o=new c.AtlasRegion;o.name=a,o.page=n,o.rotate="true"==i.readValue(),i.readTuple(r);var s=parseInt(r[0]),l=parseInt(r[1]);i.readTuple(r);var h=parseInt(r[0]),u=parseInt(r[1]);o.u=s/n.width,o.v=l/n.height,o.rotate?(o.u2=(s+u)/n.width,o.v2=(l+h)/n.height):(o.u2=(s+h)/n.width,o.v2=(l+u)/n.height),o.x=s,o.y=l,o.width=Math.abs(h),o.height=Math.abs(u),4==i.readTuple(r)&&(o.splits=[parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],4==i.readTuple(r)&&(o.pads=[parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],i.readTuple(r))),o.originalWidth=parseInt(r[0]),o.originalHeight=parseInt(r[1]),i.readTuple(r),o.offsetX=parseInt(r[0]),o.offsetY=parseInt(r[1]),o.index=parseInt(i.readValue()),this.regions.push(o)}else{n=new c.AtlasPage,n.name=a,n.format=c.Atlas.Format[i.readValue()],i.readTuple(r),n.minFilter=c.Atlas.TextureFilter[r[0]],n.magFilter=c.Atlas.TextureFilter[r[1]];var d=i.readValue();n.uWrap=c.Atlas.TextureWrap.clampToEdge,n.vWrap=c.Atlas.TextureWrap.clampToEdge,"x"==d?n.uWrap=c.Atlas.TextureWrap.repeat:"y"==d?n.vWrap=c.Atlas.TextureWrap.repeat:"xy"==d&&(n.uWrap=n.vWrap=c.Atlas.TextureWrap.repeat),e.load(n,a),this.pages.push(n)}}},c.Atlas.prototype={findRegion:function(t){for(var e=this.regions,i=0,r=e.length;r>i;i++)if(e[i].name==t)return e[i];return null},dispose:function(){for(var t=this.pages,e=0,i=t.length;i>e;e++)this.textureLoader.unload(t[e].rendererObject)},updateUVs:function(t){for(var e=this.regions,i=0,r=e.length;r>i;i++){var n=e[i];n.page==t&&(n.u=n.x/t.width,n.v=n.y/t.height,n.rotate?(n.u2=(n.x+n.height)/t.width,n.v2=(n.y+n.width)/t.height):(n.u2=(n.x+n.width)/t.width,n.v2=(n.y+n.height)/t.height))}}},c.Atlas.Format={alpha:0,intensity:1,luminanceAlpha:2,rgb565:3,rgba4444:4,rgb888:5,rgba8888:6},c.Atlas.TextureFilter={nearest:0,linear:1,mipMap:2,mipMapNearestNearest:3,mipMapLinearNearest:4,mipMapNearestLinear:5,mipMapLinearLinear:6},c.Atlas.TextureWrap={mirroredRepeat:0,clampToEdge:1,repeat:2},c.AtlasPage=function(){},c.AtlasPage.prototype={name:null,format:null,minFilter:null,magFilter:null,uWrap:null,vWrap:null,rendererObject:null,width:0,height:0},c.AtlasRegion=function(){},c.AtlasRegion.prototype={page:null,name:null,x:0,y:0,width:0,height:0,u:0,v:0,u2:0,v2:0,offsetX:0,offsetY:0,originalWidth:0,originalHeight:0,index:0,rotate:!1,splits:null,pads:null},c.AtlasReader=function(t){this.lines=t.split(/\r\n|\r|\n/)},c.AtlasReader.prototype={index:0,trim:function(t){return t.replace(/^\s+|\s+$/g,"")},readLine:function(){return this.index>=this.lines.length?null:this.lines[this.index++]},readValue:function(){var t=this.readLine(),e=t.indexOf(":");if(-1==e)throw"Invalid line: "+t;return this.trim(t.substring(e+1))},readTuple:function(t){var e=this.readLine(),i=e.indexOf(":");if(-1==i)throw"Invalid line: "+e;for(var r=0,n=i+1;3>r;r++){var a=e.indexOf(",",n);if(-1==a){if(0==r)throw"Invalid line: "+e;break}t[r]=this.trim(e.substr(n,a-n)),n=a+1}return t[r]=this.trim(e.substring(n)),r+1}},c.AtlasAttachmentLoader=function(t){this.atlas=t},c.AtlasAttachmentLoader.prototype={newAttachment:function(t,e,i){switch(e){case c.AttachmentType.region:var r=this.atlas.findRegion(i);if(!r)throw"Region not found in atlas: "+i+" ("+e+")";var n=new c.RegionAttachment(i);return n.rendererObject=r,n.setUVs(r.u,r.v,r.u2,r.v2,r.rotate),n.regionOffsetX=r.offsetX,n.regionOffsetY=r.offsetY,n.regionWidth=r.width,n.regionHeight=r.height,n.regionOriginalWidth=r.originalWidth,n.regionOriginalHeight=r.originalHeight,n}throw"Unknown attachment type: "+e}},n.AnimCache={},c.Bone.yDown=!0,n.CustomRenderable=function(){n.DisplayObject.call(this)},n.CustomRenderable.prototype=Object.create(n.DisplayObject.prototype),n.CustomRenderable.prototype.constructor=n.CustomRenderable,n.CustomRenderable.prototype.renderCanvas=function(){},n.CustomRenderable.prototype.initWebGL=function(){},n.CustomRenderable.prototype.renderWebGL=function(){},n.BaseTextureCache={},n.texturesToUpdate=[],n.texturesToDestroy=[],n.BaseTexture=function(t){function e(t){var e=new Blob([t]),i=window.URL.createObjectURL(e);r.source.onload=function(){r.hasLoaded=!0,r.width=r.source.width,r.height=r.source.height,n.texturesToUpdate.push(r),r.dispatchEvent({type:"loaded",content:r})},r.source.src=i}if(n.EventTarget.call(this),this.width=100,this.height=100,this.hasLoaded=!1,this.source=new Image,t){var i,r=this;(window.openDatabase||window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.oIndexedDB||window.msIndexedDB)&&!window.opera?localforage.getItem(t,function(r){r?(console.log(t+" was loaded from cache."),e(r)):(console.log(t+" was requested from network."),i=new XMLHttpRequest,i.open("GET",t,!0),i.responseType="arraybuffer",i.addEventListener("readystatechange",function(){4==i.readyState&&localforage.setItem(t,i.response,function(t){e(t)})}),i.send(null))}):(console.log("No cache optimizations for "+t),r.source.onload=function(){r.hasLoaded=!0,r.width=r.source.width,r.height=r.source.height,n.texturesToUpdate.push(r),r.dispatchEvent({type:"loaded",content:r})},r.source.src=t),this._powerOf2=!1}},n.BaseTexture.prototype.constructor=n.BaseTexture,n.BaseTexture.prototype.destroy=function(){this.source instanceof Image&&(this.source.src=null),this.source=null,n.texturesToDestroy.push(this)},n.BaseTexture.fromImage=function(t){var e=n.BaseTextureCache[t];return e||(e=new n.BaseTexture(t),n.BaseTextureCache[t]=e),e},n.TextureCache={},n.FrameCache={},n.Texture=function(t,e){if(n.EventTarget.call(this),e||(this.noFrame=!0,e=new n.Rectangle(0,0,1,1)),t instanceof n.Texture&&(t=t.baseTexture),this.baseTexture=t,this.frame=e,this.trim=new n.Point,this.scope=this,t.hasLoaded)this.noFrame&&(e=new n.Rectangle(0,0,t.width,t.height)),this.setFrame(e);else{var i=this;t.addEventListener("loaded",function(){i.onBaseTextureLoaded()})}},n.Texture.prototype.constructor=n.Texture,n.Texture.prototype.onBaseTextureLoaded=function(){var t=this.baseTexture;t.removeEventListener("loaded",this.onLoaded),this.noFrame&&(this.frame=new n.Rectangle(0,0,t.width,t.height)),this.noFrame=!1,this.width=this.frame.width,this.height=this.frame.height,this.scope.dispatchEvent({type:"update",content:this})},n.Texture.prototype.destroy=function(t){t&&this.baseTexture.destroy()},n.Texture.prototype.setFrame=function(t){if(this.frame=t,this.width=t.width,this.height=t.height,t.x+t.width>this.baseTexture.width||t.y+t.height>this.baseTexture.height)throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.updateFrame=!0,n.Texture.frameUpdates.push(this)},n.Texture.fromImage=function(t,e){var i=n.TextureCache[t];return i||(i=new n.Texture(n.BaseTexture.fromImage(t,e)),n.TextureCache[t]=i),i},n.Texture.fromFrame=function(t){var e=n.TextureCache[t];if(!e)throw new Error("The frameId '"+t+"' does not exist in the texture cache "+this);return e},n.Texture.fromCanvas=function(t){var e=new n.BaseTexture(t);return new n.Texture(e)},n.Texture.addTextureToCache=function(t,e){n.TextureCache[e]=t},n.Texture.removeTextureFromCache=function(t){var e=n.TextureCache[t];return n.TextureCache[t]=null,e},n.Texture.frameUpdates=[],n.RenderTexture=function(t,e){n.EventTarget.call(this),this.width=t||100,this.height=e||100,this.indetityMatrix=n.mat3.create(),this.frame=new n.Rectangle(0,0,this.width,this.height),n.gl?this.initWebGL():this.initCanvas()},n.RenderTexture.prototype=Object.create(n.Texture.prototype),n.RenderTexture.prototype.constructor=n.RenderTexture,n.RenderTexture.prototype.initWebGL=function(){var t=n.gl;this.glFramebuffer=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this.glFramebuffer),this.glFramebuffer.width=this.width,this.glFramebuffer.height=this.height,this.baseTexture=new n.BaseTexture,this.baseTexture.width=this.width,this.baseTexture.height=this.height,this.baseTexture._glTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.baseTexture._glTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),this.baseTexture.isRender=!0,t.bindFramebuffer(t.FRAMEBUFFER,this.glFramebuffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.baseTexture._glTexture,0),this.projection=new n.Point(this.width/2,this.height/2),this.render=this.renderWebGL},n.RenderTexture.prototype.resize=function(t,e){if(this.width=t,this.height=e,n.gl){this.projection.x=this.width/2,this.projection.y=this.height/2;var i=n.gl;i.bindTexture(i.TEXTURE_2D,this.baseTexture._glTexture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,this.width,this.height,0,i.RGBA,i.UNSIGNED_BYTE,null)}else this.frame.width=this.width,this.frame.height=this.height,this.renderer.resize(this.width,this.height)},n.RenderTexture.prototype.initCanvas=function(){this.renderer=new n.CanvasRenderer(this.width,this.height,null,0),this.baseTexture=new n.BaseTexture(this.renderer.view),this.frame=new n.Rectangle(0,0,this.width,this.height),this.render=this.renderCanvas},n.RenderTexture.prototype.renderWebGL=function(t,e,i){var r=n.gl;r.colorMask(!0,!0,!0,!0),r.viewport(0,0,this.width,this.height),r.bindFramebuffer(r.FRAMEBUFFER,this.glFramebuffer),i&&(r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT));var a=t.children,o=t.worldTransform;t.worldTransform=n.mat3.create(),t.worldTransform[4]=-1,t.worldTransform[5]=2*this.projection.y,e&&(t.worldTransform[2]=e.x,t.worldTransform[5]-=e.y),n.visibleCount++,t.vcount=n.visibleCount;for(var s=0,l=a.length;l>s;s++)a[s].updateTransform();var h=t.__renderGroup;h?t==h.root?h.render(this.projection):h.renderSpecific(t,this.projection):(this.renderGroup||(this.renderGroup=new n.WebGLRenderGroup(r)),this.renderGroup.setRenderable(t),this.renderGroup.render(this.projection)),t.worldTransform=o},n.RenderTexture.prototype.renderCanvas=function(t,e,i){var r=t.children;t.worldTransform=n.mat3.create(),e&&(t.worldTransform[2]=e.x,t.worldTransform[5]=e.y);for(var a=0,o=r.length;o>a;a++)r[a].updateTransform();i&&this.renderer.context.clearRect(0,0,this.width,this.height),this.renderer.renderDisplayObject(t),this.renderer.context.setTransform(1,0,0,1,0,0)},n.AssetLoader=function(t,e){n.EventTarget.call(this),this.assetURLs=t,this.crossorigin=e,this.loadersByType={jpg:n.ImageLoader,jpeg:n.ImageLoader,png:n.ImageLoader,gif:n.ImageLoader,json:n.JsonLoader,anim:n.SpineLoader,xml:n.BitmapFontLoader,fnt:n.BitmapFontLoader}},n.AssetLoader.prototype.constructor=n.AssetLoader,n.AssetLoader.prototype.load=function(){var t=this;this.loadCount=this.assetURLs.length;for(var e=0;e<this.assetURLs.length;e++){var i=this.assetURLs[e],r=i.split(".").pop().toLowerCase(),n=this.loadersByType[r];if(!n)throw new Error(r+" is an unsupported file type");var a=new n(i,this.crossorigin);a.addEventListener("loaded",function(){t.onAssetLoaded()}),a.load()}},n.AssetLoader.prototype.onAssetLoaded=function(){this.loadCount--,this.dispatchEvent({type:"onProgress",content:this}),this.onProgress&&this.onProgress(),0==this.loadCount&&(this.dispatchEvent({type:"onComplete",content:this}),this.onComplete&&this.onComplete())},n.JsonLoader=function(t,e){n.EventTarget.call(this),this.url=t,this.crossorigin=e,this.baseUrl=t.replace(/[^\/]*$/,""),this.loaded=!1},n.JsonLoader.prototype.constructor=n.JsonLoader,n.JsonLoader.prototype.load=function(){function t(){e.ajaxRequest=new h,e.ajaxRequest.onreadystatechange=function(){4==e.ajaxRequest.readyState&&(200==e.ajaxRequest.status||-1==window.location.href.indexOf("http")?(e.json=JSON.parse(e.ajaxRequest.responseText),localforage.setItem(e.url,e.json,function(){e.onJSONLoaded()})):e.onError())},e.ajaxRequest.open("GET",e.url,!0),e.ajaxRequest.overrideMimeType&&e.ajaxRequest.overrideMimeType("application/json"),e.ajaxRequest.send(null)}var e=this;localforage.getItem(e.url,function(i){i?(console.log(e.url+" was loaded from cache."),e.json=JSON.parse(JSON.stringify(i)),e.onJSONLoaded()):(console.log(e.url+" was loaded from network."),t())})},n.JsonLoader.prototype.onJSONLoaded=function(){if(this.json.frames){var t=this,e=this.baseUrl+this.json.meta.image,i=new n.ImageLoader(e,this.crossorigin),r=this.json.frames;this.texture=i.texture.baseTexture,i.addEventListener("loaded",function(){t.onLoaded()});for(var a in r){var o=this.baseUrl+a,s=r[a].frame;s&&(n.TextureCache[o]=new n.Texture(this.texture,{x:s.x,y:s.y,width:s.w,height:s.h}),r[a].trimmed&&(n.TextureCache[o].realSize=r[a].spriteSourceSize,n.TextureCache[o].trim.x=0))}i.load()}else if(this.json.bones){var l=new c.SkeletonJson,h=l.readSkeletonData(this.json);n.AnimCache[this.url]=h,this.onLoaded()}else this.onLoaded()},n.JsonLoader.prototype.onLoaded=function(){this.loaded=!0,this.dispatchEvent({type:"loaded",content:this})},n.JsonLoader.prototype.onError=function(){this.dispatchEvent({type:"error",content:this})},n.SpriteSheetLoader=function(t,e){n.EventTarget.call(this),this.url=t,this.crossorigin=e,this.baseUrl=t.replace(/[^\/]*$/,""),this.texture=null,this.frames={}},n.SpriteSheetLoader.prototype.constructor=n.SpriteSheetLoader,n.SpriteSheetLoader.prototype.load=function(){var t=this,e=new n.JsonLoader(this.url,this.crossorigin);e.addEventListener("loaded",function(e){t.json=e.content.json,t.onJSONLoaded()}),e.load()},n.SpriteSheetLoader.prototype.onJSONLoaded=function(){var t=this,e=this.baseUrl+this.json.meta.image,i=new n.ImageLoader(e,this.crossorigin),r=this.json.frames;this.texture=i.texture.baseTexture,i.addEventListener("loaded",function(){t.onLoaded()});for(var a in r){var o=this.baseUrl+a,s=r[a].frame;s&&(n.TextureCache[o]=new n.Texture(this.texture,{x:s.x,y:s.y,width:s.w,height:s.h}),r[o].trimmed&&(n.TextureCache[o].realSize=r[a].spriteSourceSize,n.TextureCache[o].trim.x=0))}i.load()},n.SpriteSheetLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},n.ImageLoader=function(t,e){n.EventTarget.call(this),this.texture=n.Texture.fromImage(t,e)},n.ImageLoader.prototype.constructor=n.ImageLoader,n.ImageLoader.prototype.load=function(){if(this.texture.baseTexture.hasLoaded)this.onLoaded();else{var t=this;this.texture.baseTexture.addEventListener("loaded",function(){t.onLoaded()})}},n.ImageLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},n.BitmapFontLoader=function(t,e){n.EventTarget.call(this),this.url=t,this.crossorigin=e,this.baseUrl=t.replace(/[^\/]*$/,""),this.texture=null},n.BitmapFontLoader.prototype.constructor=n.BitmapFontLoader,n.BitmapFontLoader.prototype.load=function(){this.ajaxRequest=new XMLHttpRequest;var t=this;this.ajaxRequest.onreadystatechange=function(){t.onXMLLoaded()},this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/xml"),this.ajaxRequest.send(null)},n.BitmapFontLoader.prototype.onXMLLoaded=function(){if(4==this.ajaxRequest.readyState&&(200==this.ajaxRequest.status||-1==window.location.href.indexOf("http"))){var t=this.baseUrl+this.ajaxRequest.responseXML.getElementsByTagName("page")[0].attributes.getNamedItem("file").nodeValue,e=new n.ImageLoader(t,this.crossorigin);this.texture=e.texture.baseTexture;var i={},r=this.ajaxRequest.responseXML.getElementsByTagName("info")[0],a=this.ajaxRequest.responseXML.getElementsByTagName("common")[0];i.font=r.attributes.getNamedItem("face").nodeValue,i.size=parseInt(r.attributes.getNamedItem("size").nodeValue,10),i.lineHeight=parseInt(a.attributes.getNamedItem("lineHeight").nodeValue,10),i.chars={};for(var o=this.ajaxRequest.responseXML.getElementsByTagName("char"),s=0;s<o.length;s++){var l=parseInt(o[s].attributes.getNamedItem("id").nodeValue,10),h={x:parseInt(o[s].attributes.getNamedItem("x").nodeValue,10),y:parseInt(o[s].attributes.getNamedItem("y").nodeValue,10),width:parseInt(o[s].attributes.getNamedItem("width").nodeValue,10),height:parseInt(o[s].attributes.getNamedItem("height").nodeValue,10)};n.TextureCache[l]=new n.Texture(this.texture,h),i.chars[l]={xOffset:parseInt(o[s].attributes.getNamedItem("xoffset").nodeValue,10),yOffset:parseInt(o[s].attributes.getNamedItem("yoffset").nodeValue,10),xAdvance:parseInt(o[s].attributes.getNamedItem("xadvance").nodeValue,10),kerning:{},texture:new n.Texture(this.texture,h)}}var c=this.ajaxRequest.responseXML.getElementsByTagName("kerning");for(s=0;s<c.length;s++){var u=parseInt(c[s].attributes.getNamedItem("first").nodeValue,10),d=parseInt(c[s].attributes.getNamedItem("second").nodeValue,10),p=parseInt(c[s].attributes.getNamedItem("amount").nodeValue,10);i.chars[d].kerning[u]=p}n.BitmapText.fonts[i.font]=i;var f=this;e.addEventListener("loaded",function(){f.onLoaded()}),e.load()}},n.BitmapFontLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},n.SpineLoader=function(t,e){n.EventTarget.call(this),this.url=t,this.crossorigin=e,this.loaded=!1},n.SpineLoader.prototype.constructor=n.SpineLoader,n.SpineLoader.prototype.load=function(){var t=this,e=new n.JsonLoader(this.url,this.crossorigin);e.addEventListener("loaded",function(e){t.json=e.content.json,t.onJSONLoaded()}),e.load()},n.SpineLoader.prototype.onJSONLoaded=function(){var t=new c.SkeletonJson,e=t.readSkeletonData(this.json);n.AnimCache[this.url]=e,this.onLoaded()},n.SpineLoader.prototype.onLoaded=function(){this.loaded=!0,this.dispatchEvent({type:"loaded",content:this})},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=n),exports.PIXI=n):i.PIXI=n}).call(this),function(){var t,e,i,r;!function(){var n={},a={};t=function(t,e,i){n[t]={deps:e,callback:i}},r=i=e=function(t){function i(e){if("."!==e.charAt(0))return e;for(var i=e.split("/"),r=t.split("/").slice(0,-1),n=0,a=i.length;a>n;n++){var o=i[n];if(".."===o)r.pop();else{if("."===o)continue;r.push(o)}}return r.join("/")}if(r._eak_seen=n,a[t])return a[t];if(a[t]={},!n[t])throw new Error("Could not find module "+t);for(var o,s=n[t],l=s.deps,h=s.callback,c=[],u=0,d=l.length;d>u;u++)c.push("exports"===l[u]?o={}:e(i(l[u])));var p=h.apply(this,c);return a[t]=o||p}}(),t("promise/all",["./utils","exports"],function(t,e){"use strict";function i(t){var e=this;if(!r(t))throw new TypeError("You must pass an array to all.");return new e(function(e,i){function r(t){return function(e){a(t,e)}}function a(t,i){s[t]=i,0===--l&&e(s)}var o,s=[],l=t.length;0===l&&e([]);for(var h=0;h<t.length;h++)o=t[h],o&&n(o.then)?o.then(r(h),i):a(h,o)})}var r=t.isArray,n=t.isFunction;e.all=i}),t("promise/asap",["exports"],function(t){"use strict";function e(){return function(){process.nextTick(n)}}function i(){var t=0,e=new l(n),i=document.createTextNode("");return e.observe(i,{characterData:!0}),function(){i.data=t=++t%2}}function r(){return function(){h.setTimeout(n,1)}}function n(){for(var t=0;t<c.length;t++){var e=c[t],i=e[0],r=e[1];i(r)}c=[]}function a(t,e){var i=c.push([t,e]);1===i&&o()}var o,s="undefined"!=typeof window?window:{},l=s.MutationObserver||s.WebKitMutationObserver,h="undefined"!=typeof global?global:void 0===this?window:this,c=[];o="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?e():l?i():r(),t.asap=a}),t("promise/config",["exports"],function(t){"use strict";function e(t,e){return 2!==arguments.length?i[t]:void(i[t]=e)}var i={instrument:!1};t.config=i,t.configure=e}),t("promise/polyfill",["./promise","./utils","exports"],function(t,e,i){"use strict";function r(){var t;t="undefined"!=typeof global?global:"undefined"!=typeof window&&window.document?window:self;var e="Promise"in t&&"resolve"in t.Promise&&"reject"in t.Promise&&"all"in t.Promise&&"race"in t.Promise&&function(){var e;return new t.Promise(function(t){e=t}),a(e)}();e||(t.Promise=n)}var n=t.Promise,a=e.isFunction;i.polyfill=r}),t("promise/promise",["./config","./utils","./all","./race","./resolve","./reject","./asap","exports"],function(t,e,i,r,n,a,o,s){"use strict";function l(t){if(!T(t))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof l))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._subscribers=[],h(t,this)}function h(t,e){function i(t){f(e,t)}function r(t){b(e,t)}try{t(i,r)}catch(n){r(n)}}function c(t,e,i,r){var n,a,o,s,l=T(i);if(l)try{n=i(r),o=!0}catch(h){s=!0,a=h}else n=r,o=!0;p(e,n)||(l&&o?f(e,n):s?b(e,a):t===j?f(e,n):t===L&&b(e,n))}function u(t,e,i,r){var n=t._subscribers,a=n.length;n[a]=e,n[a+j]=i,n[a+L]=r}function d(t,e){for(var i,r,n=t._subscribers,a=t._detail,o=0;o<n.length;o+=3)i=n[o],r=n[o+e],c(e,i,r,a);t._subscribers=null}function p(t,e){var i,r=null;try{if(t===e)throw new TypeError("A promises callback cannot return that same promise.");if(x(e)&&(r=e.then,T(r)))return r.call(e,function(r){return i?!0:(i=!0,void(e!==r?f(t,r):g(t,r)))},function(e){return i?!0:(i=!0,void b(t,e))}),!0}catch(n){return i?!0:(b(t,n),!0)}return!1}function f(t,e){t===e?g(t,e):p(t,e)||g(t,e)}function g(t,e){t._state===E&&(t._state=R,t._detail=e,y.async(m,t))}function b(t,e){t._state===E&&(t._state=R,t._detail=e,y.async(v,t))}function m(t){d(t,t._state=j)}function v(t){d(t,t._state=L)}var y=t.config,x=(t.configure,e.objectOrFunction),T=e.isFunction,w=(e.now,i.all),_=r.race,A=n.resolve,S=a.reject,C=o.asap;y.async=C;var E=void 0,R=0,j=1,L=2;l.prototype={constructor:l,_state:void 0,_detail:void 0,_subscribers:void 0,then:function(t,e){var i=this,r=new this.constructor(function(){});if(this._state){var n=arguments;y.async(function(){c(i._state,r,n[i._state-1],i._detail)})}else u(this,r,t,e);return r},"catch":function(t){return this.then(null,t)}},l.all=w,l.race=_,l.resolve=A,l.reject=S,s.Promise=l}),t("promise/race",["./utils","exports"],function(t,e){"use strict";function i(t){var e=this;if(!r(t))throw new TypeError("You must pass an array to race.");return new e(function(e,i){for(var r,n=0;n<t.length;n++)r=t[n],r&&"function"==typeof r.then?r.then(e,i):e(r)})}var r=t.isArray;e.race=i}),t("promise/reject",["exports"],function(t){"use strict";function e(t){var e=this;return new e(function(e,i){i(t)})}t.reject=e}),t("promise/resolve",["exports"],function(t){"use strict";function e(t){if(t&&"object"==typeof t&&t.constructor===this)return t;var e=this;return new e(function(e){e(t)})}t.resolve=e}),t("promise/utils",["exports"],function(t){"use strict";function e(t){return i(t)||"object"==typeof t&&null!==t}function i(t){return"function"==typeof t}function r(t){return"[object Array]"===Object.prototype.toString.call(t)}var n=Date.now||function(){return(new Date).getTime()};t.objectOrFunction=e,t.isFunction=i,t.isArray=r,t.now=n}),e("promise/polyfill").polyfill()}(),function(){"use strict";function t(t){if(t)for(var e in t)h[e]=t[e];return new s(function(t,e){var i=c.open(h.name,h.version);i.onerror=function(){e(i.error)},i.onupgradeneeded=function(){i.result.createObjectStore(h.storeName)},i.onsuccess=function(){l=i.result,t()}})}function e(t,e){var i=this;return new s(function(r,n){i.ready().then(function(){var i=l.transaction(h.storeName,"readonly").objectStore(h.storeName),a=i.get(t);a.onsuccess=function(){var t=a.result;void 0===t&&(t=null),e&&e(t),r(t)},a.onerror=function(){e&&e(null,a.error),n(a.error)}})})}function i(t,e,i){var r=this;return new s(function(n,a){r.ready().then(function(){var r=l.transaction(h.storeName,"readwrite").objectStore(h.storeName);void 0===e&&(e=null);var o=r.put(e,t);o.onsuccess=function(){i&&i(e),n(e)},o.onerror=function(){i&&i(null,o.error),a(o.error)}})})}function r(t,e){var i=this;return new s(function(r,n){i.ready().then(function(){var i=l.transaction(h.storeName,"readwrite").objectStore(h.storeName),a=i["delete"](t);a.onsuccess=function(){e&&e(),r()},a.onerror=function(){e&&e(a.error),n(a.error)},a.onabort=function(t){var i=t.target.error;"QuotaExceededError"===i&&(e&&e(i),n(i))}})})}function n(t){var e=this;return new s(function(i,r){e.ready().then(function(){var e=l.transaction(h.storeName,"readwrite").objectStore(h.storeName),n=e.clear();n.onsuccess=function(){t&&t(),i()},n.onerror=function(){t&&t(null,n.error),r(n.error)}})})}function a(t){var e=this;
return new s(function(i,r){e.ready().then(function(){var e=l.transaction(h.storeName,"readonly").objectStore(h.storeName),n=e.count();n.onsuccess=function(){t&&t(n.result),i(n.result)},n.onerror=function(){t&&t(null,n.error),r(n.error)}})})}function o(t,e){var i=this;return new s(function(r,n){return 0>t?(e&&e(null),void r(null)):void i.ready().then(function(){var i=l.transaction(h.storeName,"readonly").objectStore(h.storeName),a=!1,o=i.openCursor();o.onsuccess=function(){var i=o.result;return i?void(0===t?(e&&e(i.key),r(i.key)):a?(e&&e(i.key),r(i.key)):(a=!0,i.advance(t))):(e&&e(null),void r(null))},o.onerror=function(){e&&e(null,o.error),n(o.error)}})})}var s="undefined"!=typeof module&&module.exports?require("promise"):this.Promise,l=null,h={},c=c||this.indexedDB||this.webkitIndexedDB||this.mozIndexedDB||this.OIndexedDB||this.msIndexedDB;if(c){var u={_driver:"asyncStorage",_initStorage:t,getItem:e,setItem:i,removeItem:r,clear:n,length:a,key:o};"function"==typeof define&&define.amd?define("asyncStorage",function(){return u}):"undefined"!=typeof module&&module.exports?module.exports=u:this.asyncStorage=u}}.call(this),function(){"use strict";function t(t){if(t)for(var e in t)u[e]=t[e];return c=u.name+"/",d.resolve()}function e(t){var e=this;return new d(function(i){e.ready().then(function(){p.clear(),t&&t(),i()})})}function i(t,e){var i=this;return new d(function(r,n){i.ready().then(function(){try{var i=p.getItem(c+t);i&&(i=o(i)),e&&e(i,null),r(i)}catch(a){e&&e(null,a),n(a)}})})}function r(t,e){var i=this;return new d(function(r){i.ready().then(function(){var i=p.key(t);i&&(i=i.substring(c.length)),e&&e(i),r(i)})})}function n(t){var e=this;return new d(function(i){e.ready().then(function(){var e=p.length;t&&t(e),i(e)})})}function a(t,e){var i=this;return new d(function(r){i.ready().then(function(){p.removeItem(c+t),e&&e(),r()})})}function o(t){if(t.substring(0,b)!==g)return JSON.parse(t);for(var e=t.substring(R),i=t.substring(b,R),r=new ArrayBuffer(2*e.length),n=new Uint16Array(r),a=e.length-1;a>=0;a--)n[a]=e.charCodeAt(a);switch(i){case m:return r;case v:return new Blob([r]);case y:return new Int8Array(r);case x:return new Uint8Array(r);case T:return new Uint8ClampedArray(r);case w:return new Int16Array(r);case A:return new Uint16Array(r);case _:return new Int32Array(r);case S:return new Uint32Array(r);case C:return new Float32Array(r);case E:return new Float64Array(r);default:throw new Error("Unkown type: "+i)}}function s(t){var e="",i=new Uint16Array(t);try{e=String.fromCharCode.apply(null,i)}catch(r){for(var n=0;n<i.length;n++)e+=String.fromCharCode(i[n])}return e}function l(t,e){var i="";if(t&&(i=t.toString()),t&&("[object ArrayBuffer]"===t.toString()||t.buffer&&"[object ArrayBuffer]"===t.buffer.toString())){var r,n=g;t instanceof ArrayBuffer?(r=t,n+=m):(r=t.buffer,"[object Int8Array]"===i?n+=y:"[object Uint8Array]"===i?n+=x:"[object Uint8ClampedArray]"===i?n+=T:"[object Int16Array]"===i?n+=w:"[object Uint16Array]"===i?n+=A:"[object Int32Array]"===i?n+=_:"[object Uint32Array]"===i?n+=S:"[object Float32Array]"===i?n+=C:"[object Float64Array]"===i?n+=E:e(new Error("Failed to get type for BinaryArray"))),e(n+s(r))}else if("[object Blob]"===i){var a=new FileReader;a.onload=function(){var t=s(this.result);e(g+v+t)},a.readAsArrayBuffer(t)}else try{e(JSON.stringify(t))}catch(o){this.console&&this.console.error&&this.console.error("Couldn't convert value into a JSON string: ",t),e(null,o)}}function h(t,e,i){var r=this;return new d(function(n,a){r.ready().then(function(){void 0===e&&(e=null);var r=e;l(e,function(e,o){if(o)i&&i(null,o),a(o);else{try{p.setItem(c+t,e)}catch(s){("QuotaExceededError"===s.name||"NS_ERROR_DOM_QUOTA_REACHED"===s.name)&&(i&&i(null,s),a(s))}i&&i(r),n(r)}})})})}var c="",u={},d="undefined"!=typeof module&&module.exports?require("promise"):this.Promise,p=null;try{p=this.localStorage}catch(f){return}var g="__lfsc__:",b=g.length,m="arbf",v="blob",y="si08",x="ui08",T="uic8",w="si16",_="si32",A="ur16",S="ui32",C="fl32",E="fl64",R=b+m.length,j={_driver:"localStorageWrapper",_initStorage:t,getItem:i,setItem:h,removeItem:a,clear:e,length:n,key:r};"function"==typeof define&&define.amd?define("localStorageWrapper",function(){return j}):"undefined"!=typeof module&&module.exports?module.exports=j:this.localStorageWrapper=j}.call(this),function(){"use strict";function t(t){var e=this;if(t)for(var i in t)f[i]="string"!=typeof t[i]?t[i].toString():t[i];return new u(function(t){try{p=d(f.name,f.version,f.description,f.size)}catch(i){return e.setDriver("localStorageWrapper").then(t)}p.transaction(function(e){e.executeSql("CREATE TABLE IF NOT EXISTS "+f.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],function(){t()},null)})})}function e(t,e){var i=this;return new u(function(r,n){i.ready().then(function(){p.transaction(function(i){i.executeSql("SELECT * FROM "+f.storeName+" WHERE key = ? LIMIT 1",[t],function(t,i){var n=i.rows.length?i.rows.item(0).value:null;n&&(n=l(n)),e&&e(n),r(n)},function(t,i){e&&e(null,i),n(i)})})})})}function i(t,e,i){var r=this;return new u(function(n,a){r.ready().then(function(){void 0===e&&(e=null);var r=e;h(e,function(e,o){o?a(o):p.transaction(function(o){o.executeSql("INSERT OR REPLACE INTO "+f.storeName+" (key, value) VALUES (?, ?)",[t,e],function(){i&&i(r),n(r)},function(t,e){i&&i(null,e),a(e)})},function(t){t.code===t.QUOTA_ERR&&(i&&i(null,t),a(t))})})})})}function r(t,e){var i=this;return new u(function(r,n){i.ready().then(function(){p.transaction(function(i){i.executeSql("DELETE FROM "+f.storeName+" WHERE key = ?",[t],function(){e&&e(),r()},function(t,i){e&&e(i),n(i)})})})})}function n(t){var e=this;return new u(function(i,r){e.ready().then(function(){p.transaction(function(e){e.executeSql("DELETE FROM "+f.storeName,[],function(){t&&t(),i()},function(e,i){t&&t(i),r(i)})})})})}function a(t){var e=this;return new u(function(i,r){e.ready().then(function(){p.transaction(function(e){e.executeSql("SELECT COUNT(key) as c FROM "+f.storeName,[],function(e,r){var n=r.rows.item(0).c;t&&t(n),i(n)},function(e,i){t&&t(null,i),r(i)})})})})}function o(t,e){var i=this;return new u(function(r,n){i.ready().then(function(){p.transaction(function(i){i.executeSql("SELECT key FROM "+f.storeName+" WHERE id = ? LIMIT 1",[t+1],function(t,i){var n=i.rows.length?i.rows.item(0).key:null;e&&e(n),r(n)},function(t,i){e&&e(null,i),n(i)})})})})}function s(t){var e,i=new Uint8Array(t),r="";for(e=0;e<i.length;e+=3)r+=c[i[e]>>2],r+=c[(3&i[e])<<4|i[e+1]>>4],r+=c[(15&i[e+1])<<2|i[e+2]>>6],r+=c[63&i[e+2]];return i.length%3===2?r=r.substring(0,r.length-1)+"=":i.length%3===1&&(r=r.substring(0,r.length-2)+"=="),r}function l(t){if(t.substring(0,b)!==g)return JSON.parse(t);var e,i,r,n,a,o=t.substring(R),s=t.substring(b,R),l=.75*o.length,h=o.length,u=0;"="===o[o.length-1]&&(l--,"="===o[o.length-2]&&l--);var d=new ArrayBuffer(l),p=new Uint8Array(d);for(e=0;h>e;e+=4)i=c.indexOf(o[e]),r=c.indexOf(o[e+1]),n=c.indexOf(o[e+2]),a=c.indexOf(o[e+3]),p[u++]=i<<2|r>>4,p[u++]=(15&r)<<4|n>>2,p[u++]=(3&n)<<6|63&a;switch(s){case m:return d;case v:return new Blob([d]);case y:return new Int8Array(d);case x:return new Uint8Array(d);case T:return new Uint8ClampedArray(d);case w:return new Int16Array(d);case A:return new Uint16Array(d);case _:return new Int32Array(d);case S:return new Uint32Array(d);case C:return new Float32Array(d);case E:return new Float64Array(d);default:throw new Error("Unkown type: "+s)}}function h(t,e){var i="";if(t&&(i=t.toString()),t&&("[object ArrayBuffer]"===t.toString()||t.buffer&&"[object ArrayBuffer]"===t.buffer.toString())){var r,n=g;t instanceof ArrayBuffer?(r=t,n+=m):(r=t.buffer,"[object Int8Array]"===i?n+=y:"[object Uint8Array]"===i?n+=x:"[object Uint8ClampedArray]"===i?n+=T:"[object Int16Array]"===i?n+=w:"[object Uint16Array]"===i?n+=A:"[object Int32Array]"===i?n+=_:"[object Uint32Array]"===i?n+=S:"[object Float32Array]"===i?n+=C:"[object Float64Array]"===i?n+=E:e(new Error("Failed to get type for BinaryArray"))),e(n+s(r))}else if("[object Blob]"===i){var a=new FileReader;a.onload=function(){var t=s(this.result);e(g+v+t)},a.readAsArrayBuffer(t)}else try{e(JSON.stringify(t))}catch(o){this.console&&this.console.error&&this.console.error("Couldn't convert value into a JSON string: ",t),e(null,o)}}var c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u="undefined"!=typeof module&&module.exports?require("promise"):this.Promise,d=this.openDatabase,p=null,f={},g="__lfsc__:",b=g.length,m="arbf",v="blob",y="si08",x="ui08",T="uic8",w="si16",_="si32",A="ur16",S="ui32",C="fl32",E="fl64",R=b+m.length;if(d){var j={_driver:"webSQLStorage",_initStorage:t,getItem:e,setItem:i,removeItem:r,clear:n,length:a,key:o};"function"==typeof define&&define.amd?define("webSQLStorage",function(){return j}):"undefined"!=typeof module&&module.exports?module.exports=j:this.webSQLStorage=j}}.call(this),function(){"use strict";var t="undefined"!=typeof module&&module.exports?require("promise"):this.Promise,e=1,i=2,r=3,n=r;"function"==typeof define&&define.amd?n=e:"undefined"!=typeof module&&module.exports&&(n=i);var a,o=o||this.indexedDB||this.webkitIndexedDB||this.mozIndexedDB||this.OIndexedDB||this.msIndexedDB,s=o&&null===o.open("_localforage_spec_test",1).onupgradeneeded,l=this.openDatabase,h=this,c={INDEXEDDB:"asyncStorage",LOCALSTORAGE:"localStorageWrapper",WEBSQL:"webSQLStorage",_config:{description:"",name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1},config:function(t){if("object"==typeof t){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var e in t)this._config[e]=t[e];return!0}return"string"==typeof t?this._config[t]:this._config},driver:function(){return this._driver||null},_ready:t.reject(new Error("setDriver() wasn't called")),setDriver:function(r,a){var o=new t(function(t,a){if(!s&&r===c.INDEXEDDB||!l&&r===c.WEBSQL)return void a(c);if(c._ready=null,n===e)return void require([r],function(e){c._extend(e),t(c)});if(n===i){var o;switch(r){case c.INDEXEDDB:o=require("./drivers/indexeddb");break;case c.LOCALSTORAGE:o=require("./drivers/localstorage");break;case c.WEBSQL:o=require("./drivers/websql")}c._extend(o)}else c._extend(h[r]);t(c)});return o.then(a,a),o},ready:function(t){return null===this._ready&&(this._ready=this._initStorage(this._config)),this._ready.then(t,t),this._ready},_extend:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e])}};a=s?c.INDEXEDDB:l?c.WEBSQL:c.LOCALSTORAGE,this.localForageConfig&&(c.config=this.localForageConfig),c.setDriver(a),n===e?define(function(){return c}):n===i?module.exports=c:this.localforage=c}.call(this);var globals={paths:{},graph:{},objects:{},triggers:{},objectClicked:!1,viewport:{resize:!1,scale:1},scale:1,volume:.5,locale:"ru"},scene=function(){function t(){requestAnimFrame(t),i.render(e)}var e,i,r,n=0,a=0;return{init:function(o){var s,l=this;return r=document.getElementById(o.canvasId),e=new PIXI.Stage(0,!0),l.scale=globals.sceneHeight/r.clientHeight,l.width=l.scale*r.clientWidth,l.height=l.scale*r.clientHeight,i=new PIXI.CanvasRenderer(l.width,globals.sceneHeight,r,!1),window.addEventListener("resize",function(){l.scale=globals.sceneHeight/r.clientHeight,l.width=l.scale*r.clientWidth,l.height=l.scale*r.clientHeight,i.resize(l.width,globals.sceneHeight),globals.scale=globals.sceneHeight/document.body.clientHeight,globals.objects.hero&&globals.objects.hero.move({x:globals.objects.hero.image.position.x,y:globals.objects.hero.image.position.y}),graph&&graph.buildGraph({})}),s=new PIXI.DisplayObjectContainer,s.position.x=n,s.position.y=a,e.addChild(s),t(),l.stage=e,l.playGround=s,l.zindex=Z.zindex,l},addObj:function(t){var e=this;return Z.addZindex(t),t.ai&&t.ai.start(),e},move:function(t){var e=this,i=(e.height/globals.scale-e.height/globals.scale*globals.viewport.scale)*globals.scale,r=(e.width/globals.scale-globals.sceneWidth/globals.scale*globals.viewport.scale)*globals.scale;return e.playGround.position.x=t.dx||e.playGround.position.x,e.playGround.position.y=t.dy||e.playGround.position.y,e.playGround.position.x=e.playGround.position.x<r?r:e.playGround.position.x,e.playGround.position.x=e.playGround.position.x>0?0:e.playGround.position.x,e.playGround.position.y=e.playGround.position.y<i?i:e.playGround.position.y,e.playGround.position.y=e.playGround.position.y>0?0:e.playGround.position.y,debug&&(document.querySelector(".debug__wrap").scrollLeft=(t.dx||e.playGround.position.x)/globals.scale*-1),e}}}(),Z=function(){var t={base:{index:null,next:null,children:null}};return{getZindex:function(){return t},addZindex:function(e){function i(i){var r=Math.random();return t[e.z].children[r]={index:e.pz,data:e,next:i},e.priorityZindex=r,t[e.z].children[r]}void 0===t[e.z]&&(t[e.z]={index:e.z,next:null,children:{base:{index:null,data:null,next:null}}},t[e.z].children.base.next=i(null));for(var r,n,a=t.base,o=t.base,s=0;null!==a;)if(null!==a.index){if(s+=Object.keys(a.children).length-1,!(a.index<e.z)){if(a.index>e.z){t[e.z].next=o.next,o.next=t[e.z];break}for(r=a.children.base,n=a.children.base;null!==r;)if(null!==r.index){if(s++,!(r.index<=e.pz)){n.next=i(n.next);break}if(null===r.next){r.next=i(null);break}n=r,r=r.next}else{if(null===r.next){r.next=i(null);break}n=r,r=r.next}break}if(null===a.next){a.next=t[e.z];break}o=a,a=a.next}else{if(null===a.next){a.next=t[e.z];break}a=a.next}e.stackZindex=s,Z.drawZindex()},changeZindex:function(e){for(var i=e.obj.z,r=e.obj.priorityZindex,n=t[i].children.base;n.next!==t[i].children[r];)n=n.next;n.next=n.next.next,delete t[i].children[r],e.obj.z=e.z,Z.addZindex(e.obj)},drawZindex:function(){for(var e,i=t.base.next;scene.playGround.children.length;)scene.playGround.removeChild(scene.playGround.children[0]);for(;null!==i;){for(e=i.children.base.next;null!==e;)scene.playGround.addChild(e.data.image),e=e.next;i=i.next}}}}(),viewport=function(){function t(t){globals.viewport.resize=!0,globals.viewport.distance=Math.sqrt((t.x1-t.x2)*(t.x1-t.x2)+(t.y1-t.y2)*(t.y1-t.y2)),globals.viewport.sceneX=scene.playGround.position.x-globals.objects.hero.image.position.x*(1-globals.viewport.scale),globals.viewport.sceneY=scene.playGround.position.y-(globals.objects.hero.image.position.y+n)*(1-globals.viewport.scale)}function e(t){var e,i,r,a,o,s,l=Math.sqrt((t.x1-t.x2)*(t.x1-t.x2)+(t.y1-t.y2)*(t.y1-t.y2)),h=globals.viewport.scale*(l/globals.viewport.distance);return 1>h?(globals.viewport.scale=1,!1):h>2.5?(globals.viewport.scale=2.5,!1):(e=globals.objects.hero.image.position.x*(1-h),i=(globals.objects.hero.image.position.y+n)*(1-h),r=globals.viewport.sceneX+e,a=globals.viewport.sceneY+i,o=(scene.height/globals.scale-scene.height/globals.scale*h)*globals.scale,s=(scene.width/globals.scale-globals.sceneWidth/globals.scale*h)*globals.scale,r=s>r?s:r,r=r>0?0:r,a=o>a?o:a,a=a>0?0:a,scene.playGround.scale={x:h,y:h},scene.playGround.position.x=r,scene.playGround.position.y=a,globals.viewport.x=e,void(globals.viewport.y=i))}function i(){setTimeout(function(){globals.viewport.resize=!1},100),globals.viewport.scale=scene.playGround.scale.x}function r(){void 0!==document.ontouchend?(window.addEventListener("touchstart",function(e){e.preventDefault(),e.touches.length>1&&t({x1:e.touches[0].pageX,x2:e.touches[1].pageX,y1:e.touches[0].pageY,y2:e.touches[1].pageY})}),window.addEventListener("touchmove",function(t){globals.viewport.resize&&t.touches.length>1&&e({x1:t.touches[0].pageX,x2:t.touches[1].pageX,y1:t.touches[0].pageY,y2:t.touches[1].pageY})}),window.addEventListener("touchend",function(){globals.viewport.resize&&i()})):(window.addEventListener("mousedown",function(e){e.altKey&&t({x1:e.pageX,x2:0,y1:e.pageY,y2:0})}),window.addEventListener("mousemove",function(t){globals.viewport.resize&&e({x1:t.pageX,x2:0,y1:t.pageY,y2:0})}),window.addEventListener("mouseup",function(){globals.viewport.resize&&i()}))}var n=0;return{init:function(){r()}}}(),pathfinder=function(){function t(t){function e(t){var e={animation:t.animation,speed:t.speed};return e.animation=e.animation||globals.paths[t.pathId].objects&&globals.paths[t.pathId].objects[t.obj]&&globals.paths[t.pathId].objects[t.obj].animation||globals.objects[t.obj].image.spineData.animations[0].name,e.speed=e.speed||globals.paths[t.pathId].objects&&globals.paths[t.pathId].objects[t.obj]&&globals.paths[t.pathId].objects[t.obj].speed||0,e}function i(t,e){var i,r,n={x:globals.paths[t].dots[0].mainHandle.x,y:globals.paths[t].dots[0].mainHandle.y},a={x:globals.paths[t].dots[globals.paths[t].dots.length-1].mainHandle.x,y:globals.paths[t].dots[globals.paths[t].dots.length-1].mainHandle.y},o={x:globals.paths[e].dots[0].mainHandle.x,y:globals.paths[e].dots[0].mainHandle.y},s={x:globals.paths[e].dots[globals.paths[e].dots.length-1].mainHandle.x,y:globals.paths[e].dots[globals.paths[e].dots.length-1].mainHandle.y};return n.x===o.x&&n.y===o.y&&(i=0,r=0),n.x===s.x&&n.y===s.y&&(i=0,r=globals.paths[e].steps.length),a.x===o.x&&a.y===o.y&&(i=globals.paths[t].controlPath.length-1,r=0),a.x===s.x&&a.y===s.y&&(i=globals.paths[t].controlPath.length-1,r=globals.paths[e].steps.length),{serviceChain:i,serviceStep:r}}var r,n,a,o,s=t.currentObject.step,l=[];if(t.pathArray.length>1)for(o=1;o<t.pathArray.length;o++)n=t.pathArray[o-1],a=e({obj:t.currentObject.id,pathId:n,animation:t.animationName,speed:t.speedValue}),r=i(t.pathArray[o-1],t.pathArray[o]),l.push({pathId:n,targetChain:r.serviceChain,animation:a.animation,speed:a.speed,step:s}),s=r.serviceStep;n=t.pathArray[t.pathArray.length-1],a=e({obj:t.currentObject.id,pathId:n,animation:t.animationName,speed:t.speedValue}),l.push({pathId:n,targetChain:t.targetChain,animation:a.animation,speed:a.speed,step:s}),queue.addToObjPaths({objectId:t.currentObject.id,paths:l,callback:t.callback})}function e(e){if(null===e.resultPath.graphIdEnd||!globals.graph[e.resultPath.graphIdStart])return!1;var i,r=globals.graph[e.resultPath.graphIdStart].targets[e.resultPath.graphIdEnd],n=[];for(i=1;i<r.path.length;i++)n.push(globals.graph[r.path[i-1]].targets[r.path[i]].pathName);n.push(e.resultPath.path),n[0]!==e.currentObject.path&&n.unshift(e.currentObject.path),t({pathArray:n,targetChain:e.resultPath.chain,currentObject:e.currentObject,animationName:e.animationName,speedValue:e.speedValue,callback:e.callback})}function i(t){if(!t.currentObject||!globals.paths[t.path]||!globals.paths[t.currentObject.path])return!1;var e,i,r,n=t.path,a=t.chain,o=t.currentObject,s=t.resultPath||{steps:Number.POSITIVE_INFINITY,graphIdStart:null,graphIdEnd:null},l=[{steps:globals.paths[n].controlPath[a].step,graphId:globals.paths[n].dots[0].graphId},{steps:globals.paths[n].steps.length-globals.paths[n].controlPath[a].step,graphId:globals.paths[n].dots[globals.paths[n].dots.length-1].graphId}],h={steps:Number.POSITIVE_INFINITY,graphIdStart:null,graphIdEnd:null},c=[{steps:o.step,graphId:globals.paths[o.path].dots[0].graphId},{steps:globals.paths[o.path].steps.length-o.step,graphId:globals.paths[o.path].dots[globals.paths[o.path].dots.length-1].graphId}];for(e=0;2>e;e++)for(i=0;2>i;i++)r=c[e].steps+l[i].steps+globals.graph[c[e].graphId].targets[l[i].graphId].distance,r<h.steps&&(h={steps:r,graphIdStart:c[e].graphId,graphIdEnd:l[i].graphId});return s.steps>h.steps?{steps:h.steps,graphIdStart:h.graphIdStart,graphIdEnd:h.graphIdEnd,path:n,chain:a}:s}function r(t){var r,n,a=globals.objects[t.id],o={};if(!a)return!1;for(r in globals.paths)if(globals.paths[r].controlPath&&!globals.paths[r].breakpath)for(n=0;n<globals.paths[r].controlPath.length;n++)globals.paths[r].controlPath[n].rect.contains(t.x*globals.scale,t.y*globals.scale)&&(o=JSON.parse(JSON.stringify(i({currentObject:a,path:r,chain:n}))));e({resultPath:o,currentObject:a})}function n(t){var r,n=globals.objects[t.id];return n?(r=i({currentObject:n,path:t.path,chain:t.chain}),void e({resultPath:r,currentObject:n,animationName:t.animationName,speedValue:t.speedValue,callback:t.callback})):!1}function a(){void 0!==document.ontouchend?window.addEventListener("touchend",function(t){return globals.objectClicked||globals.viewport.resize?(globals.objectClicked=!1,globals.viewport.resize=!1,!1):globals.preventClick?!1:void r({id:"hero",x:(t.changedTouches[0].pageX-scene.playGround.position.x/globals.scale)/globals.viewport.scale,y:(t.changedTouches[0].pageY-scene.playGround.position.y/globals.scale)/globals.viewport.scale})}):window.addEventListener("click",function(t){return globals.objectClicked||globals.viewport.resize?(globals.objectClicked=!1,globals.viewport.resize=!1,!1):globals.preventClick?!1:void r({id:"hero",x:(t.pageX-scene.playGround.position.x/globals.scale)/globals.viewport.scale,y:(t.pageY-scene.playGround.position.y/globals.scale)/globals.viewport.scale})})}return{start:function(){a()},moveObjectByChain:function(t){n(t)}}}(),utils=function(){return{getRandomValue:function(t,e){var i=e?t:0,r=e||t;return i+Math.round(Math.random()*(r-i))},getDistance:function(t){var e=t.x2-t.x1,i=t.y2-t.y1;return Math.sqrt(e*e+i*i)},getLinePointCoords:function(t){return{x:(t.x2-t.x1)*t.t+t.x1,y:(t.y2-t.y1)*t.t+t.y1}},getBezierPointCoords:function(t){function e(e){var i=1-t.t;return i*i*i*e.p0+3*t.t*i*i*e.p1+3*t.t*t.t*i*e.p2+t.t*t.t*t.t*e.p3}return{x:e({p0:t.x1,p1:t.ax1,p2:t.ax2,p3:t.x2}),y:e({p0:t.y1,p1:t.ay1,p2:t.ay2,p3:t.y2})}},getAdditionalBezierPointsCoords:function(t){var e=utils.getLinePointCoords({x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,t:.3}),i=utils.getLinePointCoords({x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,t:.7});return{ax1:e.x,ay1:e.y,ax2:i.x,ay2:i.y}},buildCurveSteps:function(t){var e,i,r,n,a,o,s=1.4,l={},h=t.t1+(t.t2-t.t1)/2,c=utils.getBezierPointCoords({x1:t.x1,y1:t.y1,ax1:t.ax1,ay1:t.ay1,ax2:t.ax2,ay2:t.ay2,x2:t.x2,y2:t.y2,t:h}),u=utils.getBezierPointCoords({x1:t.x1,y1:t.y1,ax1:t.ax1,ay1:t.ay1,ax2:t.ax2,ay2:t.ay2,x2:t.x2,y2:t.y2,t:t.t1}),d=utils.getBezierPointCoords({x1:t.x1,y1:t.y1,ax1:t.ax1,ay1:t.ay1,ax2:t.ax2,ay2:t.ay2,x2:t.x2,y2:t.y2,t:t.t2}),p=utils.getDistance({x1:u.x,y1:u.y,x2:c.x,y2:c.y});if(!(p>s))return l[h]=c,l;e=utils.buildCurveSteps({x1:t.x1,y1:t.y1,ax1:t.ax1,ay1:t.ay1,ax2:t.ax2,ay2:t.ay2,x2:t.x2,y2:t.y2,t1:t.t1,t2:h});for(o in e)l[o]=e[o];if(i=utils.getDistance({x1:c.x,y1:c.y,x2:d.x,y2:d.y}),i>=s){r=utils.buildCurveSteps({x1:t.x1,y1:t.y1,ax1:t.ax1,ay1:t.ay1,ax2:t.ax2,ay2:t.ay2,x2:t.x2,y2:t.y2,t1:h,t2:t.t2});for(o in r)l[o]=r[o]}if(l[h]={x:c.x,y:c.y},0===t.t1&&1===t.t2){l[0]={x:t.x1,y:t.y1},l[1]={x:t.x2,y:t.y2},n=[],a=[];for(o in l)n.push(o);for(n=n.sort(),o=0;o<n.length;o++)a.push(l[n[o]]);return a}return l},buildControlPoligon:function(t){var e,i,r,n=100,a=globals.paths[t.pathId],o=[],s=0;for(r=0;r<a.steps.length;r++)e=utils.getDistance({x1:a.steps[s].x,y1:a.steps[s].y,x2:a.steps[r].x,y2:a.steps[r].y}),e>n&&(i={x:a.steps[s].x-n/2,y:a.steps[s].y-n/2},o.push({rect:new PIXI.Rectangle(i.x,i.y,n,n),step:s}),s=r);i={x:a.steps[s].x-n/2,y:a.steps[s].y-n/2},o.push({rect:new PIXI.Rectangle(i.x,i.y,a.steps[a.steps.length-1].x-i.x+n/2,a.steps[a.steps.length-1].y-i.y+n/2),step:a.steps.length-1}),a.controlPath=o},processPaths:function(t){var e,i,r,n,a=t?t.callback||function(){}:function(){};for(e in globals.paths)if(globals.paths[e].dots.length){for(globals.paths[e].steps=[],r=1;r<globals.paths[e].dots.length;r++)for(i=utils.buildCurveSteps({x1:globals.paths[e].dots[r-1].mainHandle.x,y1:globals.paths[e].dots[r-1].mainHandle.y,ax1:globals.paths[e].dots[r-1].nextHandle.x,ay1:globals.paths[e].dots[r-1].nextHandle.y,ax2:globals.paths[e].dots[r].prevHandle.x,ay2:globals.paths[e].dots[r].prevHandle.y,x2:globals.paths[e].dots[r].mainHandle.x,y2:globals.paths[e].dots[r].mainHandle.y,t1:0,t2:1}),n=0;n<i.length;n++)globals.paths[e].steps.push({x:i[n].x,y:i[n].y});globals.paths[e].steps.length&&utils.buildControlPoligon({pathId:e})}a()},fadeIn:function(){document.querySelector(".black-fade").className+=" black-fade_active"},fadeOut:function(){document.querySelector(".black-fade").className=document.querySelector(".black-fade").className.replace(/\sblack-fade_active/gi,"")}}}(),graph=function(){function t(t,e){return Math.round(t).toString()+"_"+Math.round(e).toString()}function e(t,e,i,r,a,o){void 0===n[r]&&(n[r]={link:{}}),void 0===n[r].link[t]&&(n[r].link[t]=e),void 0===n[a]&&(n[a]={link:{}}),void 0===n[a].link[t]&&(n[a].link[t]=i),void 0===n[r][a]&&(n[r][a]={distance:o,path:t}),void 0===n[a][r]&&(n[a][r]={distance:o,path:t})}function i(){var t,e,i,r,n,o=a[0].length;for(t=0;o>t;t++)for(e=0;o>e;e++)for(i=0;o>i;i++)if(a[e][i].distance>a[e][t].distance+a[t][i].distance){for(a[e][i].distance=a[e][t].distance+a[t][i].distance,a[e][i].path=[],r=0;r<a[e][t].path.length;r++)a[e][i].path.push(a[e][t].path[r]);for(n=1;n<a[t][i].path.length;n++)a[e][i].path.push(a[t][i].path[n])}}function r(t){var e,r,o,s,l,h,c,u,d,p=[],f=t&&t.callback||function(){};for(e in n)p.push(e);for(a=new Array(p.length),u=0;u<p.length;u++)for(a[u]=new Array(p.length),d=0;d<p.length;d++)r=n[p[u]][p[d]]?n[p[u]][p[d]].distance:u===d?0:Number.POSITIVE_INFINITY,o=r?[u,d]:[],a[u][d]={path:o,distance:r};for(i(),e=0;e<p.length;e++){globals.graph[e]={targets:{},links:{}};for(s in n[p[e]].link)for(n[p[e]].link[s].graphId=e,globals.graph[e].links[s]=n[p[e]].link[s],l=0;l<p.length;l++)for(h=void 0!==n[p[e]][p[l]]?n[p[e]][p[l]].path:!1,globals.graph[e].targets[l]={distance:a[e][l].distance,path:[],pathName:h},c=0;c<a[e][l].path.length;c++)globals.graph[e].targets[l].path.push(a[e][l].path[c])}f()}var n,a;return{buildGraph:function(i){var o,s,l,h;globals.graph={},n={},a={};for(o in globals.paths)s=globals.paths[o].dots[0].mainHandle,l=globals.paths[o].dots[globals.paths[o].dots.length-1].mainHandle,h=globals.paths[o].breakpath?Number.POSITIVE_INFINITY:globals.paths[o].steps.length,e(o,globals.paths[o].dots[0],globals.paths[o].dots[globals.paths[o].dots.length-1],t(s.x,s.y),t(l.x,l.y),h);r(i)},getAdjacencyMatrix:function(){return a},getGraphIdByStep:function(t){var e;return t.step<10?e=globals.paths[t.path].dots[0].graphId:globals.paths[t.path].steps.length-1-t.step<10&&(e=globals.paths[t.path].dots[globals.paths[t.path].dots.length-1].graphId),e}}}(),move=function(){function t(t){var e,i=globals.objects[t.id].step,r=globals.paths[t.path],n=r.controlPath[t.chain].step,a=t.callback||function(){};return globals.objects[t.id].path=t.path,Math.abs(i-n)<t.speed?void a():(e=r.controlPath[t.chain].step-globals.objects[t.id].step,0!==e&&(e/=Math.abs(e)),audio.updateWorldSound({id:t.id}),globals.objects[t.id].image.state.isComplete()&&(globals.objects[t.id].image.state.setAnimationByName(t.animation,!1),globals.objects[t.id].animation&&globals.objects[t.id].animation[t.animation]&&globals.objects[t.id].animation[t.animation].track.play()),globals.objects[t.id].step=globals.objects[t.id].step+e*t.speed,void 0===r.steps[globals.objects[t.id].step]&&(globals.objects[t.id].step=r.steps.length-1),void globals.objects[t.id].move({x:r.steps[globals.objects[t.id].step].x,y:r.steps[globals.objects[t.id].step].y}))}return{setMovement:function(e){t(e)}}}(),queue=function(){function t(){function i(){for(n=0;n<o.length;n++)delete e[o[n]]}var r,n,a,o=[];for(a in e)r=e[a].length,r?(globals.objects[a].image.state.current&&e[a][0].animation!==globals.objects[a].image.state.current.name&&globals.objects[a].image.state.clearAnimation(),e[a][0].speed?move.setMovement({id:a,path:e[a][0].pathId,chain:e[a][0].targetChain,animation:e[a][0].animation,speed:e[a][0].speed,callback:function(){globals.objects[a].step=e[a][1]?e[a][1].step:globals.objects[a].step;{var t=e[a].callback||function(){};e[a].shift()}e[a].length?relay.drop({obj:a,graphId:graph.getGraphIdByStep({path:e[a][0].pathId,step:globals.objects[a].step}),type:"breakpoint"}):("hero"===a&&globals.objects[a].image.state.setAnimationByName("stop",!1),t(),relay.drop({obj:a,graphId:graph.getGraphIdByStep({path:globals.objects[a].path,step:globals.objects[a].step}),type:"stop"}))}}):e[a][0].playingNow||(globals.objects[a].animate({animation:e[a][0].animation,callback:function(){for(globals.objects[a].path=e[a][0].pathId,globals.objects[a].step=e[a][1]?e[a][1].step:globals.objects[a].step;e[a].length&&!e[a][0].speed;){e[a].shift()}relay.drop({obj:a,graphId:graph.getGraphIdByStep({path:globals.objects[a].path,step:globals.objects[a].step}),type:"stop"})}}),e[a][0].playingNow=!0)):o.push(a);i(),requestAnimationFrame(function(){t()})}var e={};return{addToObjPaths:function(t){return e[t.objectId]=t.paths,e[t.objectId].callback=t.callback,relay.drop({obj:t.objectId,graphId:graph.getGraphIdByStep({path:globals.objects[t.objectId].path,step:globals.objects[t.objectId].step}),type:"start"}),this},startQueue:function(){return t(),this}}}(),relay=function(){return{drop:function(t){var e,i,r=this,n=t.graphId?".inGraphId."+t.graphId:"";return"function"==typeof window.CustomEvent?(e=new CustomEvent(t.type,{detail:t}),i=new CustomEvent(t.obj+"."+t.type+n,{detail:t})):(e=document.createEvent("CustomEvent"),e.initCustomEvent(t.type,!0,!0,t),i=document.createEvent("CustomEvent"),i.initCustomEvent(t.obj+"."+t.type+n,!0,!0,t)),document.dispatchEvent(e),document.dispatchEvent(i),r},listen:function(t){var e=this;return document.addEventListener(t,function(t){console.log(t.detail)}),e}}}();document.addEventListener("snow.objectAdded",function(){!function t(){globals.objects.snow.animate({animation:"snow",callback:function(){t()}})}()}),document.addEventListener("hero.stop.inGraphId.8",function(){moveTree()}),document.addEventListener("hero.breakpoint.inGraphId.8",function(){moveTree()}),document.addEventListener("bird.objectClick",function(){"treeInside"===globals.objects.hero.getPosition().path&&4===globals.objects.hero.getPosition().graphId&&(globals.preventClick=!0,globals.objects.hero.animate({animation:"slope",callback:function(){globals.paths.treeToBucket.breakpath=!1,graph.buildGraph({callback:function(){globals.objects.hero.moveTo({path:"treeToBucket",chain:0,animationName:"new",speedValue:3,callback:function(){globals.objects.bucket.animate({animation:"bucket",callback:function(){1===globals.objects.hero.getPosition().orientation&&(globals.objects.hero.image.scale.x*=-1),globals.objects.hero.moveTo({path:"groundTreeToLeft",chain:1})}})}})}})}}),setTimeout(function(){globals.objects.bird.moveTo({path:"birdTreePath",chain:3,animationName:"bird",speedValue:4})},400)),"treeToSemaphore"===globals.objects.hero.path&&207===globals.objects.hero.step&&"birdTreePath"===globals.objects.bird.path&&456===globals.objects.bird.step&&(globals.objects.hero.animate({animation:"ReachOut"}),setTimeout(function(){globals.objects.bird.moveTo({path:"birdTreePath2",chain:3,animationName:"bird",speedValue:4})},300))}),document.addEventListener("hero.breakpoint.inGraphId.5",function(){globals.triggers.heroOnTheGround||(globals.paths.bucketToGround.breakpath=!0,graph.buildGraph({callback:function(){globals.triggers.heroOnTheGround=!0,globals.preventClick=!1}}))}),document.addEventListener("hero.stop.inGraphId.5",function(){checkGarbageBucket()}),document.addEventListener("hero.breakpoint.inGraphId.5",function(){checkGarbageBucket()}),document.addEventListener("hero.stop.inGraphId.11",function(){checkGarbageBucket()}),document.addEventListener("hero.breakpoint.inGraphId.11",function(){checkGarbageBucket()}),document.addEventListener("garbageBucket.objectClick",function(){if(!globals.triggers.garbageBucketIsOpen){var t=globals.objects.hero.getPosition().chain;"treeToSemaphore"!==globals.objects.hero.getPosition().path||6!==t&&7!==t||(globals.triggers.garbageBucketIsOpen=!0,globals.objects.garbageBucket.animate({animation:"open",callback:function(){globals.objects.butterfly.move({z:15}),globals.triggers.butterflyIsFree=!0,globals.objects.butterfly.moveTo({path:"butterflyPath2",chain:0,animationName:"butterfly",speedValue:4})}}))}}),document.addEventListener("villain.objectClick",function(){"groundTreeToLeft"===globals.objects.hero.getPosition().path&&3===globals.objects.hero.getPosition().chain?globals.objects.hero.animate({animation:"catch",callback:function(){globals.objects.villain.animate({animation:"animation"})}}):globals.objects.villain.animate({animation:"animation"}),hint.message("villainFirstHintText")
}),document.addEventListener("semaphore.objectAdded",function(){!function t(){globals.triggers.stopSemaphore||globals.objects.semaphore.animate({animation:"trafficLight",callback:function(){t()}})}()}),document.addEventListener("semaphore.objectClick",function(){globals.triggers.semaphoreIsClickable&&17===globals.objects.hero.getPosition().graphId&&(globals.triggers.stopSemaphore=!0,globals.objects.semaphore.animate({animation:"trafficLight_stop"}),globals.objects.hero.animate({animation:"ReachOut"}),setTimeout(function(){globals.triggers.butterflyWasCatched&&(globals.objects.butterfly.move({z:15}),globals.paths.semaphoreToTV.breakpath=!1,graph.buildGraph({callback:function(){globals.objects.barrier.animate({animation:"barrier"}),clearTimeout(globals.triggers.centralActionHint)}}))},400))}),document.addEventListener("butterfly.stop.inGraphId.18",function(){globals.objects.butterfly.moveTo({path:"butterflyPath2",chain:0,animationName:"butterfly",speedValue:4}),globals.triggers.butterflyCanBeCatched&&"treeToSemaphore"===globals.objects.hero.getPosition().path&&6===globals.objects.hero.getPosition().chain&&(globals.preventClick=!0,catchButterfly())}),document.addEventListener("butterfly.stop.inGraphId.19",function(){globals.objects.butterfly.moveTo({path:"butterflyPath3",chain:0,animationName:"butterfly",speedValue:4}),globals.triggers.butterflyCanBeCatched&&"treeToSemaphore"===globals.objects.hero.getPosition().path&&5===globals.objects.hero.getPosition().chain&&(globals.preventClick=!0,catchButterfly())}),document.addEventListener("butterfly.stop.inGraphId.20",function(){globals.objects.butterfly.moveTo({path:"butterflyPath4",chain:0,animationName:"butterfly",speedValue:4}),globals.triggers.butterflyCanBeCatched&&11===globals.objects.hero.getPosition().graphId&&(globals.preventClick=!0,catchButterfly())}),document.addEventListener("butterfly.stop.inGraphId.21",function(){globals.objects.butterfly.moveTo({path:"butterflyPath",chain:0,animationName:"butterfly",speedValue:3}),globals.triggers.butterflyCanBeCatched&&"treeToSemaphore"===globals.objects.hero.getPosition().path&&7===globals.objects.hero.getPosition().chain&&(globals.preventClick=!0,catchButterfly())}),document.addEventListener("butterfly.objectClick",function(){globals.triggers.butterflyInerval&&clearInterval(globals.triggers.butterflyInerval),globals.triggers.butterflyCanBeCatched||("butterflyPath"===globals.objects.butterfly.getPosition().path&&globals.objects.hero.moveTo({path:"treeToSemaphore",chain:8}),"butterflyPath2"===globals.objects.butterfly.getPosition().path&&globals.objects.hero.moveTo({path:"treeToSemaphore",chain:7}),"butterflyPath3"===globals.objects.butterfly.getPosition().path&&globals.objects.hero.moveTo({path:"treeToSemaphore",chain:6}),"butterflyPath4"===globals.objects.butterfly.getPosition().path&&globals.objects.hero.moveTo({path:"treeToSemaphore",chain:5})),globals.triggers.butterflyCanBeCatched=!0,globals.triggers.butterflyInerval=setTimeout(function(){globals.triggers.butterflyCanBeCatched=!1},25e3)}),document.addEventListener("stone.objectClick",function(){11===globals.objects.hero.getPosition().graphId&&getTheStone()}),document.addEventListener("villain2.objectClick",function(){11===globals.objects.hero.getPosition().graphId?dropToVillain():-1!==["treeToSemaphore","semaphoreBreakPath"].indexOf(globals.objects.hero.getPosition().path)&&globals.objects.hero.moveTo({path:"treeToSemaphore",chain:8,animationName:"new",speedValue:3,callback:function(){dropToVillain()}})}),document.addEventListener("tv.objectClick",function(){"TVPath"===globals.objects.hero.path&&globals.objects.hero.moveTo({path:"TVPath",chain:2,callback:function(){globals.objects.tv.animate({animation:"TV run",callback:function(){globals.paths.pathToMonitors.breakpath=!1,graph.buildGraph(),tvPictures()}})}})}),document.addEventListener("roadSing.objectClick",function(){"elephantPath"===globals.objects.hero.getPosition().path&&1===globals.objects.hero.getPosition().chain&&globals.objects.hero.animate({animation:"ReachOut",callback:function(){globals.objects.roadSing.animate({animation:"roadSing",callback:function(){globals.objects.doorToTheNextLavel.animate({animation:"door",callback:function(){globals.triggers.exit=!0,clearTimeout(globals.triggers.levelEndHint)}})}})}})}),document.addEventListener("hero.stop.inGraphId.32",function(){globals.triggers.exit?(audio.fadeOut(),utils.fadeIn()):hint.message("endPathFailText")}),document.addEventListener("hero.objectAdded",function(){stairHint()}),document.addEventListener("hero.stop.inGraphId.2",function(){globals.triggers.bucketHint||bucketHint(),clearTimeout(globals.triggers.stairHint)}),document.addEventListener("hero.breakpoint.inGraphId.2",function(){globals.triggers.bucketHint||bucketHint(),clearTimeout(globals.triggers.stairHint)}),document.addEventListener("hero.stop.inGraphId.3",function(){globals.triggers.centralActionHint||centralAction(),clearTimeout(globals.triggers.bucketHint)}),document.addEventListener("hero.breakpoint.inGraphId.3",function(){globals.triggers.centralActionHint||centralAction(),clearTimeout(globals.triggers.bucketHint)}),document.addEventListener("hero.stop.inGraphId.13",function(){globals.triggers.levelEndHint||levelEnd()}),document.addEventListener("hero.breakpoint.inGraphId.13",function(){globals.triggers.levelEndHint||levelEnd()});var audio=function(){function t(){try{window.AudioContext=window.AudioContext||window.webkitAudioContext,o=void 0===o?new AudioContext:o,s=o.createGain?o.createGain():o.createGainNode(),s.connect(o.destination)}catch(t){o=!1,document.body.className+=" _nomusic"}}function e(t){var e=globals.objects[t.id];e.panner&&e.panner.setPosition(e.image.position.x,e.image.position.y,0),o&&"hero"===t.id&&o.listener.setPosition(e.image.position.x,e.image.position.y,0)}function i(){h.load({obj:{},url:"assets/music/splash.ogg",callback:function(){h.play({loop:!0})}})}function r(){c.load({obj:globals.objects.hero,url:"assets/music/background.ogg",callback:function(){c.play({loop:!0})}})}function n(){if(o){var t=audio.getContext().currentTime;audio.getGainNode().gain.linearRampToValueAtTime(globals.volume,t)}}function a(){document.webkitHidden||document.hidden?audio.fadeOut():audio.fadeIn()}var o,s,l=1,h=track(),c=track();return{init:function(){return t(),n(),document.addEventListener("visibilitychange",function(){a()}),document.addEventListener("webkitvisibilitychange",function(){a()}),this},initBackgroundSound:function(){return r(),this},initSplashSound:function(){return i(),this},finishSplashSound:function(){return audio.getContext()&&(audio.fadeOut(),setTimeout(function(){h.stop(),h.play=function(){},audio.fadeIn()},1e3)),this},updateWorldSound:function(t){return e(t),this},setVolume:function(){return n(),this},fadeIn:function(){if(o){var t=audio.getContext().currentTime;audio.getGainNode().gain.linearRampToValueAtTime(0,t),audio.getGainNode().gain.linearRampToValueAtTime(globals.volume,t+l)}},fadeOut:function(){if(o){var t=audio.getContext().currentTime;audio.getGainNode().gain.linearRampToValueAtTime(globals.volume,t),audio.getGainNode().gain.linearRampToValueAtTime(0,t+l)}},getContext:function(){return o},getGainNode:function(){return s}}}(),video=function(){var t=!1;return{init:function(){return t=document.querySelector("video"),("maybe"!==t.canPlayType("video/mp4")||null!==navigator.userAgent.toLowerCase().match(/ipad|iphone|ipod/i))&&(t=!1),this},play:function(e){function i(){t.style.display="none",t.pause(),r()}var r=e||function(){};return t&&navigator.onLine!==!1?(t.style.display="block",t.onended=t.onclick=function(){i()},t.play()):r(),this}}}(),translations={villainFirstHintText:{ru:"Этот сиккарах выглядит рассерженным. Вряд ли он пропустит меня."},stairHintText:{ru:"Высоко тут...",en:"I feel dizzy"},bucketHintText:{ru:"Додумался же кто-то повесить ведро на дерево!",en:"Bucket on tree looks very strange"},semaphoreHintText:{ru:"Наверное, светофор должен быть зеленым...",en:"It would be nice turn semaphore on..."},garbageHintText:{ru:"Кажется, в баке кто-то есть...",en:"I think I saw something..."},villainHintText:{ru:"Вот бы скинуть Кривоноса с забора!",en:"The villain of the way."},finalGarbageHintText:{ru:"Кто знает, что может быть в этой куче мусора?",en:"Some surprise in this garbage heap?"},endPathFailText:{ru:"Глухой забор.",en:"Closed."}},hint=function(){function t(){return r.length?void(a||(e.className+=" hint_active",e.innerHTML=r.shift(),a=!0,i=setTimeout(function(){a=!1,t()},n))):(e.className=e.className.replace(/\shint_active/gi,""),e.innerHTML="",void(a=!1))}var e,i,r=[],n=5e3,a=!1;return{init:function(r){var n=r||function(){};return e=document.querySelector(".hint"),e.onclick=function(){clearTimeout(i),a=!1,t()},localforage.getItem("locale",function(t){t?globals.locale=t:(globals.locale=window.navigator.userLanguage||window.navigator.language||globals.locale,globals.locale=globals.locale.split("-")[0].toLowerCase()),n()}),this},message:function(e){return translations[e]&&translations[e][globals.locale]&&(r.push(translations[e][globals.locale]),t()),this},clearQueue:function(){return r=[],clearTimeout(i),a=!1,this}}}(),loader=function(){function t(t){var e=new PIXI.AssetLoader(t.resources),i=t.callback||function(){};e.onComplete=function(){i()},e.load()}function e(t){var e=t.callback||function(){};utils.processPaths({callback:function(){graph.buildGraph({callback:function(){e(),pathfinder.start()}})}})}return{init:function(i){var r=i.callback||function(){};t({resources:i.resources,callback:function(){globals.sceneWidth=3828,globals.sceneHeight=800,globals.scale=globals.sceneHeight/document.body.clientHeight,e({callback:r})}})}}}();document.addEventListener("DOMContentLoaded",function(){function t(){var t=document.body;t.requestFullScreen?t.requestFullScreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullScreen&&t.webkitRequestFullScreen()}audio.init(),video.init(),hint.init(function(){debug||(document.querySelector('.start__language option[value="'+globals.locale+'"]').selected=!0)}),debug?(document.body.removeChild(document.querySelector(".start")),init()):(document.body.className+=" _noscroll",localforage.getItem("volume",function(t){t?(document.querySelector(".start__volume").value=t,globals.volume=t,audio.setVolume().initSplashSound()):audio.initSplashSound()}),document.querySelector(".start__volume").onmousemove=document.querySelector(".start__volume").onchange=function(){globals.volume=this.value,localforage.setItem("volume",globals.volume,function(){audio.setVolume()})},document.querySelector(".start__language").onchange=function(){globals.locale=this.value,localforage.setItem("locale",globals.locale)},document.querySelector(".start__run").onclick=function(){document.body.removeChild(document.querySelector(".start")),t(),audio.finishSplashSound(),video.play(function(){init()})})});